import{bX as O,y as $,r as y,dB as V,dC as H,dD as K,dJ as R,dK as W,B as X,a as e,au as A,aJ as Y,V as d,G as Z,W as Q,aU as N,H as r,J as o,K as i,N as u,I as v,Q as c,a9 as f,aa as w,ab as l,aV as S,ac as C,ad as P,bt as ee,D as te,av as ae,aw as se}from"./index-79d37c6f.js";import{S as ne,C as re,q as oe}from"./quotation-3d72a47b.js";function de(){const L=O(),m=Number(L.id),x=$(),[j,F]=y.useState([]),[p,D]=y.useState({quote_date:!1,expire_date:!1,estimated_delivery_date:!1}),_=t=>{D(a=>({...a,[t]:!a[t]}))},{data:h,isLoading:k}=V("page=1&per_page=1000"),{data:b,isLoading:M}=H("per_page=1000&page=1"),{data:g,isLoading:T}=K("per_page=1000&page=1"),{data:n,isLoading:E}=R(m,{skip:!m}),I=(h==null?void 0:h.data)||[],U=(b==null?void 0:b.data)||[],G=(g==null?void 0:g.data)||[],[z,{isLoading:B}]=W(),s=X({resolver:te(oe),defaultValues:{total:0}});y.useEffect(()=>{n&&(s.reset({...n.data,note:n.data.note||"",subject:n.data.subject||"",terms_conditions:n.data.terms_conditions||"",contact_id:String(n.data.contact.id),project_id:String(n.data.project_id),sales_person_id:String(n.data.sales_person.id),discount:Number(n.data.discount),total:Number(n.data.total),shipping_charges:Number(n.data.shipping_charges)}),F(n.data.quotation_details.map(t=>({barcode:String(t.item_barcode.barcode),id:t.item_barcode.id,barcode_attribute:t.item_barcode.barcode_attribute,name:t.item.name,note:t.note||"",secondary_unit:{wholesale_price:Number(t.item_barcode.wholesale_price),after_discount:Number(t.item_barcode.after_discount),discount:Number(t.discount),discount_amount:Number(t.item_barcode.discount_amount),id:t.unit.id,name:t.item.name,selling_price:Number(t.item_barcode.selling_price)},finalPrice:Number(t.total),quantity:Number(t.qty),subTotal:Number(t.item_barcode.after_discount),total:Number(t.total),primary_unit:{wholesale_price:Number(t.item_barcode.wholesale_price),after_discount:Number(t.item_barcode.after_discount),discount:Number(t.discount),discount_amount:Number(t.item_barcode.discount_amount),id:t.unit.id,name:t.item.name,selling_price:Number(t.item_barcode.selling_price)},unit:{wholesale_price:Number(t.item_barcode.wholesale_price),after_discount:Number(t.item_barcode.after_discount),discount:Number(t.discount),discount_amount:Number(t.item_barcode.discount_amount),id:t.unit.id,name:t.item.name,selling_price:Number(t.item_barcode.selling_price)}}))))},[s,n]);async function J(t){try{await z({itemId:m,updatedItem:{...t,details:j.map(a=>{const q=a.unit.selling_price*(1-a.unit.discount/100);return{unit_id:a.unit.id,item_id:a.id,item_barcode_id:Number(a.id),price:a.unit.selling_price,after_discount:Number(q.toFixed(2)),total:Number((q*a.quantity).toFixed(2)),qty:a.quantity,discount:a.unit.discount,note:a.note||""}})}}).unwrap(),ae.success("Quotation updated successfully"),x("/billing/quotes")}catch(a){se(a)}}return E?e.jsx(A,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(Y,{title:"Edit Quote",description:"Manage your sub accounts for you business"}),e.jsx(d,{onClick:()=>x("/billing/quotes"),size:"sm",children:"Quotes List"})]}),e.jsx(Z,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(J),className:"space-y-3 mb-4  overflow-y-scroll no-scrollbar",children:[e.jsx("div",{className:"",children:e.jsx(Q,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(N,{loading:k,data:I,displayField:"name",valueField:"id",form:s,name:"contact_id",placeholder:"Select Customer",title:"Customer Name",className:"w-full"}),e.jsx(r,{control:s.control,name:"reference",render:({field:t})=>e.jsxs(o,{children:[e.jsx(i,{children:"Reference"}),e.jsx(u,{children:e.jsx(v,{placeholder:"Enter reference",...t})}),e.jsx(c,{})]})}),e.jsx(r,{control:s.control,name:"date",render:({field:t})=>e.jsxs(o,{children:[e.jsx(i,{children:"Quote Date"}),e.jsxs(f,{open:p.quote_date,onOpenChange:()=>_("quote_date"),children:[e.jsx(w,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:`w-full justify-start text-left font-normal ${!t.value&&"text-muted-foreground"}`,children:[t.value?l(t.value,"PP"):"Pick a date",e.jsx(S,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(C,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(P,{mode:"single",selected:t.value?new Date(t.value):void 0,onSelect:a=>{t.onChange(a?l(a,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(c,{})]})}),e.jsx(r,{control:s.control,name:"expire_date",render:({field:t})=>e.jsxs(o,{children:[e.jsx(i,{children:"Expire Date"}),e.jsxs(f,{open:p.expire_date,onOpenChange:()=>_("expire_date"),children:[e.jsx(w,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:`w-full justify-start text-left font-normal ${!t.value&&"text-muted-foreground"}`,children:[t.value?l(t.value,"PP"):"Pick a date",e.jsx(S,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(C,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(P,{mode:"single",selected:t.value?new Date(t.value):void 0,onSelect:a=>{t.onChange(a?l(a,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(c,{})]})}),e.jsx(r,{control:s.control,name:"estimated_delivery",render:({field:t})=>e.jsxs(o,{children:[e.jsx(i,{children:"Estimated Delivery Date"}),e.jsxs(f,{open:p.estimated_delivery_date,onOpenChange:()=>_("estimated_delivery_date"),children:[e.jsx(w,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:`w-full justify-start text-left font-normal ${!t.value&&"text-muted-foreground"}`,children:[t.value?l(t.value,"PP"):"Pick a date",e.jsx(S,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(C,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(P,{mode:"single",selected:t.value?new Date(t.value):void 0,onSelect:a=>{t.onChange(a?l(a,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(c,{})]})}),e.jsx(N,{loading:T,data:G,displayField:"name",valueField:"id",form:s,name:"sales_person_id",placeholder:"Select Sells person",title:"Sales Person",className:"w-full"}),e.jsx(N,{loading:M,data:U,displayField:"name",valueField:"id",form:s,name:"project_id",placeholder:"Select Project",title:"Project Name",className:"w-full"}),e.jsx(r,{control:s.control,name:"subject",render:({field:t})=>e.jsxs(o,{children:[e.jsx(i,{children:"Subject"}),e.jsx(u,{children:e.jsx(v,{placeholder:"Type Subject.",...t})}),e.jsx(c,{})]})}),e.jsx(r,{control:s.control,name:"note",render:({field:t})=>e.jsxs(o,{children:[e.jsx(i,{children:"Customer Note"}),e.jsx(u,{children:e.jsx(v,{placeholder:"Type Subject.",...t})}),e.jsx(c,{})]})}),e.jsx(r,{control:s.control,name:"terms_conditions",render:({field:t})=>e.jsxs(o,{children:[e.jsx(i,{children:"Terms and conditions"}),e.jsx(u,{children:e.jsx(ee,{placeholder:"Type terms and conditions.",...t})}),e.jsx(c,{})]})})]})})}),e.jsx(Q,{className:"mb-4",children:e.jsx(ne,{setSelectedProducts:F,selectedProducts:j,previousData:!0})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(re,{form:s,subTotal:Number(j.reduce((t,a)=>t+a.total,0).toFixed(2))})}),e.jsxs("div",{className:"text-right",children:[e.jsx(d,{type:"button",onClick:()=>x("/billing/quotes"),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(d,{variant:"default",type:"submit",className:"w-fit mt-4",children:B?"Updating...":"Update"})]})]})})]})})}export{de as default};
