import{aA as v,aN as F,z as E,B as T,a as e,N,F as M,b as k,b8 as L,aK as g,M as A,Q as u,a8 as S,bL as D,b0 as P,b1 as B,b2 as f,b3 as y,b4 as C,R as z,b5 as n,bM as G,bb as O,r as Q,s as R,aB as $,aO as H,am as q,ba as I,aS as Y}from"./index-575d9a28.js";import{c as K}from"./index-37b5c37e.js";const U=u.object({employee_ids:u.string().optional(),salary_month:u.date(),department_id:u.string().optional(),employee_class_id:u.string().optional()});function V({setFilterParams:c}){var b;const{data:x,isLoading:d}=v("page=1&per_page=1000"),{data:o,isLoading:p}=F("page=1&per_page=1000"),{data:h,isLoading:a}=K("per_page=1000"),l=(o==null?void 0:o.data)||[],r=(x==null?void 0:x.data)||[],t=(h==null?void 0:h.data)||[],s=E({resolver:T(U)});async function i(m){const _=S(String(m.salary_month),"yyyy-MM");if(!_)return;const j=new URLSearchParams;j.append("salary_month",_),j.append("employee_ids",m.employee_ids?m.employee_ids:""),j.append("department_id",m.department_id?m.department_id:""),j.append("employee_class_id",m.employee_class_id?m.employee_class_id:"");const w=j.toString();c(w)}return e.jsx(N,{className:"p-6 my-4 w-full",children:e.jsx(M,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(i),className:" space-y-6 ",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-5",children:[e.jsxs("div",{className:"space-y-2 flex flex-col",children:[e.jsx("label",{className:k("text-sm font-medium mt-1",s.formState.errors.salary_month&&"text-red-500"),children:"Month and Year"}),e.jsx(L,{selected:s.watch("salary_month"),onChange:m=>{s.setValue("salary_month",m),s.trigger("salary_month")},dateFormat:"MM/yyyy",showMonthYearPicker:!0,placeholderText:"Select month and year",className:"border rounded p-2 w-full bg-none bg_remove"}),s.formState.errors.salary_month&&e.jsx("p",{className:"text-red-500 text-sm",children:(b=s.formState.errors.salary_month)==null?void 0:b.message})]}),e.jsx("div",{className:"w-full",children:e.jsx(g,{loading:p,data:l,displayField:"first_name",valueField:"id",form:s,name:"employee_ids",title:"Select Employee",className:"w-[245px]"})}),e.jsx("div",{className:"w-full",children:e.jsx(g,{loading:d,data:r,displayField:"name",valueField:"id",form:s,name:"department_id",title:"Select Department",className:"w-[245px]"})}),e.jsx("div",{className:"w-full",children:e.jsx(g,{loading:a,data:t,displayField:"name",valueField:"id",form:s,name:"employee_class_id",title:"Select Employee Class",className:"w-[245px]"})})]}),e.jsx("div",{className:"flex justify-end gap-4",children:e.jsx(A,{variant:"default",className:"w-fit px-14",children:"Apply"})})]})})})}const W=({data:c,salary_category:x})=>{function d(a){const l={};return a==null||a.employees.forEach(r=>{r==null||r.salaries.forEach(t=>{t.salary_details.forEach(s=>{l[s.category_name]?l[s.category_name]+=s.total:l[s.category_name]=s.total})})}),Object.values(l)}function o(a){const l={};return a.forEach(r=>{var s;const t=d(r);Object.keys((s=r.employees[0])==null?void 0:s.salaries[0].salary_details).forEach((i,b)=>{l[i]?l[i]+=t[b]:l[i]=t[b]})}),Object.values(l)}function p(a,l){let r=0;return a.employees.forEach(t=>{t.salaries.forEach(s=>{r+=s[l]||0})}),r}function h(a,l){return a.reduce((r,t)=>r+p(t,l),0)}return e.jsxs(D,{className:"w-[1567px] whitespace-nowrap",children:[e.jsxs(P,{className:"border",children:[e.jsx(B,{className:"border border-black",children:e.jsxs(f,{className:"border h-0 bg-gray-100 text-black",children:[e.jsx(y,{className:"border py-2.5 h-0 text-center text-black",children:"SL"}),e.jsx(y,{className:"border py-2.5 h-0 text-center text-black",children:"Name"}),x.map((a,l)=>e.jsx(y,{title:a.name,className:"border py-2.5 h-0 text-center text-black",children:a.short_code?a.short_code:a.name.split(" ").map(r=>r[0]).join(".")},l)),e.jsx(y,{className:"border py-2.5 h-0 text-center text-black",children:"Tot AI"}),e.jsx(y,{className:"border py-2.5 h-0 text-center text-black",children:"Tot Ded"}),e.jsx(y,{className:"border py-2.5 h-0 text-center text-black",children:"Net"})]})}),e.jsxs(C,{children:[c.map((a,l)=>e.jsxs(z.Fragment,{children:[e.jsxs(f,{children:[e.jsx(n,{className:"border py-2",colSpan:2,children:"Department"}),e.jsx(n,{className:"border py-2",colSpan:12,children:a==null?void 0:a.name})]}),a.employees.map((r,t)=>{var s;return e.jsxs(f,{className:"border",children:[e.jsx(n,{className:"border py-2 text-center",children:t+1}),e.jsx(n,{className:"border py-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:`${r.first_name} ${r.last_name}`}),e.jsx("span",{className:"ml-1.5",children:r.designation})]})}),(s=r==null?void 0:r.salaries)==null?void 0:s.map(i=>{var b;return e.jsxs(e.Fragment,{children:[(b=i==null?void 0:i.salary_details)==null?void 0:b.map(m=>e.jsx(n,{className:"border py-2 text-right",children:m.total})),e.jsx(n,{className:"border py-2 text-right",children:i.allowance_total}),e.jsx(n,{className:"border py-2 text-right",children:i.deduction_total}),e.jsx(n,{className:"border py-2 text-right",children:i.net_salary})]})})]},t)}),e.jsxs(f,{className:"border",children:[e.jsx(n,{className:"font-semibold border py-2"}),e.jsx(n,{className:"font-semibold border py-2",children:"Subtotal"}),d(a).map(r=>e.jsx(n,{className:"font-semibold border py-2 text-right",children:r})),["allowance_total","deduction_total","net_salary"].map((r,t)=>e.jsx(n,{className:"font-semibold border py-2 text-right",children:p(a,r)},t))," "]})]},l)),e.jsxs(f,{className:"border bg-gray-100",children:[e.jsx(n,{colSpan:2,className:"font-bold border py-2",children:"Total"}),o(c).map((a,l)=>e.jsx(n,{className:"font-bold border py-2 text-right",children:a==null?void 0:a.toFixed(0)},l)),["allowance_total","deduction_total","net_salary"].map((a,l)=>e.jsx(n,{className:"font-bold border py-2 text-right",children:h(c,a)},l))]})]})]}),e.jsx(G,{orientation:"horizontal"})]})},J=W,X=O.injectEndpoints({endpoints:c=>({getSalaryReport:c.query({query:x=>`salary-report?${x}`,providesTags:["salary-report"]})}),overrideExisting:!1}),{useGetSalaryReportQuery:Z}=X;function se(){var t;const[c,x]=Q.useState(""),{user:d}=R(),{data:o,isLoading:p,isError:h}=Z(`${c}`,{skip:!c}),a=o==null?void 0:o.data,l=(a==null?void 0:a.map(s=>s==null?void 0:s.name))||[],r=l.length>1?l.slice(0,-1).join(", ")+" and "+l.slice(-1):l[0]||"";return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx($,{title:"Salary Sheet",description:"Manage job apply for you business"})}),e.jsx(H,{}),e.jsx(V,{setFilterParams:x}),p&&e.jsx(q,{}),a&&(a==null?void 0:a.length)!==0&&!p&&!h&&e.jsx(N,{className:"p-4",children:e.jsxs(I,{className:"space-y-4",fileName:"employee-salary-payslip",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8 max-w-4xl mx-auto",children:[e.jsx("h3",{className:"text-lg font-semibold",children:d==null?void 0:d.organization.name}),e.jsx("p",{children:d==null?void 0:d.organization.address.join(", ")}),e.jsxs("p",{children:["Salary Bill (",r,")"," ",S(Y((t=c==null?void 0:c.split("&")[0])==null?void 0:t.split("=")[1]),"MMM-yy")]})]}),e.jsx(J,{data:a,salary_category:o==null?void 0:o.salary_category})]})}),(a==null?void 0:a.length)===0&&!h&&!p&&e.jsx(N,{className:"flex-1 space-y-4 max-w-[950px] w-full mx-auto p-3 py-6 grid place-items-center",children:e.jsx("h2",{className:"text-center",children:"No Data Found"})})]})}export{se as default};
