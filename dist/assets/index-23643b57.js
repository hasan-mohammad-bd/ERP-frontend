import{r as j,G as $,H as v,a as e,ax as E,K as D,N as y,Q as f,V as p,W as N,I as C,X as _,ac as P,ad as b,Y as g,ae as F,aZ as T,af as M,ag as k,ay as w,aC as A,aD as I,aE as L,aF as K,aG as O,aH as U,aI as R,aJ as G,aK as V,D as J,aM as Q,aN as Y,aO as B,aP as W}from"./index-68967a8a.js";import{u as X,a as Z,b as q}from"./index-0a2ae76b.js";import{h as ee}from"./holidays-42284ff1.js";function ae({modalClose:s,data:a}){const[c,m]=j.useState({start_date:!1,end_date:!1}),[x,{isLoading:r}]=X(),n=$({resolver:v(ee),defaultValues:{name:(a==null?void 0:a.name)||"",start_date:a!=null&&a.start_date?new Date(a.start_date):void 0,end_date:a!=null&&a.end_date?new Date(a.end_date):void 0,duration:(a==null?void 0:a.duration)||"",note:(a==null?void 0:a.note)||""}}),d=t=>new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),u=(t,l)=>{if(t&&l){const o=l.getTime()-t.getTime(),h=Math.ceil(o/(1e3*60*60*24));return`${h+1} day${h===0?"":"s"}`}return""};async function i(t){try{if(a){const l={...t,start_date:d(t.start_date),end_date:d(t.end_date)};await x({holidayId:a.id,updatedHoliday:l}).unwrap(),w.success("Holiday updated successfully"),s()}}catch(l){console.error("Failed to update holiday:",l),w.error("Failed to update holiday")}}const H=t=>{m(l=>({...l,[t]:!l[t]}))};return j.useEffect(()=>{const t=n.getValues("start_date"),l=n.getValues("end_date");if(t&&l){const o=u(t,l);n.setValue("duration",o)}},[n.watch("start_date"),n.watch("end_date")]),e.jsx(e.Fragment,{children:r?e.jsx("div",{className:"h-56",children:e.jsx(E,{})}):e.jsx(D,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(i),className:"space-y-3 mb-auto",children:[e.jsx(y,{control:n.control,name:"name",render:({field:t})=>e.jsxs(f,{children:[e.jsx(p,{children:"Holiday Name"}),e.jsx(N,{children:e.jsx(C,{type:"text",placeholder:"Enter holiday name",...t})}),e.jsx(_,{})]})}),e.jsx(y,{control:n.control,name:"start_date",render:({field:t})=>e.jsxs(f,{children:[e.jsx(p,{children:"Start Date"}),e.jsxs(P,{open:c.start_date,onOpenChange:()=>H("start_date"),children:[e.jsx(b,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:`w-full justify-start text-left font-normal ${!t.value&&"text-muted-foreground"}`,children:[t.value?F(t.value,"PP"):"Pick a date",e.jsx(T,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(M,{className:"w-auto p-0",align:"start",children:e.jsx(k,{mode:"single",selected:t.value??void 0,onSelect:l=>{const o=d(l);t.onChange(o);const h=n.getValues("end_date");if(o&&h){const S=u(o,h);n.setValue("duration",S)}},initialFocus:!0})})]}),e.jsx(_,{})]})}),e.jsx(y,{control:n.control,name:"end_date",render:({field:t})=>e.jsxs(f,{children:[e.jsx(p,{children:"End Date"}),e.jsxs(P,{open:c.end_date,onOpenChange:()=>H("end_date"),children:[e.jsx(b,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:`w-full justify-start text-left font-normal ${!t.value&&"text-muted-foreground"}`,children:[t.value?F(t.value,"PP"):"Pick a date",e.jsx(T,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(M,{className:"w-auto p-0",align:"start",children:e.jsx(k,{mode:"single",selected:t.value??void 0,disabled:l=>{const o=n.getValues("start_date");return!!(o&&d(l)<d(o))},onSelect:l=>{const o=d(l);t.onChange(o);const h=n.getValues("start_date");if(h&&o){const S=u(h,o);n.setValue("duration",S)}},initialFocus:!0})})]}),e.jsx(_,{})]})}),e.jsx(y,{control:n.control,name:"duration",render:({field:t})=>e.jsxs(f,{children:[e.jsx(p,{children:"Duration"}),e.jsx(N,{children:e.jsx(C,{type:"text",placeholder:"Duration",...t,value:t.value||"",disabled:!0})}),e.jsx(_,{})]})}),e.jsx(y,{control:n.control,name:"note",render:({field:t})=>e.jsxs(f,{children:[e.jsx(p,{children:"Note"}),e.jsx(N,{children:e.jsx(C,{type:"text",placeholder:"Enter note",...t})}),e.jsx(_,{})]})}),e.jsx("div",{children:e.jsx(g,{variant:"default",type:"submit",className:"w-full mt-4",children:"Update"})})]})})})}function te({data:s}){const[a,c]=j.useState(!1),[m,x]=j.useState(!1),[r,{isLoading:n}]=Z(),d=async u=>{try{await r(u),w.success("Holiday deleted successfully"),c(!1)}catch(i){console.log(i)}};return console.log(s),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(A,{children:e.jsxs(I,{children:[e.jsx(L,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>x(!0),children:e.jsx(K,{className:"h-4 w-4 text-foreground"})})}),e.jsx(O,{children:e.jsx("p",{children:"Update Holiday"})})]})}),e.jsx(A,{children:e.jsxs(I,{children:[e.jsx(L,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>{c(!0)},children:e.jsx(U,{className:"h-4 w-4 text-foreground"})})}),e.jsx(O,{children:e.jsx("p",{children:"Delete Holiday"})})]})}),e.jsx(R,{title:"Are you sure?",description:"This action cannot be undone.",name:s==null?void 0:s.name,isOpen:a,onClose:()=>c(!1),onConfirm:()=>d(s.id),loading:n}),m&&e.jsx(G,{title:"Update Holiday",isOpen:m,toggleModal:()=>x(!1),children:e.jsx(ae,{data:s,modalClose:()=>x(!1)})})]})}const se=[{id:"select",header:({table:s})=>e.jsx(V,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:a=>s.toggleAllPageRowsSelected(!!a),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:s})=>e.jsx(V,{checked:s.getIsSelected(),onCheckedChange:a=>s.toggleSelected(!!a),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"Name"},{accessorKey:"start_date",header:"Start Date",cell:({row:s})=>{const a=s.original.start_date;return a?new Date(a).toLocaleDateString():"N/A"}},{accessorKey:"end_date",header:"End Date",cell:({row:s})=>{const a=s.original.end_date;return a?new Date(a).toLocaleDateString():"N/A"}},{accessorKey:"duration",header:"Duration"},{accessorKey:"note",header:"Note"},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),enableSorting:!1,cell:({row:s})=>e.jsx(te,{data:s.original})}],z={pageIndex:0,pageSize:10},de=()=>{const s=J(),[a,c]=j.useState(z),[m,x]=j.useState(""),{data:r,isLoading:n}=q(`per_page=${a.pageSize}&page=${a.pageIndex+1}&text=${m}`),d=(r==null?void 0:r.data.map(i=>({...i,id:i.id||0})))||[],u=r==null?void 0:r.meta;return n?e.jsx(E,{}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(Q,{title:d.length?"Holiday List":"Add Holiday",description:"Manage your holidays"}),e.jsxs(g,{size:"sm",onClick:()=>s("/hrm/holidays/add"),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"})," Add Holiday"]})]}),e.jsx(B,{}),d.length>0&&e.jsx(W,{columns:se,data:d,paginationInfo:u,pagination:a,setPagination:c,onChangeSearch:i=>{c(z),x(i)}})]})})})};export{de as default};
