import{X as i,a as e,dI as Y,H as p,J as y,N as k,I as C,Q as v,r as Q,dF as te,dN as re,dG as ie,bb as le,bc as de,bd as E,be as ce,bf as oe,bg as g,b1 as R,b2 as J,b3 as K,b4 as W,b6 as Z,V as f,dH as ue,aK as xe,aE as me,y as he,dB as je,dO as be,B as ge,bX as pe,dP as ye,dQ as ve,dR as M,aJ as fe,G as Ne,W as ee,aU as _e,K as S,a9 as L,aa as U,ab as F,aV as $,ac as A,ad as G,bt as we,D as Se,av as H,aw as qe}from"./index-a73d641e.js";const Ce=i.object({item_barcode_id:i.number({required_error:"The barcode id is required."}),unit_id:i.number({required_error:"The unit id is required."}),tax_id:i.number().optional(),price:i.number({required_error:"The price is required."}).nonnegative(),qty:i.number({required_error:"The quantity is required."}).nonnegative(),total:i.number({required_error:"The total is required."}).nonnegative(),note:i.string().optional()}),ae=i.object({contact_id:i.string({required_error:"The contact id field is required."}),reference:i.string().optional(),date:i.string({required_error:"The date field is required."}),delivery_date:i.string().optional(),due_date:i.string().optional(),discount:i.coerce.number().nonnegative().optional().refine(o=>o===void 0||o>=0&&o<=100,{message:"Discount must be between 0 and 100."}),sub_total:i.number({required_error:"The Sub total field is required."}).nonnegative(),total:i.number({required_error:"The total field is required."}).nonnegative(),note:i.string().optional(),terms_conditions:i.string().optional(),tax_type:i.string({required_error:"The tax type field is required."}),tax:i.number({required_error:"Tax is required."}),details:Ce.array().optional()}),Te=ae.extend({});ae.extend({shipping_charges:i.number().nonnegative().optional()});const q=[{id:"inclusive",name:"Inclusive"},{id:"exclusive",name:"Exclusive"}];function Ie({form:o,subTotal:l,discountedAmount:j,totalTaxAmount:N,grandTotal:_,includeShipping:w=!1}){return e.jsx("div",{className:"w-full max-w-lg p-6 border rounded-lg shadow",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Sub Total"}),e.jsx("span",{children:l==null?void 0:l.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Y,{htmlFor:"discount",className:"font-medium",children:"Discount"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{control:o.control,name:"discount",render:({field:b})=>e.jsxs(y,{className:"",children:[e.jsx(k,{children:e.jsx(C,{type:"number",placeholder:"Enter discount amount",...b})}),e.jsx(v,{})]})}),e.jsx("span",{children:"%"})]}),e.jsx("span",{children:j.toFixed(2)})]}),w&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Y,{htmlFor:"shipping_charges",className:"font-medium",children:"Shipping Charges"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(p,{control:o.control,name:"shipping_charges",render:({field:b})=>e.jsxs(y,{className:"",children:[e.jsx(k,{children:e.jsx(C,{type:"number",placeholder:"Shipping charges",...b})}),e.jsx(v,{})]})})}),e.jsx("span",{children:o.watch("shipping_charges")|0})]}),e.jsxs("div",{className:"flex justify-between items-center font-semibold",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:N.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:_?_.toFixed(2):0})]})]})})}function Fe({selectedProducts:o,setSelectedProducts:l}){const[j,N]=Q.useState(""),{data:_,isLoading:w,isError:b}=te(`text=${j}&type=molestiae`,{skip:!j}),{data:P}=re("per_page=1000&page=1"),T=(_==null?void 0:_.data)||[],I=(P==null?void 0:P.data)||[],d=a=>{o.find(r=>r.barcodeId===a.id)||l(r=>{var s;return[...r,{barcodeId:a.id,barcode:a.barcode,barcodeAttribute:a.barcode_attribute,name:a.name,price:((s=a.primary_unit)==null?void 0:s.selling_price)||0,units:[a.primary_unit,a.secondary_unit],unit:a.primary_unit,quantity:1}]}),N("")},D=(a,x)=>{l(r=>r.map(s=>s.barcodeId===a?{...s,quantity:x?s.quantity+1:Math.max(1,s.quantity-1)}:s))},O=(a,x)=>{l(r=>r.map(s=>{if(s.barcodeId===a){const m=s.units.find(h=>h.id===x);return{...s,unit:m,price:m.selling_price}}return s}))},V=(a,x)=>{l(r=>r.map(s=>s.barcodeId===a?{...s,price:x}:s))},B=(a,x)=>{l(r=>r.map(s=>s.barcodeId===a?{...s,tax:I.find(m=>m.id===x)}:s))},c=a=>{l(x=>x.filter(r=>r.barcodeId!==a))};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 relative z-30",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"h-4 px-4 py-[18px] border border-gray-300 flex justify-center items-center rounded-md",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(C,{type:"text",placeholder:"Enter Product Name/Sku/scan barcode",value:j,onChange:a=>N(a.target.value),className:"flex-grow"})]}),j&&!w&&!b&&(T==null?void 0:T.length)>0&&e.jsx("div",{className:"mb-4 absolute ml-14 bg-gray-50 dark:bg-gray-900",children:e.jsx("ul",{className:"border rounded-lg p-2",children:T.map(a=>e.jsxs("li",{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 p-2 text-sm",onClick:()=>d(a),children:[a.name," (Barcode: ",a.barcode,")"]},a.id))})})]}),e.jsxs(le,{children:[e.jsx(de,{className:"border rounded",children:e.jsx(E,{children:["Product Name","Unit","Price","P.O. Quantity","Tax","Total","Note","Action"].map(a=>e.jsx(ce,{children:a},a))})}),e.jsx(oe,{children:(o==null?void 0:o.length)===0?e.jsx(E,{children:e.jsx(g,{colSpan:11,className:"text-center py-5",children:"No products selected yet."})}):e.jsx(e.Fragment,{children:o.map(a=>{var x,r;return e.jsxs(E,{children:[e.jsxs(g,{children:[`${a.name} (${a.barcodeAttribute})`,e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Barcode: ",a.barcode]})]}),e.jsx(g,{children:a.unit&&a.units.length===0?a.unit.name:e.jsx("div",{className:"w-64",children:e.jsxs(R,{onValueChange:s=>O(a.barcodeId,Number(s)),defaultValue:a.unit.id.toString(),children:[e.jsx(J,{children:e.jsx(K,{placeholder:"Select Unit"})}),e.jsx(W,{children:(x=a.units)==null?void 0:x.map(s=>e.jsx(Z,{value:String(s.id),children:s.name},s.id))})]})})}),e.jsx(g,{children:e.jsx("div",{className:"w-48",children:e.jsx(C,{id:"price",type:"number",className:"w-full",defaultValue:a.price,onChange:s=>V(a.barcodeId,Number(s.target.value))})})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{type:"button",size:"icon",variant:"outline",onClick:()=>D(a.barcodeId,!1),children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx("span",{children:a.quantity}),e.jsx(f,{type:"button",size:"icon",variant:"outline",onClick:()=>D(a.barcodeId,!0),children:e.jsx(xe,{className:"h-4 w-4"})})]})}),e.jsx(g,{children:e.jsx("div",{className:"w-64",children:e.jsxs(R,{onValueChange:s=>B(a.barcodeId,Number(s)),defaultValue:(r=a.tax)==null?void 0:r.id.toString(),children:[e.jsx(J,{children:e.jsx(K,{placeholder:"Select Tax"})}),e.jsx(W,{children:I==null?void 0:I.map(s=>e.jsx(Z,{value:String(s.id),children:s.name},s.id))})]})})}),e.jsx(g,{children:(a.price*a.quantity).toFixed(2)}),e.jsx(g,{children:e.jsx("div",{className:"w-64",children:e.jsx(C,{id:"note",type:"text",value:a.note||"",onChange:s=>{l(m=>m.map(h=>h.barcodeId===a.barcodeId?{...h,note:s.target.value}:h))}})})}),e.jsx(g,{children:e.jsx(f,{size:"icon",variant:"destructive",onClick:()=>c(a.barcodeId),children:e.jsx(me,{className:"h-4 w-4"})})})]},a.barcodeId)})})})]})]})}function Pe(){const o=he(),[l,j]=Q.useState([]),[N,_]=Q.useState({sales_order_date:!1,delivery_date:!1,due_date:!1}),w=n=>{_(t=>({...t,[n]:!t[n]}))},{data:b,isLoading:P}=je("page=1&per_page=1000"),T=(b==null?void 0:b.data)||[],[I]=be(),d=ge({resolver:Se(Te),defaultValues:{total:0,tax_type:q[1].id.toString()}}),D=pe(),O=Number(D.id),{data:V}=ye(O,{skip:!O}),[B]=ve(),c=(V==null?void 0:V.data)||void 0;Q.useEffect(()=>{if(c){const n=c.details.map(t=>({barcodeId:t.item_barcode.id,quantity:t.qty,price:t.price,tax:t.tax||void 0,units:[],unit:t.unit,barcode:t.item_barcode.barcode,name:t.item.name,barcodeAttribute:t.item_barcode.barcode_attribute,note:t.note}));j(n),d.reset({discount:c.discount,tax_type:c.tax_type,total:c.total,contact_id:String(c.contact.id),date:c.date||"",due_date:c.due_date||"",delivery_date:c.delivery_date||"",note:c.note||"",terms_conditions:c.terms_conditions||"",sub_total:c.sub_total,reference:c.reference||"",tax:c.tax})}},[c,d]);const a=d.watch("discount"),x=d.watch("tax_type");let r=0,s=0,m=0;l&&l.length>0&&(l==null||l.forEach(n=>{var X;const t=n.price*n.quantity,u=t*(a??0)/100,ne=(t-u)*(Number((X=n.tax)==null?void 0:X.amount)||0)/100;r+=t,s+=u,m+=ne}));let h=r-s+(x==="inclusive"?0:m);r=M(r),s=M(s),m=M(m),h=M(h),d.setValue("sub_total",r),d.setValue("tax",m),d.setValue("total",h);async function se(n){if(l.length===0)return H.error("Please select at least one product");const t={...n,details:l.map(u=>{var z;return{item_barcode_id:u.barcodeId,tax_id:(z=u.tax)==null?void 0:z.id,unit_id:u.unit.id,qty:u.quantity,price:u.price,total:u.price*u.quantity,note:u.note||""}})};try{c?(await B({salesOrderId:O,updatedSalesOrder:t}).unwrap(),H.success("Quote updated successfully")):(await I(t).unwrap(),H.success("Quote created successfully")),o("/billing/quotes")}catch(u){qe(u)}}return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(fe,{title:c?"Edit Quote":"Add quote",description:"Manage your sub accounts for you business"}),e.jsx(f,{onClick:()=>o("/billing/quotes"),size:"sm",children:"quotes List"})]}),e.jsx(Ne,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(se),className:"space-y-3 mb-4  overflow-y-scroll no-scrollbar",children:[e.jsx("div",{className:"",children:e.jsx(ee,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(_e,{loading:P,data:T,displayField:"name",valueField:"id",form:d,name:"contact_id",placeholder:"Select Customer",title:"Customer Name",className:"w-full"}),e.jsx(p,{control:d.control,name:"reference",render:({field:n})=>e.jsxs(y,{children:[e.jsx(S,{children:"Reference"}),e.jsx(k,{children:e.jsx(C,{placeholder:"Enter reference",...n})}),e.jsx(v,{})]})}),e.jsx(p,{control:d.control,name:"date",render:({field:n})=>e.jsxs(y,{children:[e.jsx(S,{children:"Date"}),e.jsxs(L,{open:N.sales_order_date,onOpenChange:()=>w("sales_order_date"),children:[e.jsx(U,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:`w-full justify-start text-left font-normal ${!n.value&&"text-muted-foreground"}`,children:[n.value?F(n.value,"PP"):"Pick a date",e.jsx($,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(A,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(G,{mode:"single",selected:n.value?new Date(n.value):void 0,onSelect:t=>{n.onChange(t?F(t,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(v,{})]})}),e.jsx(p,{control:d.control,name:"due_date",render:({field:n})=>e.jsxs(y,{children:[e.jsx(S,{children:"Due Date"}),e.jsxs(L,{open:N.due_date,onOpenChange:()=>w("due_date"),children:[e.jsx(U,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:`w-full justify-start text-left font-normal ${!n.value&&"text-muted-foreground"}`,children:[n.value?F(n.value,"PP"):"Pick a date",e.jsx($,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(A,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(G,{mode:"single",selected:n.value?new Date(n.value):void 0,onSelect:t=>{n.onChange(t?F(t,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(v,{})]})}),e.jsx(p,{control:d.control,name:"delivery_date",render:({field:n})=>e.jsxs(y,{children:[e.jsx(S,{children:"Delivery Date"}),e.jsxs(L,{open:N.delivery_date,onOpenChange:()=>w("delivery_date"),children:[e.jsx(U,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:`w-full justify-start text-left font-normal ${!n.value&&"text-muted-foreground"}`,children:[n.value?F(n.value,"PP"):"Pick a date",e.jsx($,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(A,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(G,{mode:"single",selected:n.value?new Date(n.value):void 0,onSelect:t=>{n.onChange(t?F(t,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(v,{})]})}),e.jsx("div",{className:"w-full",children:e.jsx(p,{control:d.control,name:"tax_type",render:({field:n})=>{var t;return e.jsxs(y,{children:[e.jsx(S,{children:"Tax Type"}),e.jsxs(R,{onValueChange:n.onChange,defaultValue:String((t=q==null?void 0:q[1])==null?void 0:t.id),children:[e.jsx(k,{children:e.jsx(J,{children:e.jsx(K,{placeholder:"Select Tax Type"})})}),e.jsx(W,{children:q==null?void 0:q.map(u=>e.jsx(Z,{value:String(u.id),children:u.name},u.id))})]}),e.jsx(v,{})]})}})}),e.jsx(p,{control:d.control,name:"note",render:({field:n})=>e.jsxs(y,{children:[e.jsx(S,{children:"Note"}),e.jsx(k,{children:e.jsx(C,{placeholder:"Type Note.",...n})}),e.jsx(v,{})]})}),e.jsx(p,{control:d.control,name:"terms_conditions",render:({field:n})=>e.jsxs(y,{children:[e.jsx(S,{children:"Terms and conditions"}),e.jsx(k,{children:e.jsx(we,{placeholder:"Type terms and conditions.",...n})}),e.jsx(v,{})]})})]})})}),e.jsx(ee,{className:"mb-4",children:e.jsx(Fe,{setSelectedProducts:j,selectedProducts:l})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Ie,{form:d,subTotal:r,discountedAmount:s,totalTaxAmount:m,grandTotal:h})}),e.jsxs("div",{className:"text-right",children:[e.jsx(f,{type:"button",onClick:()=>o("/billing/quotes"),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(f,{variant:"default",type:"submit",className:"w-fit mt-4",children:c?"Update":"Add"})]})]})})]})})}export{Pe as default};
