import{c as ie,cE as te,dc as re,B as R,D as G,dd as de,r as b,a as e,ar as O,G as Q,H as m,J as h,K as j,M as u,I as v,N as p,aQ as z,bp as V,Q as S,as as T,at as F,al as I,U as E,am as _,b as K,aH as B,aD as H,aC as ce,V as L,bU as le,aw as J,ax as W,ay as X,az as xe,aA as Y,aB as me,aE as Z,R as he,aG as je,aU as pe,aV as ue,aJ as ge,y as ye,b4 as fe,de as Ce,df as ve,ag as Ne,ah as be,ai as $,aj as U,ak as D,a6 as Pe,a7 as Se,a8 as ee,aR as Ae,a9 as we,aa as Ee,dg as _e}from"./index-9bbc363d.js";import{S as se}from"./square-pen-4f489892.js";/**
 * @license lucide-react v0.356.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=ie("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),Te=te.injectEndpoints({endpoints:n=>({getCountries:n.query({query:a=>`/countries?${a}`,providesTags:["countries"]})}),overrideExisting:!1}),{useGetCountriesQuery:ke}=Te,Me=te.injectEndpoints({endpoints:n=>({getCities:n.query({query:a=>`/cities?${a}`,providesTags:["cities"]})}),overrideExisting:!1}),{useGetCitiesQuery:Le}=Me,Fe=re.injectEndpoints({endpoints:n=>({getAddresses:n.query({query:a=>`contact-addresses?${a}`,providesTags:["contact-addresses"]}),createAddress:n.mutation({query:a=>({url:"contact-addresses",method:"POST",body:a}),invalidatesTags:["contact-addresses"]}),updateAddress:n.mutation({query:({addressId:a,updatedAddress:r})=>({url:`contact-addresses/${a}`,method:"PUT",body:r}),invalidatesTags:["contact-addresses"]}),removeAddress:n.mutation({query:a=>({url:`contact-addresses/${a}`,method:"DELETE"}),invalidatesTags:["contact-addresses"]})}),overrideExisting:!1}),{useGetAddressesQuery:ae,useCreateAddressMutation:$e,useUpdateAddressMutation:Ie,useRemoveAddressMutation:Oe}=Fe;function qe({modalClose:n,data:a,customer_id:r,addressType:g}){const[N,{isLoading:d}]=$e(),[C,{isLoading:s}]=Ie(),o=R({resolver:G(de)}),x=o.watch("country_id"),{data:y,isLoading:A}=ke("per_page=500"),w=(y==null?void 0:y.data)||[],i=w.find(c=>c.id===Number(x)),{data:P,isLoading:t}=Le(`per_page=500&country=${i==null?void 0:i.code}`,{skip:!i}),f=(P==null?void 0:P.data)||[];b.useEffect(()=>{var c;a&&o.reset({...a,country_id:String(a.country.id),city_id:String((c=a.city)==null?void 0:c.id)})},[o,a]);const k=async c=>{try{a?(await C({addressId:a.id,updatedAddress:{...c,contact_id:r,type:g,country_id:Number(c.country_id),city_id:Number(c.city_id),model_id:r}}).unwrap(),T.success("Address updated successfully"),n()):(await N({...c,contact_id:r,type:g,country_id:Number(c.country_id),city_id:Number(c.city_id)}).unwrap(),T.success("Address created successfully"),n())}catch(q){F(q)}};return e.jsx(e.Fragment,{children:d||s?e.jsx(O,{}):e.jsx(Q,{...o,children:e.jsxs("form",{className:"space-y-3",onSubmit:o.handleSubmit(k),children:[e.jsx("div",{children:e.jsx(m,{control:o.control,name:"attention",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Attention"}),e.jsx(u,{children:e.jsx(v,{placeholder:"Enter attention",...c,value:c.value||""})}),e.jsx(p,{})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(z,{loading:A,data:w,displayField:"name",valueField:"id",form:o,name:"country_id",placeholder:"Select country",title:"Country",className:"w-[305px]"}),e.jsx(z,{loading:t,data:f,displayField:"name",valueField:"id",form:o,name:"city_id",placeholder:"Select city",title:"City",className:"w-[305px]"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(m,{control:o.control,name:"post_code",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Post code"}),e.jsx(u,{children:e.jsx(v,{placeholder:"Enter post code",...c})}),e.jsx(p,{})]})}),e.jsx(m,{control:o.control,name:"state",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"State"}),e.jsx(u,{children:e.jsx(v,{placeholder:"Enter state",...c,value:c.value||""})}),e.jsx(p,{})]})})]}),e.jsx(m,{control:o.control,name:"phone",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Phone"}),e.jsx(u,{children:e.jsx(v,{type:"text",placeholder:"Enter phone number",...c,value:c.value||""})}),e.jsx(p,{})]})}),e.jsx("div",{children:e.jsx(m,{control:o.control,name:"address",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Address"}),e.jsx(u,{children:e.jsx(V,{placeholder:"Enter address",...c,value:c.value||""})}),e.jsx(p,{})]})})}),e.jsxs("div",{className:"flex flex-row-reverse items-center pt-5",children:[e.jsx(S,{variant:"default",type:"submit",className:"w-fit ml-2",children:"Save"}),e.jsx(S,{variant:"primary",type:"button",className:"w-fit",onClick:()=>n(),children:"Cancel"})]})]})})})}const Ue=({customer_id:n})=>{const{data:a,isLoading:r}=ae(`type=Billing&contact_id=${n}`),{data:g,isLoading:N}=ae(`type=Shipping&contact_id=${n}`),d=(a==null?void 0:a.data)||[],C=(g==null?void 0:g.data)||[],[s,{isLoading:o}]=Oe(),[x,y]=b.useState(!1),[A,w]=b.useState(""),[i,P]=b.useState(void 0),[t,f]=b.useState(!1),[k,c]=b.useState(void 0),q=async l=>{try{await s(l).unwrap(),f(!1),T.success("Address deleted successfully")}catch(M){F(M),console.log(M)}};return r||N?e.jsx(O,{}):e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(I,{className:"mb-4 text-xl",children:"Billing Addresses"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[d.length>0&&d.map((l,M)=>e.jsx(E,{children:e.jsxs(_,{className:"p-5 flex items-start gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:K(l.attention||l.phone?"mb-3":""),children:[e.jsx("p",{children:l.attention}),e.jsx("p",{className:"text-sm",children:l.phone})]}),e.jsx("p",{children:`${l.address?l.address:""} ${l.post_code}, ${l.city.name}, ${l.country.name}`})]}),e.jsxs("div",{className:"flex items-center gap-2.5 ml-auto",children:[e.jsx("button",{className:"text-primary",onClick:()=>{P(l),y(!0),w("Billing")},children:e.jsx(se,{size:18})}),e.jsx("button",{onClick:()=>{f(!0),c(l)},className:"text-red-500",children:e.jsx(ne,{size:18})})]})]})},M)),e.jsx(E,{onClick:()=>{y(!0),w("Billing")},children:e.jsx(_,{className:"p-5 cursor-pointer text-center grid place-items-center h-full",children:e.jsxs("div",{className:"flex flex-col gap-1.5 justify-center items-center",children:[e.jsx(B,{}),e.jsx("span",{className:"underline",children:"Add new billing address"})]})})})]}),e.jsx(I,{className:"mb-4 mt-8 text-xl",children:"Shipping Addresses"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[C.length>0&&C.map((l,M)=>e.jsx("div",{children:e.jsx(E,{children:e.jsxs(_,{className:"p-5 flex items-start gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:K(l.attention||l.phone?"mb-3":""),children:[e.jsx("p",{children:l.attention}),e.jsx("p",{className:"text-sm",children:l.phone})]}),e.jsx("p",{children:`${l.address?l.address:""} ${l.post_code}, ${l.city.name}, ${l.country.name}`})]}),e.jsxs("div",{className:"flex items-center gap-2.5 ml-auto",children:[e.jsx("button",{className:"text-primary",onClick:()=>{P(l),y(!0),w("Shipping")},children:e.jsx(se,{size:18})}),e.jsx("button",{className:"text-red-500",onClick:()=>{f(!0),c(l)},children:e.jsx(ne,{size:18})})]})]})})},M)),e.jsx(E,{onClick:()=>{y(!0),w("Shipping")},children:e.jsx(_,{className:"p-5 cursor-pointer text-center grid place-items-center h-full",children:e.jsxs("div",{className:"flex flex-col gap-1.5 justify-center items-center",children:[e.jsx(B,{}),e.jsx("span",{className:"underline",children:"Add new delivery address"})]})})})]}),x&&e.jsx(H,{title:`${i?"Edit":"Add"} ${A} Address`,isOpen:x,toggleModal:()=>{y(!1),P(void 0)},className:"!w-full max-w-2xl",children:e.jsx(qe,{modalClose:()=>{y(!1),P(void 0)},customer_id:n,addressType:A,data:i})}),e.jsx(ce,{title:"Are you sure?",description:"This action cannot be undone.",name:k==null?void 0:k.attention,isOpen:t,onClose:()=>f(!1),onConfirm:()=>q(k.id),loading:o})]})},ze=L.object({name:L.string().min(1,"Name is required"),email:L.string().email("Enter a valid email address"),phone:L.string().min(10,"Mobile number must be at least 10 digits").regex(/^\d+$/,"Mobile number must contain only digits"),note:L.string().optional(),contact_id:L.number()}),Be=re.injectEndpoints({endpoints:n=>({getContactPersons:n.query({query:a=>`contact-persons?${a}`,providesTags:["contact-persons"]}),createContactPerson:n.mutation({query:a=>({url:"contact-persons",method:"POST",body:a}),invalidatesTags:["contact-persons"]}),updateContactPerson:n.mutation({query:({contactPersonId:a,updatedContactPerson:r})=>({url:`contact-persons/${a}`,method:"PUT",body:r}),invalidatesTags:["contact-persons"]}),removeContactPerson:n.mutation({query:a=>({url:`contact-persons/${a}`,method:"DELETE"}),invalidatesTags:["contact-persons"]})}),overrideExisting:!1}),{useGetContactPersonsQuery:Re,useCreateContactPersonMutation:Ge,useUpdateContactPersonMutation:Qe,useRemoveContactPersonMutation:Ve}=Be,oe=({modalClose:n,customer_id:a,data:r})=>{const[g,{isLoading:N}]=Ge(),[d,{isLoading:C}]=Qe();console.log(r);const s=R({resolver:G(ze),defaultValues:{name:"",email:"",phone:"",note:"",contact_id:a}});b.useEffect(()=>{r&&s.reset({...r,contact_id:a})},[a,s,r]);const o=async x=>{try{r?(console.log(r.id),await d({contactPersonId:r==null?void 0:r.id,updatedContactPerson:x}).unwrap(),T.success("Contact person updated successfully"),n()):(await g(x).unwrap(),T.success("Contact person added successfully"),n())}catch(y){F(y)}};return e.jsx(e.Fragment,{children:N||C?e.jsx(O,{}):e.jsx(Q,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(o),className:"space-y-3",children:[e.jsx(m,{control:s.control,name:"name",render:({field:x})=>e.jsxs(h,{children:[e.jsx(j,{children:"Name"}),e.jsx(u,{children:e.jsx(v,{type:"text",placeholder:"Enter name",...x})}),e.jsx(p,{})]})}),e.jsx(m,{control:s.control,name:"email",render:({field:x})=>e.jsxs(h,{children:[e.jsx(j,{children:"Email Address"}),e.jsx(u,{children:e.jsx(v,{type:"email",placeholder:"Enter email address",...x})}),e.jsx(p,{})]})}),e.jsx(m,{control:s.control,name:"phone",render:({field:x})=>e.jsxs(h,{children:[e.jsx(j,{children:"Mobile Number"}),e.jsx(u,{children:e.jsx(v,{type:"text",placeholder:"Enter mobile number",...x})}),e.jsx(p,{})]})}),e.jsx(m,{control:s.control,name:"note",render:({field:x})=>e.jsxs(h,{children:[e.jsx(j,{children:"Note"}),e.jsx(u,{children:e.jsx(V,{placeholder:"Enter your note",...x})}),e.jsx(p,{})]})}),e.jsxs("div",{className:"flex flex-row-reverse items-center pt-5",children:[e.jsx(S,{variant:"default",type:"submit",className:"w-fit ml-2",children:"Save"}),e.jsx(S,{variant:"primary",type:"button",className:"w-fit",onClick:()=>n(),children:"Cancel"})]})]})})})};function He({data:n}){const a=le(),r=Number(a.id),[g,N]=b.useState(!1),[d,C]=b.useState(!1),[s,{isLoading:o}]=Ve(),x=async y=>{try{await s(y).unwrap(),N(!1),T.success("Item deleted successfully")}catch(A){F(A),console.log(A)}};return e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(J,{children:e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>C(!0),children:e.jsx(xe,{className:"h-4 w-4 text-foreground"})})}),e.jsx(Y,{children:e.jsx("p",{children:"Update Contact Person"})})]})}),e.jsx(J,{children:e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>{N(!0)},children:e.jsx(me,{className:"h-4 w-4 text-foreground"})})}),e.jsx(Y,{children:e.jsx("p",{children:"Delete Contact Person"})})]})}),d&&e.jsx(H,{title:"Update Contact Person",isOpen:d,toggleModal:()=>{C(!1)},className:"!w-full max-w-lg",children:e.jsx(oe,{modalClose:()=>{C(!1)},customer_id:r,data:n})}),e.jsx(ce,{title:"Are you sure?",description:"This action cannot be undone.",name:n.name,isOpen:g,onClose:()=>N(!1),onConfirm:()=>x(n.id),loading:o})]})}const Ke=[{id:"select",header:({table:n})=>e.jsx(Z,{checked:n.getIsAllPageRowsSelected()||n.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:a=>n.toggleAllPageRowsSelected(!!a),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:n})=>e.jsx(Z,{checked:n.getIsSelected(),onCheckedChange:a=>n.toggleSelected(!!a),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"Name",cell:({row:n})=>e.jsx(e.Fragment,{children:n.original.name})},{accessorKey:"email",header:"Email",cell:({row:n})=>e.jsx(e.Fragment,{children:n.original.email})},{accessorKey:"phone",header:"Phone",cell:({row:n})=>e.jsx(e.Fragment,{children:n.original.phone})},{accessorKey:"note",header:"Note",cell:({row:n})=>e.jsx(e.Fragment,{children:n.original.note})},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),enableSorting:!1,cell:({row:n})=>e.jsx(He,{data:n.original})}],Je=({customer_id:n})=>{const[a,r]=b.useState(!1),[g,N]=he.useState({pageIndex:0,pageSize:10}),{data:d,isLoading:C}=Re(`contact_id=${n}&per_page=${g.pageSize}&page=${g.pageIndex+1}`),s=(d==null?void 0:d.data)||[],o=d==null?void 0:d.meta;return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsx(je,{title:"Contact person",description:"Manage all items for you business"}),e.jsxs(S,{size:"sm",onClick:()=>r(!0),children:[e.jsx(B,{className:"mr-2 h-4 w-4"})," Add Contact Person"]})]}),e.jsx(pe,{}),C&&e.jsx(ue,{}),e.jsx("div",{children:e.jsx(ge,{columns:Ke,data:s,paginationInfo:o,pagination:g,setPagination:N})}),a&&e.jsx(H,{title:"Add Contact Person",isOpen:a,toggleModal:()=>{r(!1)},className:"!w-full max-w-lg",children:e.jsx(oe,{modalClose:()=>{r(!1)},customer_id:n})})]})},We=Je;function Ze(){const n=ye(),a=le(),r=Number(a.id),[g,N]=b.useState({date:!1}),{data:d,isLoading:C}=fe("page=1&per_page=1000"),{data:s,isLoading:o}=Ce(r,{skip:!r}),x=(d==null?void 0:d.data)||[],[y,{isLoading:A}]=ve(),w=t=>{N(f=>({...f,[t]:!f[t]}))},i=R({resolver:G(_e),defaultValues:{}});b.useEffect(()=>{s!=null&&s.data&&i.reset({name:(s==null?void 0:s.data.name)||"",email:(s==null?void 0:s.data.email)||"",phone:(s==null?void 0:s.data.phone)||"",work_phone:(s==null?void 0:s.data.work_phone)||"",opening_balance:String(s==null?void 0:s.data.opening_balance)||"",note:(s==null?void 0:s.data.note)||"",date:(s==null?void 0:s.data.date)||"",company_name:(s==null?void 0:s.data.company_name)||"",company_id:(s==null?void 0:s.data.company_id)||"",location_id:String(s==null?void 0:s.data.location.id)||""})},[s==null?void 0:s.data,i]);async function P(t){console.log(t);try{await y({updatedCustomer:{...t,location_id:Number(t.location_id),opening_balance:Number(t.opening_balance)},customerId:r}).unwrap(),T.success("Customer updated successfully")}catch(f){F(f),console.log(f)}}return o?e.jsx(O,{}):e.jsxs(Ne,{defaultValue:"customer",className:"max-w-[1000px] mx-auto mt-10",children:[e.jsxs(be,{className:"grid w-full grid-cols-4",children:[e.jsx($,{value:"customer",children:"Customer Details"}),e.jsx($,{value:"address",children:"Address"}),e.jsx($,{value:"contact_person",children:"Contact Person"}),e.jsx($,{value:"attachment",children:"Attachment"})]}),e.jsx(Q,{...i,children:e.jsx("form",{onSubmit:i.handleSubmit(P),className:"space-y-3 max-w-[1200px] mx-auto",children:e.jsx(U,{value:"customer",children:e.jsxs(E,{children:[e.jsx(D,{children:e.jsx(I,{children:"Edit Customer "})}),e.jsxs(_,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[e.jsx(m,{control:i.control,name:"name",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Full Name"}),e.jsx(u,{children:e.jsx(v,{className:"",placeholder:"Enter full name",...t})}),e.jsx(p,{})]})}),e.jsx(m,{control:i.control,name:"company_name",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Company Name"}),e.jsx(u,{children:e.jsx(v,{className:"",placeholder:"Enter company name",...t})}),e.jsx(p,{})]})}),e.jsx(m,{control:i.control,name:"company_id",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Customer Id"}),e.jsx(u,{children:e.jsx(v,{type:"text",placeholder:"Enter customer Id",...t})}),e.jsx(p,{})]})}),e.jsx(m,{control:i.control,name:"work_phone",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Work Phone"}),e.jsx(u,{children:e.jsx(v,{type:"text",placeholder:"Enter work phone",...t})}),e.jsx(p,{})]})}),e.jsx(m,{control:i.control,name:"phone",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Phone number"}),e.jsx(u,{children:e.jsx(v,{type:"text",placeholder:"Enter phone number",...t})}),e.jsx(p,{})]})}),e.jsx(m,{control:i.control,name:"email",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Email Address"}),e.jsx(u,{children:e.jsx(v,{type:"email",placeholder:"Enter email address",...t})}),e.jsx(p,{})]})}),e.jsx(m,{control:i.control,name:"opening_balance",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Opening Balance"}),e.jsx(u,{children:e.jsx(v,{placeholder:"Enter opening balance",...t})}),e.jsx(p,{})]})}),e.jsx(m,{control:i.control,name:"date",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Date"}),e.jsxs(Pe,{open:g.date,onOpenChange:()=>w("date"),children:[e.jsx(Se,{asChild:!0,children:e.jsxs(S,{variant:"outline",className:`w-full justify-start text-left font-normal ${!t.value&&"text-muted-foreground"}`,children:[t.value?ee(t.value,"PP"):"Pick a date",e.jsx(Ae,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(we,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(Ee,{mode:"single",selected:t.value?new Date(t.value):void 0,onSelect:f=>{t.onChange(f?ee(f,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(p,{})]})}),e.jsx(z,{loading:C,data:x,displayField:"name",valueField:"id",form:i,name:"location_id",placeholder:"Location",title:"Location",className:"w-[300px]"}),e.jsx(m,{control:i.control,name:"note",render:({field:t})=>e.jsxs(h,{className:"col-span-2",children:[e.jsx(j,{children:"Note"}),e.jsx(u,{children:e.jsx(V,{placeholder:"Enter note",...t})}),e.jsx(p,{})]})})]}),e.jsxs("div",{className:"flex flex-row-reverse items-center pt-5",children:[e.jsx(S,{variant:"default",type:"submit",className:"w-fit ml-2",children:A?"Saving":"Save"}),e.jsx(S,{variant:"primary",type:"button",className:"w-fit",onClick:()=>n("/billing/customers"),children:"Cancel"})]})]})]})})})}),e.jsx(U,{value:"address",children:e.jsxs(E,{children:[e.jsx(D,{children:e.jsx(I,{children:"Address"})}),e.jsx(_,{className:"space-y-2",children:e.jsx("div",{className:"flex flex-col gap-5",children:e.jsx(Ue,{customer_id:r})})})]})}),e.jsx(U,{value:"contact_person",children:e.jsx(E,{children:e.jsx(_,{className:"space-y-2",children:e.jsx("div",{className:"flex flex-col gap-5",children:e.jsx(We,{customer_id:r})})})})})]})}export{Ze as default};
