import{Z as i,B as V,r as h,d$ as _,e0 as z,E as B,b_ as D,e1 as G,a as e,aL as U,X as c,J,Y as g,K as y,N,Q as f,V as v,I as x,W as S,b3 as Q,b4 as R,b5 as Y,b6 as H,b8 as P,aG as K,aM as W,G as X,ax as o,ay as Z}from"./index-a548e147.js";const $=i.object({id:i.number({required_error:"The ID is required."}),name:i.string({required_error:"The name is required."}),probability:i.number({required_error:"The probability is required."})}),C=i.object({name:i.string().min(2,{message:"Name must be at least 2 characters."}),status:i.union([i.literal(1),i.literal(0)]).default(1),details:$.array().optional()});C.extend({id:i.coerce.number().int()});function ee(){const m=V(),[n,d]=h.useState([]),[w,{isLoading:F}]=_(),[E,{isLoading:I}]=z(),l=B({resolver:X(C),defaultValues:{name:"",status:1,details:[]}}),q=D(),p=Number(q.id),{data:u}=G(p,{skip:!p}),t=(u==null?void 0:u.data)||void 0;h.useEffect(()=>{t&&t.details&&d(t.details.map(s=>({...s})))},[t]),h.useEffect(()=>{t&&l.reset({name:t.name,status:t.status})},[t]);const A=()=>{d([...n,{probability:0,name:"",id:0}])},j=(s,a)=>{const{name:r,value:M}=a.target;d(n.map((b,T)=>T===s?{...b,[r]:M}:b))};async function k(s){if(n.length===0)return o.error("Please add at least one Stage");const a={...s,details:n};try{t?(await E({pipelineId:p,updatedPipeline:a}).unwrap(),o.success("Pipeline updated successfully")):(await w(a).unwrap(),o.success("Pipeline created successfully")),m("/crm/lead/pipelines")}catch(r){Z(r)}}const L=s=>{if(n.length<=1)return o.error("You must have at least one stage.");d(n.filter((a,r)=>r!==s))};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(U,{title:t?"Edit Pipeline":"Add Pipeline",description:"Manage your pipelines"}),e.jsx(c,{onClick:()=>m("/crm/lead/pipelines"),size:"sm",children:"Pipeline List"})]}),e.jsx(J,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(k),className:"space-y-3",children:[e.jsx(g,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(y,{control:l.control,name:"name",render:({field:s})=>e.jsxs(N,{children:[e.jsx(f,{children:"Pipeline Name"}),e.jsx(v,{children:e.jsx(x,{placeholder:"Enter Pipeline Name",...s})}),e.jsx(S,{})]})}),e.jsx(y,{control:l.control,name:"status",render:({field:s})=>e.jsxs(N,{children:[e.jsx(f,{children:"Status"}),e.jsxs(Q,{onValueChange:a=>s.onChange(Number(a)),value:String(s.value),children:[e.jsx(v,{children:e.jsx(R,{children:e.jsx(Y,{placeholder:"Select Status"})})}),e.jsxs(H,{children:[e.jsx(P,{value:"1",children:"Active"}),e.jsx(P,{value:"0",children:"Inactive"})]})]}),e.jsx(S,{})]})})]})}),e.jsxs(g,{className:"p-4",children:[e.jsx("div",{className:"mb-4 font-medium",children:"Pipeline Stages"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-4 py-2 border",children:"Name"}),e.jsx("th",{className:"px-4 py-2 border",children:"Probability (%)"}),e.jsx("th",{className:"px-4 py-2 border"})]})}),e.jsx("tbody",{children:n.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:e.jsx(x,{name:"name",value:s.name,onChange:r=>j(a,r)})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx(x,{type:"number",name:"probability",value:s.probability,onChange:r=>j(a,r),min:"1",step:"1"})}),e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>L(a),children:e.jsx(K,{className:"h-4 w-4 text-red-500"})})})]},a))})]})}),e.jsxs(c,{type:"button",onClick:A,className:"mt-2",children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," Add Stage"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{type:"button",onClick:()=>m("/crm/lead/pipelines"),className:"mr-2",variant:"ghost",children:"Cancel"}),e.jsx(c,{disabled:!l.formState.isValid||F||I||n.length===0,type:"submit",children:t?"Update":"Add"})]})]})})]})}export{ee as default};
