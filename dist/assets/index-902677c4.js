import{ar as ie,aE as re,V as oe,W as me,r as c,A as m,a as e,Y as Z,Z as xe,aC as H,_ as L,$ as j,a0 as x,aj as he,a1 as y,ak as je,al as ue,am as ge,an as fe,a2 as S,y as z,z as K,B as p,aD as G,D as Q,E as B,I as v,c5 as ye,c6 as Se,a3 as M,a4 as pe,a5 as E,a6 as P,a7 as J,a8 as _e,a9 as b,aa as Ne,ab as we,ac as X,ad as W,R as Le,ae as Te,t as ve,af as Ce,ag as Re}from"./index-dac9cfc2.js";import{u as qe,l as Fe}from"./index-8681a7e4.js";import{S as Ee}from"./switch-52c460a9.js";import{D as Y}from"./format-dates-585a493a.js";const Pe=ie.injectEndpoints({endpoints:l=>({getLeaveRequests:l.query({query:s=>`leaves?${s}`,providesTags:["leaves"]}),createLeaveRequest:l.mutation({query:s=>({url:"leaves",method:"POST",body:s}),invalidatesTags:["leaves"]}),removeLeaveRequest:l.mutation({query:s=>({url:`leaves/${s}`,method:"DELETE"}),invalidatesTags:["leaves"]}),updateLeaveRequest:l.mutation({query:({leaveRequestId:s,updatedLeaveRequest:i})=>({url:`leaves/${s}`,method:"POST",body:i}),invalidatesTags:["leaves"]})}),overrideExisting:!1}),{useGetLeaveRequestsQuery:be,useCreateLeaveRequestMutation:Me,useRemoveLeaveRequestMutation:$e,useUpdateLeaveRequestMutation:Ae}=Pe;function D({modalClose:l,data:s,refetch:i}){const[u,{isLoading:d}]=Me(),[_,{isLoading:N}]=Ae(),{data:o,isLoading:g}=re("page=1&per_page=1000"),{data:f,isLoading:C}=qe("per_page=1000&page=1"),R=(f==null?void 0:f.data)||[],$=(o==null?void 0:o.data)||[];console.log($);const a=oe({resolver:me(Fe),defaultValues:{employee_id:(s==null?void 0:s.employee_id.toString())||"",start_date_time:(s==null?void 0:s.start_date_time)||"",end_date_time:(s==null?void 0:s.end_date_time)||"",subject:(s==null?void 0:s.subject)||"",description:(s==null?void 0:s.description)||"",leave_type_id:(s==null?void 0:s.leave_type.id.toString())||"",status:(s==null?void 0:s.status)||"Pending",files:(s==null?void 0:s.files)||[]}}),[ee,A]=c.useState(!1),[se,O]=c.useState(!1),[r,k]=c.useState(null),[h,I]=c.useState(null),[le,te]=c.useState([]),[q,ae]=c.useState(!1),[w,U]=c.useState(""),[T,V]=c.useState(""),F=["Pending","Canceled","Approved","Rejected"];c.useEffect(()=>{s&&(U(m(new Date(s==null?void 0:s.start_date_time),"HH:mm")),V(m(new Date(s==null?void 0:s.end_date_time),"HH:mm")),k(new Date(s==null?void 0:s.start_date_time)),I(new Date(s==null?void 0:s.end_date_time)))},[s]),console.log(w);const ne=t=>{if(!t)return;k(t);const n=w||"12:00";console.log(n,"validTimeStart"),a.setValue("start_date_time",`${m(t,"yyyy-MM-dd")} ${n}:00`),A(!1)},ce=t=>{if(!t)return;I(t);const n=T||"23:59";a.setValue("end_date_time",`${m(t,"yyyy-MM-dd")} ${n}:00`),O(!1)};c.useEffect(()=>{if(r){const t=w||"12:00";a.setValue("start_date_time",`${m(r,"yyyy-MM-dd")} ${t}:00`)}},[w,r,a]),c.useEffect(()=>{if(h){const t=T||"23:59";a.setValue("end_date_time",`${m(h,"yyyy-MM-dd")} ${t}:00`)}},[T,h,a]);async function de(t){console.log(t);try{const n=Se.serialize({...t,_method:s?"PUT":"POST",files:le},{indices:!0});s?(await _({leaveRequestId:s.id,updatedLeaveRequest:n}).unwrap(),M.success("Leave Request updated successfully"),l()):(await u(n).unwrap(),M.success("Leave Request created successfully"),l())}catch(n){console.log(n),pe(n)}}return console.log(),e.jsx(e.Fragment,{children:d||N?e.jsx("div",{children:e.jsx(Z,{})}):e.jsx(xe,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(de),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(H,{loading:g,data:$,displayField:"first_name",valueField:"id",form:a,name:"employee_id",title:"Employee",className:"w-[460px]"})}),e.jsx("div",{className:"w-full",children:e.jsx(H,{loading:C,data:R,displayField:"name",valueField:"id",form:a,name:"leave_type_id",title:"Leave Type",className:"w-[290px]"})}),s&&e.jsx("div",{className:"w-full",children:e.jsx(L,{control:a.control,name:"status",render:({field:t})=>e.jsxs(j,{children:[e.jsx(x,{children:"Status"}),e.jsxs(he,{onValueChange:t.onChange,defaultValue:s.status?String(s.status):void 0,children:[e.jsx(y,{children:e.jsx(je,{children:e.jsx(ue,{placeholder:"Select Status"})})}),e.jsx(ge,{children:F==null?void 0:F.map(n=>e.jsx(fe,{value:String(n),children:n},n))})]}),e.jsx(S,{})]})})})]}),e.jsxs("div",{className:"flex justify-between items-center gap-x-4",children:[e.jsxs("div",{className:"w-full flex items-center gap-x-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(L,{control:a.control,name:"start_date_time",render:()=>e.jsxs(j,{children:[e.jsx(x,{children:"Start Date"}),e.jsxs(z,{open:ee,onOpenChange:A,children:[e.jsx(K,{asChild:!0,className:"",children:e.jsxs(p,{variant:"outline",className:`w-full justify-start text-left font-normal ${!r&&"text-muted-foreground"}`,children:[r?m(r,"PP"):"Pick a date",e.jsx(G,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(Q,{className:"w-auto p-0",align:"start",children:e.jsx(B,{mode:"single",selected:r??void 0,onSelect:ne,initialFocus:!0})})]})]})})}),q&&e.jsx("div",{className:"w-full",children:e.jsxs(j,{children:[e.jsx(x,{children:"Time Start"}),e.jsx(y,{children:e.jsx(v,{type:"time",value:w,onChange:t=>U(t.target.value)})}),e.jsx(S,{})]})})]}),e.jsxs("div",{className:"w-full flex items-center gap-x-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(L,{control:a.control,name:"end_date_time",render:()=>e.jsxs(j,{children:[e.jsx(x,{children:"End Date"}),e.jsxs(z,{open:se,onOpenChange:O,children:[e.jsx(K,{asChild:!0,className:"",children:e.jsxs(p,{variant:"outline",className:`w-full justify-start text-left font-normal ${!h&&"text-muted-foreground"}`,children:[h?m(h,"PP"):"Pick a date",e.jsx(G,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(Q,{className:"w-auto p-0",align:"start",children:e.jsx(B,{mode:"single",disabled:t=>!!(r&&t<r),selected:h??void 0,onSelect:ce,initialFocus:!0})})]}),e.jsx(S,{})]})})}),q&&e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"w-full",children:e.jsxs(j,{children:[e.jsx(x,{children:"Time End"}),e.jsx(y,{children:e.jsx(v,{type:"time",value:T,onChange:t=>V(t.target.value)})}),e.jsx(S,{})]})})})]})]}),e.jsx("div",{}),e.jsxs("div",{className:"!mt-5 flex justify-start items-center",children:[e.jsx(y,{children:e.jsx(Ee,{className:" ",checked:q,onCheckedChange:t=>ae(!!t)})}),e.jsx("span",{className:"ml-2 text-sm",children:"Consider Hours"})]}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(L,{control:a.control,name:"subject",render:({field:t})=>e.jsxs(j,{children:[e.jsx(x,{children:"Subject"}),e.jsx(y,{children:e.jsx(v,{className:"",placeholder:"Enter Subject",...t,value:t.value||""})}),e.jsx(S,{})]})})}),e.jsx("div",{className:"w-full",children:e.jsx(L,{control:a.control,name:"description",render:({field:t})=>e.jsxs(j,{children:[e.jsx(x,{children:"Description"}),e.jsx(y,{children:e.jsx(v,{className:"",placeholder:"Enter Description",...t,value:t.value||""})}),e.jsx(S,{})]})})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Upload Files"}),e.jsx(ye,{setUploadedFiles:te,uploadedFiles:s==null?void 0:s.files,onDeleteSuccess:()=>i()})]})]}),e.jsx("div",{className:"text-right",children:e.jsx(p,{variant:"default",type:"submit",className:"w-fit mt-4",children:s?"Update":"Add"})})]})})})}function Oe({data:l}){var g,f;const[s,i]=c.useState(!1),[u,d]=c.useState(!1),[_,{isLoading:N}]=$e(),o=async C=>{try{await _(C),M.success("Leave deleted successfully"),i(!1)}catch(R){console.log(R)}};return e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(E,{children:e.jsxs(P,{children:[e.jsx(J,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>d(!0),children:e.jsx(_e,{className:"h-4 w-4 text-foreground"})})}),e.jsx(b,{children:e.jsx("p",{children:"Update Leave Request"})})]})}),e.jsx(E,{children:e.jsx(P,{children:e.jsx(b,{children:e.jsx("p",{children:"Delete Leave Request"})})})}),e.jsx(E,{children:e.jsxs(P,{children:[e.jsx(J,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>{i(!0)},children:e.jsx(Ne,{className:"h-4 w-4 text-foreground"})})}),e.jsx(b,{children:e.jsx("p",{children:"Delete Requisition"})})]})}),e.jsx(we,{title:"Are you sure?",description:"This action cannot be undone.",name:((g=l==null?void 0:l.employee)==null?void 0:g.first_name)+" "+((f=l==null?void 0:l.employee)==null?void 0:f.last_name),isOpen:s,onClose:()=>i(!1),onConfirm:()=>o(l.id),loading:N}),u&&e.jsx(X,{title:"Update Leave Request",isOpen:u,toggleModal:()=>d(!1),className:"w-3/5 max-w-3xl",children:e.jsx(D,{data:l,modalClose:()=>d(!1)})})]})}const ke=[{id:"select",header:({table:l})=>e.jsx(W,{checked:l.getIsAllPageRowsSelected()||l.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:s=>l.toggleAllPageRowsSelected(!!s),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:l})=>e.jsx(W,{checked:l.getIsSelected(),onCheckedChange:s=>l.toggleSelected(!!s),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"Employee name",cell:({row:l})=>l.original.employee.first_name+" "+l.original.employee.last_name},{accessorKey:"leave_type",header:"Leave type",cell:({row:l})=>l.original.leave_type.name},{accessorKey:"start_date_time",header:"Start Date",cell:({row:l})=>Y(l.original.start_date_time)},{accessorKey:"end_date_time",header:"End Date",cell:({row:l})=>Y(l.original.end_date_time)},{accessorKey:"status",header:"Status"},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),enableSorting:!1,cell:({row:l})=>e.jsx(Oe,{data:l.original})}],ze=()=>{const[l,s]=c.useState(!1),[i,u]=Le.useState({pageIndex:0,pageSize:10}),{data:d,isLoading:_,refetch:N}=be(`per_page=${i.pageSize}&page=${i.pageIndex+1}`),o=(d==null?void 0:d.data)||[],g=d==null?void 0:d.meta;return _?e.jsx(Z,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Te,{title:"Leave Request",description:"Manage job apply for you business"}),e.jsxs(p,{onClick:()=>s(!0),size:"sm",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Add Leave Request"]})]}),e.jsx(Ce,{}),o&&e.jsx("div",{children:e.jsx(Re,{columns:ke,data:o,paginationInfo:g,pagination:i,setPagination:u})})]})}),l&&e.jsx(X,{title:"Add Leave Request",isOpen:l,toggleModal:()=>s(!1),className:"w-3/5 max-w-3xl",children:e.jsx(D,{refetch:N,modalClose:()=>s(!1)})})]})};export{ze as default};
