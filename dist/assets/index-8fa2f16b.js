import{cf as I,bp as q,r as o,bY as V,E as B,a as e,aw as z,J as R,K as b,N,Q as L,V as A,bb as H,W as F,ck as J,bx as W,X as C,ax as k,ay as Y,b$ as U,c2 as X,c3 as Z,c1 as ee,Y as ae,bm as te,bV as v,c4 as se,ad as ne,aL as ce,aM as re,aN as le,aO as ie,aI as oe,al as de,am as he,an as _,ao as K,ap as O,aq as M,ar as E}from"./index-d9d166ce.js";const ue=[{accessorKey:"employee.name",header:"Employee Name"},{accessorKey:"employee.location.name",header:"Location"},{accessorKey:"employee.department.name",header:"Department"},{accessorKey:"employee.section.name",header:"Section"},{accessorKey:"employee.designation.name",header:"Designation"},{accessorKey:"check_in",header:"Check In",cell:({row:a})=>{var t;return a.original.check_in&&I((t=a.original)==null?void 0:t.check_in)}},{accessorKey:"check_out",header:"Check out",cell:({row:a})=>{var t;return a.original.check_out&&I((t=a.original)==null?void 0:t.check_out)}},{accessorKey:"note",header:"Note"}],me=q.injectEndpoints({endpoints:a=>({getAttendanceList:a.query({query:t=>`attendances?${t}`,providesTags:["attendance-list"]}),createAttendanceCheckIn:a.mutation({query:t=>({url:"attendance-check-in",method:"POST",body:t}),invalidatesTags:["attendance-list"]}),createAttendanceCheckOut:a.mutation({query:t=>({url:"attendance-check-out",method:"POST",body:t}),invalidatesTags:["attendance-list"]})}),overrideExisting:!1}),{useGetAttendanceListQuery:pe,useCreateAttendanceCheckInMutation:xe,useCreateAttendanceCheckOutMutation:ye}=me;function $({tab:a,modalClose:t}){const[m,p]=o.useState([]),[d]=V(),[g,{isLoading:h}]=xe(),[S,{isLoading:u}]=ye(),r=B({defaultValues:{date_time:new Date}}),i=async s=>{const n=s.trim()||"";try{const{data:c}=await d(`per_page=15&page=1&text=${n}`).unwrap();return(c==null?void 0:c.map(x=>({value:String(x.id),label:`${x.first_name} ${x.last_name} (${x.id})`})))||[]}catch(c){return console.error("Error fetching employees:",c),[]}},y=async s=>{try{a==="check-in"?(await g(s).unwrap(),k.success("CheckIn created successfully!")):(await S(s).unwrap(),k.success("CheckOut created successfully!")),t()}catch(n){console.error("Error recording attendance:",n),Y(n)}};return e.jsx(e.Fragment,{children:h||u?e.jsx("div",{className:"h-56",children:e.jsx(z,{})}):e.jsx(R,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(y),className:"w-full space-y-3",children:[e.jsx(b,{control:r.control,name:"employee_ids",render:({field:s})=>e.jsxs(N,{children:[e.jsx(L,{children:"Employee Name"}),e.jsx(A,{children:e.jsx(H,{...s,value:m,onSearch:n=>i(n||""),onChange:n=>{p(n),s.onChange(n.map(c=>parseInt(c.value)))},triggerSearchOnFocus:!0,hidePlaceholderWhenSelected:!0,placeholder:"Search and select options",loadingIndicator:e.jsx("p",{className:"py-2 text-center leading-10 text-muted-foreground",children:"loading..."}),emptyIndicator:e.jsx("p",{className:"w-full text-center leading-10 text-muted-foreground",children:"no results found."})})}),e.jsx(F,{})]})}),e.jsx(b,{control:r.control,name:"date_time",render:({field:s})=>e.jsxs(N,{children:[e.jsx(L,{children:"Punch Time"}),e.jsx(A,{className:"",children:e.jsx(J,{...s,displayFormat:{hour12:"yyyy/MM/dd h:mm a"},value:s.value,onChange:s.onChange,granularity:"minute",hourCycle:12})}),e.jsx(F,{})]})}),e.jsx(b,{control:r.control,name:"note",render:()=>e.jsxs(N,{children:[e.jsx(L,{children:"Note"}),e.jsx(A,{children:e.jsx(W,{...r.register("note")})}),e.jsx(F,{})]})}),e.jsx("div",{children:e.jsx(C,{variant:a==="check-in"?"default":"destructive",type:"submit",className:"w-full mt-4",disabled:h||u,children:h||u?"Submitting...":a==="check-in"?"Check In":"Check Out"})})]})})})}function ge({setFilterParams:a}){const[t,{data:m}]=U(),[p,{data:d}]=X(),[g,{data:h}]=Z(),[S,{data:u}]=ee(),[r,i]=o.useState(void 0),[y,s]=o.useState(void 0),[n,c]=o.useState(void 0),[x,T]=o.useState(void 0),[f,w]=o.useState(void 0),D=()=>{const l=f?ne(f,"yyyy-MM-dd"):"",j=new URLSearchParams;r&&j.append("department_id",r.id.toString()),y&&j.append("location_id",y.id.toString()),n&&j.append("schedule_id",n.id.toString()),x&&j.append("section_id",x.id.toString()),f&&j.append("date",l.toString());const G=j.toString();a(G),k.success("Filters applied successfully")},Q=()=>{i(void 0),s(void 0),c(void 0),T(void 0),w(void 0),a(""),k.success("Filters reset successfully")};return e.jsx(ae,{className:"w-full p-5",children:e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"space-y-2 flex flex-col py-0",children:e.jsx(te,{selected:f,onChange:l=>{w(l??void 0)},dateFormat:"dd/MM/yyyy",placeholderText:"Select date",className:"border rounded p-[6px] w-full bg-none bg_remove"})}),e.jsx(v,{items:(m==null?void 0:m.data)||[],labelKey:"name",valueKey:"id",value:r,placeholder:"Select Department",onSelect:i,onChangeSearch:l=>t(`text=${l}`)}),e.jsx(v,{items:(d==null?void 0:d.data)||[],labelKey:"name",valueKey:"id",value:y,placeholder:"Select Location",onSelect:s,onChangeSearch:l=>p(`text=${l}`)}),e.jsx(v,{items:(h==null?void 0:h.data)||[],labelKey:"name",valueKey:"id",value:n,placeholder:"Select Shift",onSelect:c,onChangeSearch:l=>g(`text=${l}`)}),e.jsx(v,{items:(u==null?void 0:u.data)||[],labelKey:"name",valueKey:"id",value:x,placeholder:"Select Section",onSelect:T,onChangeSearch:l=>S(`text=${l}`)}),e.jsx(C,{variant:"outline",size:"sm",onClick:Q,children:"Reset Filters"}),e.jsxs(C,{variant:"default",size:"sm",onClick:D,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Apply Filters"]})]})})}const P={pageIndex:0,pageSize:10},Se=()=>{const[a,t]=o.useState("check-in"),[m,p]=o.useState(!1),[d,g]=o.useState(P),[h,S]=o.useState(""),[u,r]=o.useState(""),{data:i,isLoading:y}=pe(`per_page=${d.pageSize}&page=${d.pageIndex+1}&text=${u}&${h}`),s=(i==null?void 0:i.data)||[],n=i==null?void 0:i.meta;return y?e.jsx(z,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ce,{title:"Attendance List",description:"Manage job apply for your business"}),e.jsxs(C,{onClick:()=>p(!0),size:"sm",children:[e.jsx(re,{className:"mr-2 h-4 w-4"})," Add Attendance"]})]}),e.jsx(ge,{setFilterParams:S}),e.jsx(le,{}),e.jsx(ie,{columns:ue,data:s,paginationInfo:n,pagination:d,setPagination:g,className:"py-2 px-4",onChangeSearch:c=>{g(P),r(c)}})]})}),m&&e.jsx(oe,{title:"Add Attendance List",isOpen:m,toggleModal:()=>p(!1),className:"w-fit",children:e.jsxs(de,{defaultValue:a,onValueChange:c=>t(c),className:"w-[400px] mx-auto",children:[e.jsxs(he,{className:"grid w-full grid-cols-2 my-2",children:[e.jsx(_,{value:"check-in",children:"Check In"}),e.jsx(_,{value:"check-out",children:"Check Out"})]}),e.jsxs(K,{value:"check-in",children:[e.jsx(O,{children:e.jsx(M,{children:"Check In"})}),e.jsx(E,{className:"space-y-2",children:e.jsx("div",{className:"space-y-1",children:e.jsx($,{modalClose:()=>p(!1),tab:a})})})]}),e.jsxs(K,{value:"check-out",children:[e.jsx(O,{children:e.jsx(M,{children:"Check Out"})}),e.jsx(E,{className:"space-y-2",children:e.jsx("div",{className:"space-y-1",children:e.jsx($,{modalClose:()=>p(!1),tab:a})})})]})]})})]})};export{Se as default};
