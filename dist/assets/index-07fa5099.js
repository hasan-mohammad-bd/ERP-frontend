import{c7 as T,bi as D,r as l,aT as K,B as G,a as e,ar as _,G as Q,H as S,J as k,K as v,M as N,b5 as q,N as b,bp as H,Q as A,as as F,at as $,aF as z,U as J,cc as R,a7 as V,a8 as E,aR as B,a9 as U,aa as W,bQ as X,aG as Y,aH as Z,aI as ee,aJ as ae,aD as se,ag as te,ah as ne,ai as I,aj as L,ak as O,al as w,am as P}from"./index-52204ff5.js";import{D as ce}from"./dayTimePicker-6712320d.js";import"./clock-ffb74bee.js";const re=[{accessorKey:"employee.name",header:"Employee Name"},{accessorKey:"employee.department.name",header:"Department"},{accessorKey:"employee.designation.name",header:"Designation"},{accessorKey:"check_in",header:"Check In",cell:({row:a})=>{var s;return a.original.check_in&&T((s=a.original)==null?void 0:s.check_in)}},{accessorKey:"check_out",header:"Check out",cell:({row:a})=>{var s;return a.original.check_out&&T((s=a.original)==null?void 0:s.check_out)}},{accessorKey:"note",header:"Note"}],ie=D.injectEndpoints({endpoints:a=>({getAttendanceList:a.query({query:s=>`attendances?${s}`,providesTags:["attendance-list"]}),createAttendanceCheckIn:a.mutation({query:s=>({url:"attendance-check-in",method:"POST",body:s}),invalidatesTags:["attendance-list"]}),createAttendanceCheckOut:a.mutation({query:s=>({url:"attendance-check-out",method:"POST",body:s}),invalidatesTags:["attendance-list"]})}),overrideExisting:!1}),{useGetAttendanceListQuery:le,useCreateAttendanceCheckInMutation:oe,useCreateAttendanceCheckOutMutation:de}=ie;function M({tab:a,modalClose:s}){const[d,r]=l.useState([]),[n,m]=l.useState(""),{data:o,isLoading:y}=K(`per_page=15&page=1&text=${n}`),[u,{isLoading:x}]=oe(),[C,{isLoading:c}]=de(),i=G({defaultValues:{}}),p=async t=>{var j;return m(t),((j=o==null?void 0:o.data)==null?void 0:j.map(g=>({value:String(g.id),label:g.first_name+" "+g.last_name+" ("+g.id+")"})))||[]},f=async t=>{try{a==="check-in"?(await u(t).unwrap(),F.success("CheckIn created successfully!")):(await C(t).unwrap(),F.success("CheckOut created successfully!")),s()}catch(h){console.error("Error recording attendance:",h),$(h)}};return e.jsx(e.Fragment,{children:y?e.jsx("div",{className:"h-56",children:e.jsx(_,{})}):e.jsx(Q,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(f),className:"w-full space-y-3",children:[e.jsx(S,{control:i.control,name:"employee_ids",render:({field:t})=>e.jsxs(k,{children:[e.jsx(v,{children:"Employee Name"}),e.jsx(N,{children:e.jsx(q,{...t,value:d,onSearch:p,onChange:h=>{r(h),t.onChange(h.map(j=>parseInt(j.value)))},hidePlaceholderWhenSelected:!0,placeholder:"Search and select options",loadingIndicator:e.jsx("span",{children:"Loading..."}),emptyIndicator:e.jsx("span",{children:"No options found"})})}),e.jsx(b,{})]})}),e.jsx(S,{control:i.control,name:"date_time",render:({field:t})=>e.jsxs(k,{children:[e.jsx(v,{children:"Punch Time"}),e.jsx(N,{className:"",children:e.jsx(ce,{...t,displayFormat:{hour12:"yyyy/MM/dd h:mm a"},value:t.value,onChange:t.onChange,granularity:"minute",hourCycle:12})}),e.jsx(b,{})]})}),e.jsx(S,{control:i.control,name:"note",render:()=>e.jsxs(k,{children:[e.jsx(v,{children:"Note"}),e.jsx(N,{children:e.jsx(H,{...i.register("note")})}),e.jsx(b,{})]})}),e.jsx("div",{children:e.jsx(A,{variant:a==="check-in"?"default":"destructive",type:"submit",className:"w-full mt-4",disabled:x||c,children:x||c?"Submitting...":a==="check-in"?"Check In":"Check Out"})})]})})})}function he({selectedDate:a,setSelectedDate:s,selectedDepartment:d,setSelectedDepartment:r}){const{data:n}=z(""),[m,o]=l.useState(!1);return e.jsx(J,{className:"w-full p-5",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-[280px]",children:e.jsxs(R,{open:m,onOpenChange:o,children:[e.jsx(V,{asChild:!0,className:"h-9",children:e.jsxs(A,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a&&"text-muted-foreground"}`,children:[a?E(a,"PP"):"Pick a date",e.jsx(B,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(U,{className:"w-auto p-0",align:"start",children:e.jsx(W,{mode:"single",selected:a,onSelect:s,initialFocus:!0})})]})}),e.jsx(X,{items:(n==null?void 0:n.data)||[],labelKey:"name",valueKey:"id",value:d,placeholder:"Select Department",onSelect:r})]})})}const pe=()=>{const[a,s]=l.useState("check-in"),[d,r]=l.useState(!1),[n,m]=l.useState(),[o,y]=l.useState(void 0),[u,x]=l.useState({pageIndex:0,pageSize:10}),C=new URLSearchParams({date:n&&E(n,"yyyy-MM-dd")||"",per_page:u.pageSize.toString(),page:u.pageIndex.toString()}),{data:c,isLoading:i}=le(C.toString()),p=(c==null?void 0:c.data)||[],f=c==null?void 0:c.meta;return i?e.jsx(_,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Y,{title:"Attendance List",description:"Manage job apply for your business"}),e.jsxs(A,{onClick:()=>r(!0),size:"sm",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"})," Add Attendance"]})]}),e.jsx(he,{selectedDate:n,setSelectedDate:m,selectedDepartment:o,setSelectedDepartment:y}),e.jsx(ee,{}),p.length>0?e.jsx(ae,{columns:re,data:p,paginationInfo:f,pagination:u,setPagination:x,className:"py-2 px-4"}):e.jsx("div",{className:"grid place-items-center min-h-[60vh]",children:e.jsx("p",{className:"text-xl",children:"No attendance records found for the selected date or department."})})]})}),d&&e.jsx(se,{title:"Add Attendance List",isOpen:d,toggleModal:()=>r(!1),className:"w-fit",children:e.jsxs(te,{defaultValue:a,onValueChange:t=>s(t),className:"w-[400px] mx-auto",children:[e.jsxs(ne,{className:"grid w-full grid-cols-2 my-2",children:[e.jsx(I,{value:"check-in",children:"Check In"}),e.jsx(I,{value:"check-out",children:"Check Out"})]}),e.jsxs(L,{value:"check-in",children:[e.jsx(O,{children:e.jsx(w,{children:"Check In"})}),e.jsx(P,{className:"space-y-2",children:e.jsx("div",{className:"space-y-1",children:e.jsx(M,{modalClose:()=>r(!1),tab:a})})})]}),e.jsxs(L,{value:"check-out",children:[e.jsx(O,{children:e.jsx(w,{children:"Check Out"})}),e.jsx(P,{className:"space-y-2",children:e.jsx("div",{className:"space-y-1",children:e.jsx(M,{modalClose:()=>r(!1),tab:a})})})]})]})})]})};export{pe as default};
