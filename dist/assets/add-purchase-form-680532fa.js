import{y as re,r as D,dJ as ne,dK as le,dL as oe,dM as ce,B as de,D as ie,dz as I,ab as d,bX as ue,dN as he,dO as xe,dC as me,dD as b,a as e,aJ as je,V as p,G as pe,W,aU as O,H as i,J as u,K as h,b1 as ye,N as f,b2 as ge,b3 as ve,b4 as _e,b6 as be,Q as x,a9 as k,aa as E,aV as L,ac as V,ad as A,I as J,bt as fe,dE as Pe,dF as Se,dP as we,av as q,aw as Ne}from"./index-c8a5d6c4.js";function Fe(){const P=re(),[c,z]=D.useState([]),[S,$]=D.useState({sales_order_date:!1,delivery_date:!1,due_date:!1}),w=a=>{$(s=>({...s,[a]:!s[a]}))},{data:N,isLoading:U}=ne("page=1&per_page=1000"),{data:C,isLoading:H}=le("page=1&per_page=1000"),{data:F,isLoading:K}=oe("page=1&per_page=1000"),R=(C==null?void 0:C.data)||[],X=(N==null?void 0:N.data)||[],Y=(F==null?void 0:F.data)||[],[Z]=ce(),t=de({resolver:ie(we),defaultValues:{total:0,discount:0,tax_type:I[1].id.toString(),date:d(new Date,"yyyy-MM-dd")}}),ee=ue(),T=Number(ee.id),{data:M}=he(T,{skip:!T}),[ae]=xe(),r=(M==null?void 0:M.data)||void 0;D.useEffect(()=>{var a,s,n;if(r){const o=r.details.map(l=>{var g,v,G,Q;return{barcodeId:(g=l.item_barcode)==null?void 0:g.id,quantity:l.qty,price:l.price,tax:l.tax||void 0,units:[],unit:l.unit,barcode:(v=l.item_barcode)==null?void 0:v.barcode,name:(G=l.item)==null?void 0:G.name,barcodeAttribute:(Q=l.item_barcode)==null?void 0:Q.barcode_attribute,note:l.note}});z(o),t.reset({discount:r.discount,tax_type:r.tax_type,total:r.total,contact_id:String((a=r.contact)==null?void 0:a.id),date:r.date||"",due_date:r.due_date||"",delivery_date:r.delivery_date||"",note:r.note||"",terms_conditions:r.terms_conditions||"",sub_total:r.sub_total,reference:r.reference||"",tax:r.tax,warehouse_id:String((s=r.warehouse)==null?void 0:s.id),purchase_order_id:String((n=r.purchase_order)==null?void 0:n.id)})}},[r,t]);const se=t.watch("discount"),B=t.watch("tax_type");let m=0,y=0,j=0;c&&c.length>0&&(c==null||c.forEach(a=>{var g,v;const s=a.price*a.quantity,n=s*(se??0)/100,o=s-n,l=B==="inclusive"?me(o,((g=a.tax)==null?void 0:g.amount)||0):o*(((v=a.tax)==null?void 0:v.amount)||0)/100;m+=s,y+=n,j+=l}));let _=m-y+(B==="inclusive"?0:j);m=b(m),y=b(y),j=b(j),_=b(_),t.setValue("sub_total",m),t.setValue("tax",j),t.setValue("total",_);async function te(a){if(c.length===0)return q.error("Please select at least one product");const s={...a,details:c.map(n=>{var o;return{item_barcode_id:n.barcodeId,tax_id:(o=n.tax)==null?void 0:o.id,unit_id:n.unit.id,qty:n.quantity,price:n.price,total:n.price*n.quantity,note:n.note||""}})};try{r?(await ae({purchaseId:T,updatedPurchase:s}).unwrap(),q.success("Purchase updated successfully")):(await Z(s).unwrap(),q.success("Purchase created successfully")),P("/billing/purchases")}catch(n){Ne(n)}}return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(je,{title:r?"Edit Purchase":"Add Purchase",description:"Manage your sub accounts for you business"}),e.jsx(p,{onClick:()=>P("/billing/purchases"),size:"sm",children:"Purchase List"})]}),e.jsx(pe,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(te),className:"space-y-3 mb-4  overflow-y-scroll no-scrollbar",children:[e.jsx("div",{className:"",children:e.jsx(W,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(O,{loading:U,data:X,displayField:"name",valueField:"id",form:t,name:"contact_id",placeholder:"Select Supplier",title:"Supplier Name",className:"w-full"}),e.jsx(O,{loading:H,data:R,displayField:"invoice_number",valueField:"id",form:t,name:"purchase_order_id",placeholder:"Select Purchase Order",title:"Purchase Order",className:"w-full"}),e.jsx(O,{loading:K,data:Y,displayField:"name",valueField:"id",form:t,name:"warehouse_id",placeholder:"Select Warehouse",title:"Warehouse",className:"w-full"}),e.jsx("div",{className:"w-full",children:e.jsx(i,{control:t.control,name:"tax_type",render:({field:a})=>{var s,n,o;return e.jsxs(u,{children:[e.jsx(h,{children:"Tax Type"}),e.jsxs(ye,{onValueChange:a.onChange,defaultValue:String((n=(s=I)==null?void 0:s[1])==null?void 0:n.id),children:[e.jsx(f,{children:e.jsx(ge,{children:e.jsx(ve,{placeholder:"Select Tax Type"})})}),e.jsx(_e,{children:(o=I)==null?void 0:o.map(l=>e.jsx(be,{value:String(l.id),children:l.name},l.id))})]}),e.jsx(x,{})]})}})}),e.jsx(i,{control:t.control,name:"date",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Date"}),e.jsxs(k,{open:S.sales_order_date,onOpenChange:()=>w("sales_order_date"),children:[e.jsx(E,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(L,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(V,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(A,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(x,{})]})}),e.jsx(i,{control:t.control,name:"due_date",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Due Date"}),e.jsxs(k,{open:S.due_date,onOpenChange:()=>w("due_date"),children:[e.jsx(E,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(L,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(V,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(A,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(x,{})]})}),e.jsx(i,{control:t.control,name:"delivery_date",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Delivery Date"}),e.jsxs(k,{open:S.delivery_date,onOpenChange:()=>w("delivery_date"),children:[e.jsx(E,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(L,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(V,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(A,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(x,{})]})}),e.jsx(i,{control:t.control,name:"reference",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Reference"}),e.jsx(f,{children:e.jsx(J,{placeholder:"Enter reference",...a})}),e.jsx(x,{})]})}),e.jsx(i,{control:t.control,name:"note",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Note"}),e.jsx(f,{children:e.jsx(J,{placeholder:"Type Note.",...a})}),e.jsx(x,{})]})}),e.jsx(i,{control:t.control,name:"terms_conditions",render:({field:a})=>e.jsxs(u,{children:[e.jsx(h,{children:"Terms and conditions"}),e.jsx(f,{children:e.jsx(fe,{placeholder:"Type terms and conditions.",...a})}),e.jsx(x,{})]})})]})})}),e.jsx(W,{className:"mb-4",children:e.jsx(Pe,{setSelectedProducts:z,selectedProducts:c})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Se,{form:t,subTotal:m,discountedAmount:y,totalTaxAmount:j,grandTotal:_})}),e.jsxs("div",{className:"text-right",children:[e.jsx(p,{type:"button",onClick:()=>P("/billing/purchases"),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(p,{variant:"default",type:"submit",className:"w-fit mt-4",children:r?"Update":"Add"})]})]})})]})})}export{Fe as default};
