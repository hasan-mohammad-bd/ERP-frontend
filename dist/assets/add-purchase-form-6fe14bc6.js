import{z as te,r as D,dA as re,dB as ne,dC as le,D as oe,E as ie,dr as I,ac as c,bQ as ce,dD as de,dE as ue,ds as xe,dt as b,a as e,aK as me,W as p,H as he,X as O,aW as Q,J as d,K as u,N as x,b2 as je,Q as f,b3 as pe,b4 as ye,b5 as ge,b7 as ve,V as m,aa as M,ab as q,aX as E,ad as k,ae as A,I as $,bw as _e,du as be,dv as fe,dF as Se,aw as V,ax as we}from"./index-b3086330.js";function Ne(){const S=te(),[i,L]=D.useState([]),[w,G]=D.useState({sales_order_date:!1,delivery_date:!1,due_date:!1}),P=a=>{G(s=>({...s,[a]:!s[a]}))},{data:N,isLoading:U}=re("page=1&per_page=1000"),{data:C,isLoading:X}=ne("page=1&per_page=1000"),H=(N==null?void 0:N.data)||[],J=(C==null?void 0:C.data)||[],[K,{isLoading:R}]=le(),t=oe({resolver:ie(Se),defaultValues:{total:0,discount:0,tax_type:I[1].id.toString(),date:c(new Date,"yyyy-MM-dd")}}),Y=ce(),T=Number(Y.id),{data:F}=de(T,{skip:!T}),[Z,{isLoading:ee}]=ue(),r=(F==null?void 0:F.data)||void 0;D.useEffect(()=>{var a,s,n;if(r){const o=r.details.map(l=>{var g,v,z,B;return{detailId:l.id,barcodeId:(g=l.item_barcode)==null?void 0:g.id,quantity:l.qty,used_qty:l.used_qty,available_qty:l.available_qty,price:l.price,tax:l.tax||void 0,units:[],unit:l.unit,barcode:(v=l.item_barcode)==null?void 0:v.barcode,name:(z=l.item)==null?void 0:z.name,barcodeAttribute:(B=l.item_barcode)==null?void 0:B.barcode_attribute,note:l.note}});L(o),t.reset({discount:r.discount,tax_type:r.tax_type,total:r.total,contact_id:String((a=r.contact)==null?void 0:a.id),date:r.date||"",due_date:r.due_date||"",delivery_date:r.delivery_date||"",note:r.note||"",terms_conditions:r.terms_conditions||"",sub_total:r.sub_total,reference:r.reference||"",tax:r.tax,warehouse_id:(s=r.warehouse)==null?void 0:s.id,purchase_order_id:(n=r.purchase_order)==null?void 0:n.id})}},[r,t]);const ae=t.watch("discount"),W=t.watch("tax_type");let h=0,y=0,j=0;i&&i.length>0&&(i==null||i.forEach(a=>{var g,v;const s=a.price*a.quantity,n=s*(ae??0)/100,o=s-n,l=W==="inclusive"?xe(o,((g=a.tax)==null?void 0:g.amount)||0):o*(((v=a.tax)==null?void 0:v.amount)||0)/100;h+=s,y+=n,j+=l}));let _=h-y+(W==="inclusive"?0:j);h=b(h),y=b(y),j=b(j),_=b(_),t.setValue("sub_total",h),t.setValue("tax",j),t.setValue("total",_);async function se(a){if(i.length===0)return V.error("Please select at least one product");const s={...a,details:i.map(n=>{var o;return{details_id:n.detailId,item_barcode_id:n.barcodeId,tax_id:(o=n.tax)==null?void 0:o.id,unit_id:n.unit.id,qty:n.quantity,price:n.price,total:n.price*n.quantity,note:n.note||""}})};console.log(s,"payload");try{r?(await Z({purchaseId:T,updatedPurchase:s}).unwrap(),V.success("Purchase updated successfully")):(await K(s).unwrap(),V.success("Purchase created successfully")),S("/billing/purchases")}catch(n){we(n)}}return console.log(t.formState.errors,"form errors"),e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(me,{title:r?"Edit Purchase":"Add Purchase",description:"Manage your sub accounts for you business"}),e.jsx(p,{onClick:()=>S("/billing/purchases"),size:"sm",children:"Purchase List"})]}),e.jsx(he,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(se),className:"space-y-3 mb-4  overflow-y-scroll no-scrollbar",children:[e.jsx("div",{className:"",children:e.jsx(O,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(Q,{loading:U,data:H,displayField:"name",valueField:"id",form:t,name:"contact_id",placeholder:"Select Supplier",title:"Supplier Name",className:"w-full"}),e.jsx(Q,{loading:X,data:J,displayField:"name",valueField:"id",form:t,name:"warehouse_id",placeholder:"Select Warehouse",title:"Warehouse",className:"w-full"}),e.jsx("div",{className:"w-full",children:e.jsx(d,{control:t.control,name:"tax_type",render:({field:a})=>{var s,n,o;return e.jsxs(u,{children:[e.jsx(x,{children:"Tax Type"}),e.jsxs(je,{onValueChange:a.onChange,defaultValue:String((n=(s=I)==null?void 0:s[1])==null?void 0:n.id),children:[e.jsx(f,{children:e.jsx(pe,{children:e.jsx(ye,{placeholder:"Select Tax Type"})})}),e.jsx(ge,{children:(o=I)==null?void 0:o.map(l=>e.jsx(ve,{value:String(l.id),children:l.name},l.id))})]}),e.jsx(m,{})]})}})}),e.jsx(d,{control:t.control,name:"date",render:({field:a})=>e.jsxs(u,{children:[e.jsx(x,{children:"Date"}),e.jsxs(M,{open:w.sales_order_date,onOpenChange:()=>P("sales_order_date"),children:[e.jsx(q,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?c(a.value,"PP"):"Pick a date",e.jsx(E,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(k,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(A,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?c(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(m,{})]})}),e.jsx(d,{control:t.control,name:"due_date",render:({field:a})=>e.jsxs(u,{children:[e.jsx(x,{children:"Due Date"}),e.jsxs(M,{open:w.due_date,onOpenChange:()=>P("due_date"),children:[e.jsx(q,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?c(a.value,"PP"):"Pick a date",e.jsx(E,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(k,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(A,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?c(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(m,{})]})}),e.jsx(d,{control:t.control,name:"delivery_date",render:({field:a})=>e.jsxs(u,{children:[e.jsx(x,{children:"Delivery Date"}),e.jsxs(M,{open:w.delivery_date,onOpenChange:()=>P("delivery_date"),children:[e.jsx(q,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?c(a.value,"PP"):"Pick a date",e.jsx(E,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(k,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(A,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?c(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(m,{})]})}),e.jsx(d,{control:t.control,name:"reference",render:({field:a})=>e.jsxs(u,{children:[e.jsx(x,{children:"Reference"}),e.jsx(f,{children:e.jsx($,{placeholder:"Enter reference",...a})}),e.jsx(m,{})]})}),e.jsx(d,{control:t.control,name:"note",render:({field:a})=>e.jsxs(u,{children:[e.jsx(x,{children:"Note"}),e.jsx(f,{children:e.jsx($,{placeholder:"Type Note.",...a})}),e.jsx(m,{})]})}),e.jsx(d,{control:t.control,name:"terms_conditions",render:({field:a})=>e.jsxs(u,{children:[e.jsx(x,{children:"Terms and conditions"}),e.jsx(f,{children:e.jsx(_e,{placeholder:"Type terms and conditions.",...a})}),e.jsx(m,{})]})})]})})}),e.jsx(O,{className:"mb-4",children:e.jsx(be,{setSelectedProducts:L,selectedProducts:i})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(fe,{form:t,subTotal:h,discountedAmount:y,totalTaxAmount:j,grandTotal:_})}),e.jsxs("div",{className:"text-right",children:[e.jsx(p,{type:"button",onClick:()=>S("/billing/purchases"),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(p,{disabled:!t.formState.isValid||R||ee,variant:"default",type:"submit",className:"w-fit mt-4",children:r?"Update":"Add"})]})]})})]})})}export{Ne as default};
