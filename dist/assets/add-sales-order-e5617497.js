import{y as H,r as w,dB as R,dC as U,dD as K,dy as W,dA as X,dN as Y,B as Z,a as e,aJ as ee,V as o,G as ae,W as L,aU as c,H as n,J as l,K as r,N as m,I as N,Q as i,a9 as f,aa as P,ab as d,aV as S,ac as b,ad as C,bt as se,D as te,av as T,aw as ne}from"./index-172bd9a0.js";import{S as le,C as re,s as ie}from"./sales-order-b5cc91a7.js";function ce(){const x=H(),[u,O]=w.useState([]),[j,D]=w.useState({sales_order_date:!1,delivery_date:!1,due_date:!1}),h=a=>{D(s=>({...s,[a]:!s[a]}))},{data:p,isLoading:M}=R("page=1&per_page=1000"),{data:g,isLoading:Q}=U("per_page=1000&page=1"),{data:y,isLoading:k}=K("per_page=1000&page=1"),{data:v,isLoading:G}=W("per_page=1000&page=1"),{data:_,isLoading:q}=X("per_page=1000&page=1"),A=(_==null?void 0:_.data)||[],z=(p==null?void 0:p.data)||[],$=(g==null?void 0:g.data)||[],B=(y==null?void 0:y.data)||[],E=(v==null?void 0:v.data)||[],[I,{isLoading:J}]=Y(),t=Z({resolver:te(ie),defaultValues:{total:0}});async function V(a){if(u.length===0)return T.error("Please select at least one product");try{await I({...a,discount:a.discount||0,shipping_charges:a.shipping_charges||0,details:u.map(s=>{const F=s.unit.selling_price*(1-s.unit.discount/100);return{unit_id:s.unit.id,item_id:s.id,item_barcode_id:Number(s.id),price:s.unit.selling_price,after_discount:F,total:F*s.quantity,qty:s.quantity,discount:s.unit.discount,note:s.note||""}})}).unwrap(),T.success("Sales order created successfully"),x("/billing/sales-orders")}catch(s){ne(s)}}return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(ee,{title:"Add Sales Order",description:"Manage your sub accounts for you business"}),e.jsx(o,{onClick:()=>x("/billing/sales-orders"),size:"sm",children:"Sales Order List"})]}),e.jsx(ae,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(V),className:"space-y-3 mb-4  overflow-y-scroll no-scrollbar",children:[e.jsx("div",{className:"",children:e.jsx(L,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(c,{loading:M,data:z,displayField:"name",valueField:"id",form:t,name:"contact_id",placeholder:"Select Customer",title:"Customer Name",className:"w-full"}),e.jsx(n,{control:t.control,name:"reference",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Reference"}),e.jsx(m,{children:e.jsx(N,{placeholder:"Enter reference",...a})}),e.jsx(i,{})]})}),e.jsx(n,{control:t.control,name:"date",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Date"}),e.jsxs(f,{open:j.sales_order_date,onOpenChange:()=>h("sales_order_date"),children:[e.jsx(P,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(S,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(b,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(C,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(i,{})]})}),e.jsx(n,{control:t.control,name:"due_date",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Due Date"}),e.jsxs(f,{open:j.due_date,onOpenChange:()=>h("due_date"),children:[e.jsx(P,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(S,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(b,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(C,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(i,{})]})}),e.jsx(n,{control:t.control,name:"delivery_date",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Delivery Date"}),e.jsxs(f,{open:j.delivery_date,onOpenChange:()=>h("delivery_date"),children:[e.jsx(P,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(S,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(b,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(C,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(i,{})]})}),e.jsx(c,{loading:k,data:B,displayField:"name",valueField:"id",form:t,name:"sales_person_id",placeholder:"Select Sales person",title:"Sales Person",className:"w-full"}),e.jsx(c,{loading:Q,data:$,displayField:"name",valueField:"id",form:t,name:"project_id",placeholder:"Select Project",title:"Project Name",className:"w-full"}),e.jsx(c,{loading:G,data:E,displayField:"name",valueField:"id",form:t,name:"payment_terms",placeholder:"Select Payment Terms",title:"Payment Terms",className:"w-full"}),e.jsx(c,{loading:q,data:A,displayField:"invoice_number",valueField:"id",form:t,name:"quotation_id",placeholder:"Select Quotation",title:"Quotation",className:"w-full"}),e.jsx(n,{control:t.control,name:"subject",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Subject"}),e.jsx(m,{children:e.jsx(N,{placeholder:"Type Subject.",...a})}),e.jsx(i,{})]})}),e.jsx(n,{control:t.control,name:"note",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Note"}),e.jsx(m,{children:e.jsx(N,{placeholder:"Type Note.",...a})}),e.jsx(i,{})]})}),e.jsx(n,{control:t.control,name:"terms_conditions",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Terms and conditions"}),e.jsx(m,{children:e.jsx(se,{placeholder:"Type terms and conditions.",...a})}),e.jsx(i,{})]})})]})})}),e.jsx(L,{className:"mb-4",children:e.jsx(le,{setSelectedProducts:O,selectedProducts:u,previousData:!1})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(re,{form:t,subTotal:Number(u.reduce((a,s)=>a+s.total,0).toFixed(2))})}),e.jsxs("div",{className:"text-right",children:[e.jsx(o,{type:"button",onClick:()=>x("/billing/sales-orders"),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(o,{variant:"default",type:"submit",className:"w-fit mt-4",children:J?"Adding...":"Add"})]})]})})]})})}export{ce as default};
