import{bX as X,y as Y,r as S,dB as Z,dC as ee,dD as ae,dy as se,dA as te,dO as ne,dP as re,dQ as ie,B as oe,a as e,au as de,aJ as ce,V as c,G as le,W as k,aU as u,H as r,J as i,K as o,N as x,I as w,Q as d,a9 as P,aa as F,ab as l,aV as C,ac as L,ad as O,bt as ue,D as me,av as xe,aw as pe}from"./index-5e4ea710.js";import{S as _e,C as je,s as he}from"./sales-order-f7783b5f.js";function ye(){const M=X(),p=Number(M.id),_=Y(),[m,T]=S.useState([]),[j,G]=S.useState({sales_order_date:!1,delivery_date:!1,due_date:!1}),h=a=>{G(s=>({...s,[a]:!s[a]}))},{data:g,isLoading:q}=Z("page=1&per_page=1000"),{data:b,isLoading:E}=ee("per_page=1000&page=1"),{data:y,isLoading:U}=ae("per_page=1000&page=1"),{data:N,isLoading:I}=se("per_page=1000&page=1"),{data:v,isLoading:z}=te("per_page=1000&page=1"),{data:f}=ne("per_page=1000&page=1"),Q=(f==null?void 0:f.data)||[],B=(v==null?void 0:v.data)||[],$=(g==null?void 0:g.data)||[],J=(b==null?void 0:b.data)||[],V=(y==null?void 0:y.data)||[],H=(N==null?void 0:N.data)||[],{data:n,isLoading:R}=re(p,{skip:!p}),[A,{isLoading:K}]=ie(),t=oe({resolver:me(he),defaultValues:{total:0}});S.useEffect(()=>{n&&(t.reset({...n.data,note:n.data.note??"",subject:n.data.subject??"",terms_conditions:n.data.terms_conditions??"",contact_id:String(n.data.contact.id),discount:Number(n.data.discount),total:Number(n.data.total),shipping_charges:Number(n.data.shipping_charges),reference:n.data.reference??void 0}),T(n.data.details.map(a=>({barcode:String(a.item_barcode.barcode),id:a.item_barcode.id,barcode_attribute:a.item_barcode.barcode_attribute,name:a.item.name,note:a.note||"",sale_account_tax:Q.find(s=>s.id===a.sale_account_tax_id)??{name:"",amount:"",description:"",status:0,id:0},tax:Q.find(s=>s.id===a.sale_account_tax_id)??{name:"",amount:"",description:"",status:0,id:0},secondary_unit:{wholesale_price:Number(a.item_barcode.wholesale_price),after_discount:Number(a.item_barcode.after_discount),discount:Number(a.discount),discount_amount:Number(a.item_barcode.discount_amount),id:a.unit.id,name:a.item.name,selling_price:Number(a.item_barcode.selling_price)},finalPrice:Number(a.total),quantity:Number(a.qty),subTotal:Number(a.item_barcode.after_discount),total:Number(a.total),primary_unit:{wholesale_price:Number(a.item_barcode.wholesale_price),after_discount:Number(a.item_barcode.after_discount),discount:Number(a.discount),discount_amount:Number(a.item_barcode.discount_amount),id:a.unit.id,name:a.item.name,selling_price:Number(a.item_barcode.selling_price)},unit:{wholesale_price:Number(a.item_barcode.wholesale_price),after_discount:Number(a.item_barcode.after_discount),discount:Number(a.discount),discount_amount:Number(a.item_barcode.discount_amount),id:a.unit.id,name:a.item.name,selling_price:Number(a.item_barcode.selling_price)}}))))},[t,n]);async function W(a){try{await A({salesOrderId:p,updatedSalesOrder:{...a,discount:a.discount||0,shipping_charges:a.shipping_charges||0,details:m.map(s=>{const D=s.unit.selling_price*(1-s.unit.discount/100);return{unit_id:s.unit.id,item_id:s.id,item_barcode_id:Number(s.id),price:s.unit.selling_price,after_discount:Number(D.toFixed(2)),total:Number((D*s.quantity).toFixed(2)),qty:s.quantity,discount:s.unit.discount,note:s.note||"",tax_id:s.tax.id}})}}).unwrap(),xe.success("Sales order updated successfully"),_("/billing/sales-orders")}catch(s){pe(s)}}return R?e.jsx(de,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(ce,{title:"Edit Sales Order",description:"Manage your sub accounts for you business"}),e.jsx(c,{onClick:()=>_("/billing/sales-orders"),size:"sm",children:"Sales Order List"})]}),e.jsx(le,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(W),className:"space-y-3 mb-4  overflow-y-scroll no-scrollbar",children:[e.jsx("div",{className:"",children:e.jsx(k,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(u,{loading:q,data:$,displayField:"name",valueField:"id",form:t,name:"contact_id",placeholder:"Select Customer",title:"Customer Name",className:"w-full"}),e.jsx(r,{control:t.control,name:"reference",render:({field:a})=>e.jsxs(i,{children:[e.jsx(o,{children:"Reference"}),e.jsx(x,{children:e.jsx(w,{placeholder:"Enter reference",...a})}),e.jsx(d,{})]})}),e.jsx(r,{control:t.control,name:"date",render:({field:a})=>e.jsxs(i,{children:[e.jsx(o,{children:"Date"}),e.jsxs(P,{open:j.sales_order_date,onOpenChange:()=>h("sales_order_date"),children:[e.jsx(F,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?l(a.value,"PP"):"Pick a date",e.jsx(C,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(L,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(O,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?l(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(d,{})]})}),e.jsx(r,{control:t.control,name:"due_date",render:({field:a})=>e.jsxs(i,{children:[e.jsx(o,{children:"Due Date"}),e.jsxs(P,{open:j.due_date,onOpenChange:()=>h("due_date"),children:[e.jsx(F,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?l(a.value,"PP"):"Pick a date",e.jsx(C,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(L,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(O,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?l(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(d,{})]})}),e.jsx(r,{control:t.control,name:"delivery_date",render:({field:a})=>e.jsxs(i,{children:[e.jsx(o,{children:"Delivery Date"}),e.jsxs(P,{open:j.delivery_date,onOpenChange:()=>h("delivery_date"),children:[e.jsx(F,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?l(a.value,"PP"):"Pick a date",e.jsx(C,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(L,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(O,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?l(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(d,{})]})}),e.jsx(u,{loading:U,data:V,displayField:"name",valueField:"id",form:t,name:"sales_person_id",placeholder:"Select Sales person",title:"Sales Person",className:"w-full"}),e.jsx(u,{loading:E,data:J,displayField:"name",valueField:"id",form:t,name:"project_id",placeholder:"Select Project",title:"Project Name",className:"w-full"}),e.jsx(u,{loading:I,data:H,displayField:"name",valueField:"id",form:t,name:"payment_terms",placeholder:"Select Payment Terms",title:"Payment Terms",className:"w-full"}),e.jsx(u,{loading:z,data:B,displayField:"invoice_number",valueField:"id",form:t,name:"quotation_id",placeholder:"Select Quotation",title:"Quotation",className:"w-full"}),e.jsx(r,{control:t.control,name:"subject",render:({field:a})=>e.jsxs(i,{children:[e.jsx(o,{children:"Subject"}),e.jsx(x,{children:e.jsx(w,{placeholder:"Type Subject.",...a})}),e.jsx(d,{})]})}),e.jsx(r,{control:t.control,name:"note",render:({field:a})=>e.jsxs(i,{children:[e.jsx(o,{children:"Note"}),e.jsx(x,{children:e.jsx(w,{placeholder:"Type Note.",...a})}),e.jsx(d,{})]})}),e.jsx(r,{control:t.control,name:"terms_conditions",render:({field:a})=>e.jsxs(i,{children:[e.jsx(o,{children:"Terms and conditions"}),e.jsx(x,{children:e.jsx(ue,{placeholder:"Type terms and conditions.",...a})}),e.jsx(d,{})]})})]})})}),e.jsx(k,{className:"mb-4",children:e.jsx(_e,{setSelectedProducts:T,selectedProducts:m,previousData:!0})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(je,{form:t,subTotal:Number(m.reduce((a,s)=>a+s.total,0).toFixed(2)),selectedProducts:m})}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{type:"button",onClick:()=>_("/billing/sales-orders"),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(c,{variant:"default",type:"submit",className:"w-fit mt-4",children:K?"Updating...":"Update"})]})]})})]})})}export{ye as default};
