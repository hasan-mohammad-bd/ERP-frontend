import{D as R,r as P,dF as U,dG as X,G as Z,H as W,dH as T,ae as d,b$ as ee,dI as ae,dJ as se,dK as te,dL as v,a as e,aM as re,Y as h,K as ne,Z as z,aY as le,N as c,Q as i,V as u,W as _,I as L,X as x,ac as O,ad as F,aZ as M,af as D,ag as I,b4 as oe,b5 as de,b6 as ce,b7 as ie,b9 as ue,by as xe,dM as me,dN as je,dO as he,ay as k,az as ye}from"./index-2d0d41b8.js";function ge(){const b=R(),[l,A]=P.useState([]),[S,$]=P.useState({sales_order_date:!1,delivery_date:!1,due_date:!1}),f=a=>{$(s=>({...s,[a]:!s[a]}))},{data:N,isLoading:B}=U("page=1&per_page=1000"),G=(N==null?void 0:N.data)||[],[H]=X(),t=Z({resolver:W(he),defaultValues:{total:0,tax_type:T[1].id.toString(),date:d(new Date,"yyyy-MM-dd")}}),Q=ee(),w=Number(Q.id),{data:C}=ae(w,{skip:!w}),[Y]=se(),r=(C==null?void 0:C.data)||void 0;P.useEffect(()=>{if(r){const a=r.details.map(s=>({barcodeId:s.item_barcode.id,quantity:s.qty,price:s.price,tax:s.tax||void 0,units:[],unit:s.unit,barcode:s.item_barcode.barcode,name:s.item.name,barcodeAttribute:s.item_barcode.barcode_attribute,note:s.note}));A(a),t.reset({discount:r.discount,tax_type:r.tax_type,total:r.total,contact_id:String(r.contact.id),date:r.date||"",due_date:r.due_date||"",delivery_date:r.delivery_date||"",note:r.note||"",terms_conditions:r.terms_conditions||"",sub_total:r.sub_total,reference:r.reference||"",tax:r.tax})}},[r,t]);const J=t.watch("discount"),E=t.watch("tax_type");let m=0,y=0,j=0;l&&l.length>0&&(l==null||l.forEach(a=>{var V,q;const s=a.price*a.quantity,n=s*(J??0)/100,o=s-n,p=E==="inclusive"?te(o,((V=a.tax)==null?void 0:V.amount)||0):o*(((q=a.tax)==null?void 0:q.amount)||0)/100;m+=s,y+=n,j+=p}));let g=m-y+(E==="inclusive"?0:j);m=v(m),y=v(y),j=v(j),g=v(g),t.setValue("sub_total",m),t.setValue("tax",j),t.setValue("total",g);async function K(a){if(l.length===0)return k.error("Please select at least one product");const s={...a,details:l.map(n=>{var o;return{item_barcode_id:n.barcodeId,tax_id:(o=n.tax)==null?void 0:o.id,unit_id:n.unit.id,qty:n.quantity,price:n.price,total:n.price*n.quantity,note:n.note||""}})};try{r?(await Y({salesOrderId:w,updatedSalesOrder:s}).unwrap(),k.success("Sales Order updated successfully")):(await H(s).unwrap(),k.success("Sales Order created successfully")),b("/billing/sales-order")}catch(n){ye(n)}}return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(re,{title:r?"Edit Sales Order":"Add Sales Order",description:"Manage your sub accounts for you business"}),e.jsx(h,{onClick:()=>b("/billing/sales-order"),size:"sm",children:"Sales Order List"})]}),e.jsx(ne,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(K),className:"space-y-3 mb-4  overflow-y-scroll no-scrollbar",children:[e.jsx("div",{className:"",children:e.jsx(z,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(le,{loading:B,data:G,displayField:"name",valueField:"id",form:t,name:"contact_id",placeholder:"Select Customer",title:"Customer Name",className:"w-full"}),e.jsx(c,{control:t.control,name:"reference",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Reference"}),e.jsx(_,{children:e.jsx(L,{placeholder:"Enter reference",...a})}),e.jsx(x,{})]})}),e.jsx(c,{control:t.control,name:"date",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Date"}),e.jsxs(O,{open:S.sales_order_date,onOpenChange:()=>f("sales_order_date"),children:[e.jsx(F,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(M,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(D,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(I,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(x,{})]})}),e.jsx(c,{control:t.control,name:"due_date",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Due Date"}),e.jsxs(O,{open:S.due_date,onOpenChange:()=>f("due_date"),children:[e.jsx(F,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(M,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(D,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(I,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(x,{})]})}),e.jsx(c,{control:t.control,name:"delivery_date",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Delivery Date"}),e.jsxs(O,{open:S.delivery_date,onOpenChange:()=>f("delivery_date"),children:[e.jsx(F,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(M,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(D,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(I,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(x,{})]})}),e.jsx("div",{className:"w-full",children:e.jsx(c,{control:t.control,name:"tax_type",render:({field:a})=>{var s,n,o;return e.jsxs(i,{children:[e.jsx(u,{children:"Tax Type"}),e.jsxs(oe,{onValueChange:a.onChange,defaultValue:String((n=(s=T)==null?void 0:s[1])==null?void 0:n.id),children:[e.jsx(_,{children:e.jsx(de,{children:e.jsx(ce,{placeholder:"Select Tax Type"})})}),e.jsx(ie,{children:(o=T)==null?void 0:o.map(p=>e.jsx(ue,{value:String(p.id),children:p.name},p.id))})]}),e.jsx(x,{})]})}})}),e.jsx(c,{control:t.control,name:"note",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Note"}),e.jsx(_,{children:e.jsx(L,{placeholder:"Type Note.",...a})}),e.jsx(x,{})]})}),e.jsx(c,{control:t.control,name:"terms_conditions",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Terms and conditions"}),e.jsx(_,{children:e.jsx(xe,{placeholder:"Type terms and conditions.",...a})}),e.jsx(x,{})]})})]})})}),e.jsx(z,{className:"mb-4",children:e.jsx(me,{setSelectedProducts:A,selectedProducts:l})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(je,{form:t,subTotal:m,discountedAmount:y,totalTaxAmount:j,grandTotal:g})}),e.jsxs("div",{className:"text-right",children:[e.jsx(h,{type:"button",onClick:()=>b("/billing/sales-order"),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(h,{variant:"default",type:"submit",className:"w-fit mt-4",children:r?"Update":"Add"})]})]})})]})})}export{ge as default};
