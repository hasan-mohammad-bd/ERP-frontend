import{y as B,r as F,dB as J,dC as H,dD as R,dy as U,dN as K,B as W,D as X,a as e,aJ as Y,V as u,G as Z,W as T,aU as j,H as l,J as n,K as r,N as x,I as f,Q as i,a9 as N,aa as b,ab as m,aV as C,ac as P,ad as w,b1 as ee,b2 as se,b3 as ae,b4 as te,b6 as le,bt as ne,av as L,aw as re}from"./index-5e4ea710.js";import{S as ie,C as oe,s as de}from"./sales-order-f7783b5f.js";const o=[{id:"inclusive",name:"Inclusive"},{id:"exclusive",name:"Exclusive"}];function me(){const h=B(),[d,O]=F.useState([]),[g,M]=F.useState({sales_order_date:!1,delivery_date:!1,due_date:!1}),p=s=>{M(a=>({...a,[s]:!a[s]}))},{data:y,isLoading:k}=J("page=1&per_page=1000"),{data:v,isLoading:D}=H("per_page=1000&page=1"),{data:S,isLoading:V}=R("per_page=1000&page=1"),{data:_,isLoading:G}=U("per_page=1000&page=1"),I=(y==null?void 0:y.data)||[],Q=(v==null?void 0:v.data)||[],z=(S==null?void 0:S.data)||[],A=(_==null?void 0:_.data)||[],[E,{isLoading:$}]=K(),t=W({resolver:X(de),defaultValues:{total:0,tax_type:o[1].id.toString()}});console.log(d);async function q(s){if(d.length===0)return L.error("Please select at least one product");try{await E({...s,discount:s.discount||0,shipping_charges:s.shipping_charges||0,details:d.map(a=>{const c=a.unit.selling_price*(1-a.unit.discount/100);return{unit_id:a.unit.id,item_id:a.id,item_barcode_id:Number(a.id),price:a.unit.selling_price,after_discount:c,total:c*a.quantity,qty:a.quantity,discount:a.unit.discount,note:a.note||"",tax_id:a.tax.id}})}).unwrap(),L.success("Sales order created successfully"),h("/billing/sales-orders")}catch(a){re(a)}}return console.log(t.formState.errors),e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(Y,{title:"Add Sales Order",description:"Manage your sub accounts for you business"}),e.jsx(u,{onClick:()=>h("/billing/sales-orders"),size:"sm",children:"Sales Order List"})]}),e.jsx(Z,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(q),className:"space-y-3 mb-4  overflow-y-scroll no-scrollbar",children:[e.jsx("div",{className:"",children:e.jsx(T,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(j,{loading:k,data:I,displayField:"name",valueField:"id",form:t,name:"contact_id",placeholder:"Select Customer",title:"Customer Name",className:"w-full"}),e.jsx(l,{control:t.control,name:"reference",render:({field:s})=>e.jsxs(n,{children:[e.jsx(r,{children:"Reference"}),e.jsx(x,{children:e.jsx(f,{placeholder:"Enter reference",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:t.control,name:"date",render:({field:s})=>e.jsxs(n,{children:[e.jsx(r,{children:"Date"}),e.jsxs(N,{open:g.sales_order_date,onOpenChange:()=>p("sales_order_date"),children:[e.jsx(b,{asChild:!0,children:e.jsxs(u,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.value&&"text-muted-foreground"}`,children:[s.value?m(s.value,"PP"):"Pick a date",e.jsx(C,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(P,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(w,{mode:"single",selected:s.value?new Date(s.value):void 0,onSelect:a=>{s.onChange(a?m(a,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(i,{})]})}),e.jsx(l,{control:t.control,name:"due_date",render:({field:s})=>e.jsxs(n,{children:[e.jsx(r,{children:"Due Date"}),e.jsxs(N,{open:g.due_date,onOpenChange:()=>p("due_date"),children:[e.jsx(b,{asChild:!0,children:e.jsxs(u,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.value&&"text-muted-foreground"}`,children:[s.value?m(s.value,"PP"):"Pick a date",e.jsx(C,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(P,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(w,{mode:"single",selected:s.value?new Date(s.value):void 0,onSelect:a=>{s.onChange(a?m(a,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(i,{})]})}),e.jsx(l,{control:t.control,name:"delivery_date",render:({field:s})=>e.jsxs(n,{children:[e.jsx(r,{children:"Delivery Date"}),e.jsxs(N,{open:g.delivery_date,onOpenChange:()=>p("delivery_date"),children:[e.jsx(b,{asChild:!0,children:e.jsxs(u,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.value&&"text-muted-foreground"}`,children:[s.value?m(s.value,"PP"):"Pick a date",e.jsx(C,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(P,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(w,{mode:"single",selected:s.value?new Date(s.value):void 0,onSelect:a=>{s.onChange(a?m(a,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(i,{})]})}),e.jsx(j,{loading:V,data:z,displayField:"name",valueField:"id",form:t,name:"sales_person_id",placeholder:"Select Sales person",title:"Sales Person",className:"w-full"}),e.jsx(j,{loading:D,data:Q,displayField:"name",valueField:"id",form:t,name:"project_id",placeholder:"Select Project",title:"Project Name",className:"w-full"}),e.jsx(j,{loading:G,data:A,displayField:"name",valueField:"id",form:t,name:"payment_terms",placeholder:"Select Payment Terms",title:"Payment Terms",className:"w-full"}),e.jsx("div",{className:"w-full",children:e.jsx(l,{control:t.control,name:"tax_type",render:({field:s})=>{var a;return e.jsxs(n,{children:[e.jsx(r,{children:"Tax Type"}),e.jsxs(ee,{onValueChange:s.onChange,defaultValue:String((a=o==null?void 0:o[1])==null?void 0:a.id),children:[e.jsx(x,{children:e.jsx(se,{children:e.jsx(ae,{placeholder:"Select Tax Type"})})}),e.jsx(te,{children:o==null?void 0:o.map(c=>e.jsx(le,{value:String(c.id),children:c.name},c.id))})]}),e.jsx(i,{})]})}})}),e.jsx(l,{control:t.control,name:"subject",render:({field:s})=>e.jsxs(n,{children:[e.jsx(r,{children:"Subject"}),e.jsx(x,{children:e.jsx(f,{placeholder:"Type Subject.",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:t.control,name:"note",render:({field:s})=>e.jsxs(n,{children:[e.jsx(r,{children:"Note"}),e.jsx(x,{children:e.jsx(f,{placeholder:"Type Note.",...s})}),e.jsx(i,{})]})}),e.jsx(l,{control:t.control,name:"terms_conditions",render:({field:s})=>e.jsxs(n,{children:[e.jsx(r,{children:"Terms and conditions"}),e.jsx(x,{children:e.jsx(ne,{placeholder:"Type terms and conditions.",...s})}),e.jsx(i,{})]})})]})})}),e.jsx(T,{className:"mb-4",children:e.jsx(ie,{setSelectedProducts:O,selectedProducts:d,previousData:!1})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(oe,{form:t,subTotal:Number(d.reduce((s,a)=>s+a.total,0)),selectedProducts:d})}),e.jsxs("div",{className:"text-right",children:[e.jsx(u,{type:"button",onClick:()=>h("/billing/sales-orders"),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(u,{variant:"default",type:"submit",className:"w-fit mt-4",children:$?"Adding...":"Add"})]})]})})]})})}export{me as default};
