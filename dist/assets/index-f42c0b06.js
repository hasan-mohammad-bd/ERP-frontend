import{b9 as w,r as d,aS as A,z as $,a as e,F as B,N as k,b0 as D,M as j,E as f,G as S,H as b,J as N,I as E,K as g,a6 as H,a7 as Q,a8 as h,aL as J,a9 as L,aa as O,ao as _,an as R,b1 as Y,b2 as z,b3 as T,b4 as u,b5 as K,b6 as y}from"./index-464ea72c.js";/* empty css                         */import{D as V}from"./index-9774f8aa.js";import"./parseISO-75f2c8f9.js";const W=w.injectEndpoints({endpoints:s=>({getEmployeesEstimateSalary:s.query({query:()=>"salary-estimate",providesTags:["salary-estimate"]}),estimateSalary:s.mutation({query:({employee_ids:t,salary_month:n})=>({url:"salary-estimate",method:"POST",body:{employee_ids:t,salary_month:n}}),invalidatesTags:["salary-estimate"]})}),overrideExisting:!1}),{useGetEmployeesEstimateSalaryQuery:le,useEstimateSalaryMutation:U}=W,X=w.injectEndpoints({endpoints:s=>({getSalaryGenerate:s.query({query:()=>"salary-generate",providesTags:["salary-generate"]}),salaryGenerate:s.mutation({query:({bank_advice_no:t,bank_date:n,comment:r,employee_ids:x,salary_month:m})=>({url:"salary-generate",method:"POST",body:{bank_advice_no:t,bank_date:n,comment:r,employee_ids:x,salary_month:m}}),invalidatesTags:["salary-generate"]})}),overrideExisting:!1}),{useGetSalaryGenerateQuery:oe,useSalaryGenerateMutation:Z}=X;function ee({onShowEstimateSalary:s}){const[t,n]=d.useState([]),[r,x]=d.useState(null),[m,M]=d.useState(""),[v,F]=d.useState(!1),[C]=U(),[G]=Z(),{data:p}=A(`per_page=15&page=1&search=${m}`,{skip:!m}),i=$({defaultValues:{employee_ids:"",bank_advice_no:"",bank_date:null,note:""}}),P=async a=>{var l;return M(a),((l=p==null?void 0:p.data)==null?void 0:l.map(o=>({value:String(o.id),label:`${o.first_name} ${o.last_name} (${o.id})`})))||[]},I=async()=>{if(!r||!t.length)return;const a=t.map(l=>Number(l.value)),c=h(r,"yyyy-MM");try{const l=await C({employee_ids:a,salary_month:c}).unwrap();l.data&&(s(l.data),F(!0))}catch(l){console.error("Failed to fetch salary estimate:",l),_(l)}},q=async a=>{if(!t.length||!r||!a.bank_advice_no)return;const c=t.map(o=>Number(o.value)),l=h(r,"yyyy-MM");try{const o=await G({bank_advice_no:a.bank_advice_no,bank_date:h(a.bank_date,"yyyy-MM-dd"),comment:a.note,employee_ids:c,salary_month:l}).unwrap();R.success("Salary Generated Successfully"),console.log("Salary generated successfully:",o)}catch(o){console.error("Failed to generate salary:",o),_(o)}};return e.jsx(B,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(v?q:I),className:"w-full p-4 rounded-lg  space-y-6",children:[e.jsx("h2",{className:"font-semibold mb-6",children:"Estimate Salary"}),e.jsx(k,{children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-5 p-5 ",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"employees",className:"text-sm font-medium",children:"Employees *"}),e.jsx(D,{value:t,className:"min-h-16",onSearch:P,onChange:a=>n(a),hidePlaceholderWhenSelected:!0,placeholder:"Search employees",loadingIndicator:e.jsx("span",{children:"Loading..."}),emptyIndicator:e.jsx("span",{children:"No options found"})})]}),e.jsxs("div",{className:"space-y-2 flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium mt-1",children:"Month and Year *"}),e.jsx(V,{selected:r,onChange:a=>x(a),dateFormat:"MM/yyyy",showMonthYearPicker:!0,placeholderText:"Select month and year",className:"border rounded p-2 w-full bg-none bg_remove"})]}),v?e.jsxs(e.Fragment,{children:[e.jsx(f,{control:i.control,name:"bank_advice_no",render:({field:a})=>e.jsxs(S,{children:[e.jsx(b,{children:"Bank Advice No"}),e.jsx(N,{children:e.jsx(E,{placeholder:"Enter Bank Advice No",...a})}),e.jsx(g,{})]})}),e.jsx(f,{control:i.control,name:"bank_date",render:({field:a})=>e.jsxs(S,{children:[e.jsx(b,{children:"Bank Date"}),e.jsxs(H,{children:[e.jsx(Q,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?h(a.value,"PP"):"Pick a date",e.jsx(J,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(L,{className:"w-auto p-0",align:"start",children:e.jsx(O,{mode:"single",selected:a.value??void 0,onSelect:c=>a.onChange(c),initialFocus:!0})})]}),e.jsx(g,{})]})}),e.jsx(f,{control:i.control,name:"note",render:({field:a})=>e.jsxs(S,{children:[e.jsx(b,{children:"Comment"}),e.jsx(N,{children:e.jsx(E,{placeholder:"Enter your comment",...a})}),e.jsx(g,{})]})}),e.jsx("div",{className:"col-span-5 flex justify-end items-center mt-auto",children:e.jsx(j,{variant:"default",type:"submit",className:"w-fit px-14  ",children:"Generate"})})]}):e.jsx("div",{className:"pt-7 col-span-3 flex justify-end items-center mt-auto",children:e.jsx(j,{variant:"default",type:"submit",className:"w-fit px-14 mt-[3px]",children:"Estimate"})})]})})]})})}function ae({salaryData:s}){if(!s||s.length===0)return e.jsx("p",{});const t=s.reduce((n,r)=>n+r.total,0);return e.jsx("div",{className:"w-full p-5 space-y-4",children:e.jsxs(k,{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold ",children:"Estimate Salary Information"}),e.jsxs("div",{children:["Total : ",e.jsx("span",{children:t})]})]}),e.jsx("div",{className:"rounded-md border mt-3",children:e.jsxs(Y,{children:[e.jsx(z,{children:e.jsxs(T,{className:"",children:[e.jsx(u,{className:"",children:"Employee Name"}),e.jsx(u,{className:"",children:"Allowance"}),e.jsx(u,{className:"",children:"Deduction"}),e.jsx(u,{className:"",children:"Total"})]})}),e.jsx(K,{children:s.map((n,r)=>e.jsxs(T,{children:[e.jsx(y,{children:n.employee_name}),e.jsx(y,{children:n.allowance}),e.jsx(y,{children:n.deduction}),e.jsx(y,{children:n.total})]},r))})]})}),e.jsx("div",{className:"mt-4 grid place-items-end",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("h3",{className:"font-semibold ",children:"Total Estimate Salary:"}),e.jsx("p",{className:"font-semibold ",children:t})]})})]})})}function ce(){const[s,t]=d.useState([]),n=r=>{t(r)};return e.jsxs("div",{children:[e.jsx(ee,{onShowEstimateSalary:n}),e.jsx(ae,{salaryData:s})]})}export{ce as default};
