import{y as K,r as P,dl as W,B as X,D as Y,dm as T,ab as c,bM as Z,dn as ee,dp as g,a as e,aJ as ae,V as h,G as te,W as Q,aU as se,H as d,J as i,K as u,N as b,I as B,Q as m,a9 as F,aa as D,aV as M,ac as O,ad as q,b1 as ne,b2 as re,b3 as le,b4 as oe,b6 as ce,bs as de,dq as ie,dr as ue,ds as me,av as k,aw as xe}from"./index-f6b2a986.js";import{b as je,c as he,d as ye}from"./index-7d3ce5ce.js";function ge(){const _=K(),[l,I]=P.useState([]),[f,z]=P.useState({sales_order_date:!1,delivery_date:!1,due_date:!1}),S=a=>{z(t=>({...t,[a]:!t[a]}))},{data:w,isLoading:L}=W("page=1&per_page=1000"),$=(w==null?void 0:w.data)||[],[G]=je(),s=X({resolver:Y(me),defaultValues:{total:0,tax_type:T[1].id.toString(),date:c(new Date,"yyyy-MM-dd")}}),J=Z(),N=Number(J.id),{data:C}=he(N,{skip:!N}),[U]=ye(),n=(C==null?void 0:C.data)||void 0;P.useEffect(()=>{if(n){const a=n.details.map(t=>({barcodeId:t.item_barcode.id,quantity:t.qty,price:t.price,tax:t.tax||void 0,units:[],unit:t.unit,barcode:t.item_barcode.barcode,name:t.item.name,barcodeAttribute:t.item_barcode.barcode_attribute,note:t.note}));I(a),s.reset({discount:n.discount,tax_type:n.tax_type,total:n.total,contact_id:String(n.contact.id),date:n.date||"",due_date:n.due_date||"",delivery_date:n.delivery_date||"",note:n.note||"",terms_conditions:n.terms_conditions||"",sub_total:n.sub_total,reference:n.reference||"",tax:n.tax})}},[n,s]);const H=s.watch("discount"),V=s.watch("tax_type");let x=0,y=0,j=0;l&&l.length>0&&(l==null||l.forEach(a=>{var A,E;const t=a.price*a.quantity,r=t*(H??0)/100,o=t-r,p=V==="inclusive"?ee(o,((A=a.tax)==null?void 0:A.amount)||0):o*(((E=a.tax)==null?void 0:E.amount)||0)/100;x+=t,y+=r,j+=p}));let v=x-y+(V==="inclusive"?0:j);x=g(x),y=g(y),j=g(j),v=g(v),s.setValue("sub_total",x),s.setValue("tax",j),s.setValue("total",v);async function R(a){if(l.length===0)return k.error("Please select at least one product");const t={...a,details:l.map(r=>{var o;return{item_barcode_id:r.barcodeId,tax_id:(o=r.tax)==null?void 0:o.id,unit_id:r.unit.id,qty:r.quantity,price:r.price,total:r.price*r.quantity,note:r.note||""}})};try{n?(await U({salesOrderId:N,updatedSalesOrder:t}).unwrap(),k.success("Quote updated successfully")):(await G(t).unwrap(),k.success("Quote created successfully")),_("/billing/quotes")}catch(r){xe(r)}}return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(ae,{title:n?"Edit Quote":"Add quote",description:"Manage your sub accounts for you business"}),e.jsx(h,{onClick:()=>_("/billing/quotes"),size:"sm",children:"quotes List"})]}),e.jsx(te,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(R),className:"space-y-3 mb-4  overflow-y-scroll no-scrollbar",children:[e.jsx("div",{className:"",children:e.jsx(Q,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(se,{loading:L,data:$,displayField:"name",valueField:"id",form:s,name:"contact_id",placeholder:"Select Customer",title:"Customer Name",className:"w-full"}),e.jsx(d,{control:s.control,name:"reference",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Reference"}),e.jsx(b,{children:e.jsx(B,{placeholder:"Enter reference",...a})}),e.jsx(m,{})]})}),e.jsx(d,{control:s.control,name:"date",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Date"}),e.jsxs(F,{open:f.sales_order_date,onOpenChange:()=>S("sales_order_date"),children:[e.jsx(D,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?c(a.value,"PP"):"Pick a date",e.jsx(M,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(O,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(q,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:t=>{a.onChange(t?c(t,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(m,{})]})}),e.jsx(d,{control:s.control,name:"due_date",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Due Date"}),e.jsxs(F,{open:f.due_date,onOpenChange:()=>S("due_date"),children:[e.jsx(D,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?c(a.value,"PP"):"Pick a date",e.jsx(M,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(O,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(q,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:t=>{a.onChange(t?c(t,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(m,{})]})}),e.jsx(d,{control:s.control,name:"delivery_date",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Delivery Date"}),e.jsxs(F,{open:f.delivery_date,onOpenChange:()=>S("delivery_date"),children:[e.jsx(D,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?c(a.value,"PP"):"Pick a date",e.jsx(M,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(O,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(q,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:t=>{a.onChange(t?c(t,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(m,{})]})}),e.jsx("div",{className:"w-full",children:e.jsx(d,{control:s.control,name:"tax_type",render:({field:a})=>{var t,r,o;return e.jsxs(i,{children:[e.jsx(u,{children:"Tax Type"}),e.jsxs(ne,{onValueChange:a.onChange,defaultValue:String((r=(t=T)==null?void 0:t[1])==null?void 0:r.id),children:[e.jsx(b,{children:e.jsx(re,{children:e.jsx(le,{placeholder:"Select Tax Type"})})}),e.jsx(oe,{children:(o=T)==null?void 0:o.map(p=>e.jsx(ce,{value:String(p.id),children:p.name},p.id))})]}),e.jsx(m,{})]})}})}),e.jsx(d,{control:s.control,name:"note",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Note"}),e.jsx(b,{children:e.jsx(B,{placeholder:"Type Note.",...a})}),e.jsx(m,{})]})}),e.jsx(d,{control:s.control,name:"terms_conditions",render:({field:a})=>e.jsxs(i,{children:[e.jsx(u,{children:"Terms and conditions"}),e.jsx(b,{children:e.jsx(de,{placeholder:"Type terms and conditions.",...a})}),e.jsx(m,{})]})})]})})}),e.jsx(Q,{className:"mb-4",children:e.jsx(ie,{setSelectedProducts:I,selectedProducts:l})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(ue,{form:s,subTotal:x,discountedAmount:y,totalTaxAmount:j,grandTotal:v})}),e.jsxs("div",{className:"text-right",children:[e.jsx(h,{type:"button",onClick:()=>_("/billing/quotes"),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(h,{variant:"default",type:"submit",className:"w-fit mt-4",children:n?"Update":"Add"})]})]})})]})})}export{ge as default};
