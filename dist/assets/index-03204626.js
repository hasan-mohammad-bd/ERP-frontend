import{bR as re,c4 as $e,bi as Ae,r,a as e,H as M,J as y,b as A,K as f,a6 as K,a7 as G,M as b,Q as v,c5 as Te,a9 as Q,c6 as Ie,c7 as Oe,c8 as ke,c9 as Ee,ca as He,cb as Ue,cc as Ve,N as L,B as ge,D as fe,a8 as C,cd as ze,ar as Y,G as Se,I as p,aQ as Be,aZ as _e,a_ as ye,a$ as Ne,b0 as Ce,b2 as be,aR as oe,aa as me,ce as Ke,cf as Ge,as as T,at as Qe,aw as V,ax as z,ay as he,az as Je,aA as B,aB as Ye,aC as We,aD as J,aE as xe,cg as je,ch as Ze,R as Xe,aG as De,aH as es,aI as ss,aJ as ts}from"./index-2b34b619.js";import{l as ls,a as ns}from"./leave-a0710717.js";import{S as as}from"./switch-c8ddae14.js";import{u as cs}from"./leave-summay-6a96bf5e.js";function is(t,s){const a=re(t),m=re(s),d=ue(a,m),h=Math.abs($e(a,m));a.setDate(a.getDate()-d*h);const o=+(ue(a,m)===-d),u=d*(h-o);return u===0?0:u}function ue(t,s){const a=t.getFullYear()-s.getFullYear()||t.getMonth()-s.getMonth()||t.getDate()-s.getDate()||t.getHours()-s.getHours()||t.getMinutes()-s.getMinutes()||t.getSeconds()-s.getSeconds()||t.getMilliseconds()-s.getMilliseconds();return a<0?-1:a>0?1:a}const ds=Ae.injectEndpoints({endpoints:t=>({getLeaveRequests:t.query({query:s=>`leaves?${s}`,providesTags:["leaves"]}),createLeaveRequest:t.mutation({query:s=>({url:"leaves",method:"POST",body:s}),invalidatesTags:["leaves"]}),changeLeaveStatus:t.mutation({query:s=>({url:"leaves/status-update",method:"POST",body:s}),invalidatesTags:["change-leave-status","leaves"]}),removeLeaveRequest:t.mutation({query:s=>({url:`leaves/${s}`,method:"DELETE"}),invalidatesTags:["leaves"]}),updateLeaveRequest:t.mutation({query:({leaveRequestId:s,updatedLeaveRequest:a})=>({url:`leaves/${s}`,method:"POST",body:a}),invalidatesTags:["leaves"]})}),overrideExisting:!1}),{useGetLeaveRequestsQuery:rs,useCreateLeaveRequestMutation:os,useChangeLeaveStatusMutation:ms,useRemoveLeaveRequestMutation:hs,useUpdateLeaveRequestMutation:xs}=ds,js=({form:t,name:s,title:a,data:m,className:d,valueField:h,displayField:o,placeholder:u="Select an option",searchTerm:x,setSearchTerm:n})=>{const[w,q]=r.useState(!1),$=r.useMemo(()=>m.filter(S=>String(S[o]).toLowerCase().includes((x==null?void 0:x.toLowerCase())||"")),[m,o,x]);return e.jsx(M,{control:t.control,name:s,render:({field:S})=>{const g=m.find(N=>String(N[h])===S.value);return e.jsxs(y,{className:A("w-full"),children:[e.jsx(f,{children:a}),e.jsxs(K,{open:w,onOpenChange:q,modal:!0,children:[e.jsx(G,{asChild:!0,children:e.jsx(b,{children:e.jsxs(v,{variant:"outline",role:"combobox",className:A("w-full justify-between",!S.value&&"text-muted-foreground"),children:[g?String(g[o]):u,e.jsx(Te,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(Q,{className:A("p-0 w-full",d),children:e.jsxs(Ie,{children:[e.jsx(Oe,{placeholder:"Search...",value:x,onValueChange:n}),e.jsx(ke,{children:$.length===0?e.jsx(Ee,{children:"No results found."}):e.jsx(He,{children:$.map((N,_)=>e.jsxs(Ue,{onSelect:()=>{S.onChange(String(N[h])),q(!1)},children:[e.jsx(Ve,{className:A("mr-2 h-4 w-4",S.value===String(N[h])?"opacity-100":"opacity-0")}),String(N[o])]},_))})})]})})]}),e.jsx(L,{})]})}})};function ve({modalClose:t,data:s,refetch:a}){var te,le,ne,ae,ce,ie,de;const[m,{data:d}]=cs(),[h,{isLoading:o}]=os(),[u,{isLoading:x}]=xs();console.log(d==null?void 0:d.data);const n=ge({resolver:fe(ls),defaultValues:{employee_id:(s==null?void 0:s.employee_id.toString())||"",start_date_time:(s==null?void 0:s.start_date_time)||"",end_date_time:(s==null?void 0:s.end_date_time)||"",subject:(s==null?void 0:s.subject)||"",description:(s==null?void 0:s.description)||"",leave_type_id:(s==null?void 0:s.leave_type.id.toString())||"",status:(s==null?void 0:s.status)||"Pending",files:(s==null?void 0:s.files)||[]}}),[w,q]=r.useState(!1),[$,S]=r.useState(!1),[g,N]=r.useState(null),[_,W]=r.useState(null),[we,qe]=r.useState([]),[I,Le]=r.useState(!1),[R,Z]=r.useState(""),[P,X]=r.useState(""),[O,D]=r.useState("");console.log(O,"searchTerm");const k=["Pending","Canceled","Approved","Rejected"];r.useEffect(()=>{s&&(Z(C(new Date(s==null?void 0:s.start_date_time),"HH:mm")),X(C(new Date(s==null?void 0:s.end_date_time),"HH:mm")),N(new Date(s==null?void 0:s.start_date_time)),W(new Date(s==null?void 0:s.end_date_time)))},[s]);const E=(d==null?void 0:d.data)||[],Me=n.watch("employee_id"),i=E.find(l=>l.id===Number(Me)),Re=n.watch("leave_type_id"),c=i==null?void 0:i.leave_types.find(l=>l.id===Number(Re)),Pe=l=>{var F;if(!l)return;N(l);const j=R&&`${R}:00`||((F=i==null?void 0:i.schedule)==null?void 0:F.start_time);console.log(j,"validTimeStart"),n.setValue("start_date_time",`${C(l,"yyyy-MM-dd")} ${j}`),q(!1)},Fe=l=>{var F;if(!l)return;W(l);const j=P&&`${P}:00`||((F=i==null?void 0:i.schedule)==null?void 0:F.end_time);n.setValue("end_date_time",`${C(l,"yyyy-MM-dd")} ${j}`),S(!1)};r.useEffect(()=>{var l;if(g){const j=R&&`${R}:00`||((l=i==null?void 0:i.schedule)==null?void 0:l.start_time);n.setValue("start_date_time",`${C(g,"yyyy-MM-dd")} ${j}`)}},[R,g,n,(te=i==null?void 0:i.schedule)==null?void 0:te.start_time]),r.useEffect(()=>{var l;if(_){const j=P&&`${P}:00`||((l=i==null?void 0:i.schedule)==null?void 0:l.end_time);n.setValue("end_date_time",`${C(_,"yyyy-MM-dd")} ${j}`)}},[P,_,n,(le=i==null?void 0:i.schedule)==null?void 0:le.end_time]);const H=n.watch("start_date_time"),ee=n.watch("end_date_time");console.log(H);const se=(H&&ee?is(ee.slice(0,10),H.slice(0,10)):0)+1;async function pe(l){console.log(l);try{const j=Ge.serialize({...l,_method:s?"PUT":"POST",files:we},{indices:!0});s?(await u({leaveRequestId:s.id,updatedLeaveRequest:j}).unwrap(),T.success("Leave Request updated successfully"),t()):(await h(j).unwrap(),T.success("Leave Request created successfully"),t())}catch(j){console.log(j),Qe(j)}}r.useEffect(()=>{s!=null&&s.employee_id&&D(s==null?void 0:s.employee_id.toString())},[s==null?void 0:s.employee_id]);const U=ze(O,300);return r.useEffect(()=>{U&&m&&m(`text=${U}`)},[U,m,s==null?void 0:s.employee_id]),console.log(E,"searchResultData"),e.jsx(e.Fragment,{children:o||x?e.jsx("div",{children:e.jsx(Y,{})}):e.jsx(Se,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(pe),className:"space-y-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-end space-x-4",children:[e.jsx("div",{className:"w-full",children:s!=null&&s.employee_id?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"",children:"Employee Name"}),e.jsx(p,{className:"mt-2",disabled:!0,value:(ne=s==null?void 0:s.employee)==null?void 0:ne.first_name})]}):e.jsx(js,{data:E,displayField:"first_name",valueField:"id",form:n,name:"employee_id",title:"Employee",searchTerm:O,setSearchTerm:D,className:"w-[360px]"})}),e.jsx("div",{className:"w-full flex items-center",children:e.jsx(Be,{data:(i==null?void 0:i.leave_types)||[],displayField:"name",valueField:"id",form:n,name:"leave_type_id",title:`Leave Type ${(ae=c==null?void 0:c.available)!=null&&ae.total_days?`(Leave Left: ${(ce=c==null?void 0:c.available)==null?void 0:ce.total_days} days)`:""} ${(ie=c==null?void 0:c.available)!=null&&ie.total_hours?`, ( ${(de=c==null?void 0:c.available)==null?void 0:de.total_hours} hours)`:""}`,className:"w-[290px]"})}),s&&e.jsx("div",{className:"w-full",children:e.jsx(M,{control:n.control,name:"status",render:({field:l})=>e.jsxs(y,{children:[e.jsx(f,{children:"Status"}),e.jsxs(_e,{onValueChange:l.onChange,defaultValue:s.status?String(s.status):void 0,children:[e.jsx(b,{children:e.jsx(ye,{children:e.jsx(Ne,{placeholder:"Select Status"})})}),e.jsx(Ce,{children:k==null?void 0:k.map(j=>e.jsx(be,{value:String(j),children:j},j))})]}),e.jsx(L,{})]})})})]}),e.jsxs("div",{className:"flex justify-between items-center gap-x-4",children:[e.jsxs("div",{className:"w-full flex items-center gap-x-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(M,{control:n.control,name:"start_date_time",render:()=>e.jsxs(y,{children:[e.jsx(f,{children:"Start Date"}),e.jsxs(K,{open:w,onOpenChange:q,children:[e.jsx(G,{asChild:!0,className:"",children:e.jsxs(v,{variant:"outline",className:`w-full justify-start text-left font-normal ${!g&&"text-muted-foreground"}`,children:[g?C(g,"PP"):"Pick a date",e.jsx(oe,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(Q,{className:"w-auto p-0",align:"start",children:e.jsx(me,{mode:"single",selected:g??void 0,onSelect:Pe,initialFocus:!0})})]})]})})}),I&&e.jsx("div",{className:"w-full",children:e.jsxs(y,{children:[e.jsx(f,{children:"Time Start"}),e.jsx(b,{children:e.jsx(p,{type:"time",value:R,onChange:l=>Z(l.target.value)})}),e.jsx(L,{})]})})]}),e.jsxs("div",{className:"w-full flex items-center gap-x-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(M,{control:n.control,name:"end_date_time",render:()=>e.jsxs(y,{children:[e.jsx(f,{children:"End Date"}),e.jsxs(K,{open:$,onOpenChange:S,children:[e.jsx(G,{asChild:!0,className:"",children:e.jsxs(v,{variant:"outline",className:`w-full justify-start text-left font-normal ${!_&&"text-muted-foreground"}`,children:[_?C(_,"PP"):"Pick a date",e.jsx(oe,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(Q,{className:"w-auto p-0",align:"start",children:e.jsx(me,{mode:"single",disabled:l=>!!(g&&l<g),selected:_??void 0,onSelect:Fe,initialFocus:!0})})]}),e.jsx(L,{children:(c==null?void 0:c.available)&&se>c.available.total_days&&e.jsx("span",{className:"text-red-500",children:"Total Leave Days Exceed"})})]})})}),I&&e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"w-full",children:e.jsxs(y,{children:[e.jsx(f,{children:"Time End"}),e.jsx(b,{children:e.jsx(p,{type:"time",value:P,onChange:l=>X(l.target.value)})}),e.jsx(L,{})]})})})]})]}),e.jsx("div",{}),e.jsxs("div",{className:"!mt-5 flex justify-start items-center",children:[e.jsx(b,{children:e.jsx(as,{className:" ",checked:I,onCheckedChange:l=>Le(!!l)})}),e.jsx("span",{className:"ml-2 text-sm",children:"Consider Hours"})]}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(M,{control:n.control,name:"subject",render:({field:l})=>e.jsxs(y,{children:[e.jsx(f,{children:"Subject"}),e.jsx(b,{children:e.jsx(p,{className:"",placeholder:"Enter Subject",...l,value:l.value||""})}),e.jsx(L,{})]})})}),e.jsx("div",{className:"w-full",children:e.jsx(M,{control:n.control,name:"description",render:({field:l})=>e.jsxs(y,{children:[e.jsx(f,{children:"Description"}),e.jsx(b,{children:e.jsx(p,{className:"",placeholder:"Enter Description",...l,value:l.value||""})}),e.jsx(L,{})]})})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Upload Files"}),e.jsx(Ke,{setUploadedFiles:qe,uploadedFiles:s==null?void 0:s.files,onDeleteSuccess:()=>a()})]})]}),e.jsx("div",{className:"text-right flex items-center justify-end gap-x-3",children:e.jsx(v,{disabled:!!(c!=null&&c.available.total_days&&(c==null?void 0:c.available.total_days)<=0)||!!(c!=null&&c.available&&se>c.available.total_days),variant:"default",type:"submit",className:"w-fit mt-4",children:s?"Update":"Add"})})]})})})}function us({data:t}){var x,n;const[s,a]=r.useState(!1),[m,d]=r.useState(!1),[h,{isLoading:o}]=hs(),u=async w=>{try{await h(w),T.success("Leave deleted successfully"),a(!1)}catch(q){console.log(q)}};return e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(V,{children:e.jsxs(z,{children:[e.jsx(he,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>d(!0),children:e.jsx(Je,{className:"h-4 w-4 text-foreground"})})}),e.jsx(B,{children:e.jsx("p",{children:"Update Leave Request"})})]})}),e.jsx(V,{children:e.jsx(z,{children:e.jsx(B,{children:e.jsx("p",{children:"Delete Leave Request"})})})}),e.jsx(V,{children:e.jsxs(z,{children:[e.jsx(he,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>{a(!0)},children:e.jsx(Ye,{className:"h-4 w-4 text-foreground"})})}),e.jsx(B,{children:e.jsx("p",{children:"Delete Requisition"})})]})}),e.jsx(We,{title:"Are you sure?",description:"This action cannot be undone.",name:((x=t==null?void 0:t.employee)==null?void 0:x.first_name)+" "+((n=t==null?void 0:t.employee)==null?void 0:n.last_name),isOpen:s,onClose:()=>a(!1),onConfirm:()=>u(t.id),loading:o}),m&&e.jsx(J,{title:"Update Leave Request",isOpen:m,toggleModal:()=>d(!1),className:"w-3/5 max-w-3xl",children:e.jsx(ve,{data:t,modalClose:()=>d(!1)})})]})}const gs=[{id:"select",header:({table:t})=>e.jsx(xe,{checked:t.getIsAllPageRowsSelected()||t.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:s=>t.toggleAllPageRowsSelected(!!s),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:t})=>e.jsx(xe,{checked:t.getIsSelected(),onCheckedChange:s=>t.toggleSelected(!!s),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"Employee name",cell:({row:t})=>t.original.employee.first_name+" "+t.original.employee.last_name},{accessorKey:"leave_type",header:"Leave type",cell:({row:t})=>t.original.leave_type.name},{accessorKey:"start_date_time",header:"Start Date",cell:({row:t})=>je(t.original.start_date_time)},{accessorKey:"end_date_time",header:"End Date",cell:({row:t})=>je(t.original.end_date_time)},{header:"Approval Status",cell:({row:t})=>{var s;return Ze((s=t.original.approval)==null?void 0:s.status)}},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),enableSorting:!1,cell:({row:t})=>e.jsx(us,{data:t.original})}];function fs({payload:t,modelClose:s}){const a=["Pending","Canceled","Approved","Rejected"];console.log(t);const[m,{isLoading:d}]=ms(),h=ge({resolver:fe(ns),defaultValues:{ids:t==null?void 0:t.map(u=>u.id),status:"Pending"}});async function o(u){const x={...u,ids:(t==null?void 0:t.map(n=>n.id))||[]};try{await m(x),T.success("Leave request updated successfully"),s&&s()}catch(n){console.log(n)}}return e.jsx(e.Fragment,{children:d?e.jsx("div",{className:"",children:e.jsx(Y,{})}):e.jsx("div",{className:"flex gap-x-4",children:e.jsxs("div",{className:" w-full ",children:[(t==null?void 0:t.length)===0?e.jsx("span",{className:"text-red-500 text-sm",children:"Please select leave request to change status"}):null,e.jsx(Se,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(o),className:"",children:[e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsx("div",{className:"w-full",children:e.jsx(M,{control:h.control,name:"status",render:({field:u})=>e.jsxs(y,{children:[e.jsx(f,{children:"Status"}),e.jsxs(_e,{onValueChange:u.onChange,children:[e.jsx(b,{children:e.jsx(ye,{children:e.jsx(Ne,{placeholder:"Select Status"})})}),e.jsx(Ce,{children:a==null?void 0:a.map(x=>e.jsx(be,{value:String(x),children:x},x))})]})]})})})}),e.jsx("div",{children:e.jsx(v,{variant:"default",type:"submit",className:"w-full mt-4",children:"Save"})})]})})]})})})}const Ss=[{label:"Change Leave Status",value:"change-leave-status"}],vs=()=>{const[t,s]=r.useState(!1),[a,m]=Xe.useState({pageIndex:0,pageSize:10}),[d,h]=r.useState({action:"",payload:[]}),{data:o,isLoading:u,refetch:x}=rs(`per_page=${a.pageSize}&page=${a.pageIndex+1}`),n=(o==null?void 0:o.data)||[],w=o==null?void 0:o.meta;return u?e.jsx(Y,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(De,{title:"Leave Request",description:"Manage job apply for you business"}),e.jsxs(v,{onClick:()=>s(!0),size:"sm",children:[e.jsx(es,{className:"mr-2 h-4 w-4"})," Add Leave Request"]})]}),e.jsx(ss,{}),n&&e.jsx("div",{children:e.jsx(ts,{columns:gs,data:n,paginationInfo:w,pagination:a,setPagination:m,bulkActions:Ss,onBulkSelectChange:h})})]})}),t&&e.jsx(J,{title:"Add Leave Request",isOpen:t,toggleModal:()=>s(!1),className:"w-3/5 max-w-3xl",children:e.jsx(ve,{refetch:x,modalClose:()=>s(!1)})}),d.action==="change-leave-status"&&e.jsx(J,{title:"Change Leave Status",toggleModal:()=>h({action:"",payload:[]}),isOpen:d.action==="change-leave-status",className:"!h-fit",children:e.jsx(fs,{payload:d.payload,modelClose:()=>h({action:"",payload:[]})})})]})};export{vs as default};
