import{_ as i,D as _,r as h,e6 as z,e7 as D,G as L,b$ as H,e8 as U,a as e,aM as B,Y as c,K as G,Z as g,N as y,Q as N,V as f,W as v,I as x,X as S,b4 as Q,b5 as R,b6 as Y,b7 as J,b9 as P,aH as K,aN as W,H as X,ay as o,az as Z}from"./index-68967a8a.js";const $=i.object({id:i.number({required_error:"The ID is required."}),name:i.string({required_error:"The name is required."}),probability:i.number({required_error:"The probability is required."})}),C=i.object({name:i.string().min(2,{message:"Name must be at least 2 characters."}),status:i.union([i.literal(1),i.literal(0)]).default(1),details:$.array().optional()});C.extend({id:i.coerce.number().int()});function ee(){const m=_(),[n,d]=h.useState([]),[w,{isLoading:F}]=z(),[I,{isLoading:E}]=D(),l=L({resolver:X(C),defaultValues:{name:"",status:1,details:[]}}),q=H(),p=Number(q.id),{data:u}=U(p,{skip:!p}),t=(u==null?void 0:u.data)||void 0;h.useEffect(()=>{t&&t.details&&d(t.details.map(s=>({...s})))},[t]),h.useEffect(()=>{t&&l.reset({name:t.name,status:t.status})},[t]);const A=()=>{d([...n,{probability:0,name:"",id:0}])},j=(s,a)=>{const{name:r,value:T}=a.target;d(n.map((b,V)=>V===s?{...b,[r]:T}:b))};async function k(s){if(n.length===0)return o.error("Please add at least one Stage");const a={...s,details:n};try{t?(await I({pipelineId:p,updatedPipeline:a}).unwrap(),o.success("Pipeline updated successfully")):(await w(a).unwrap(),o.success("Pipeline created successfully")),m("/crm/lead/pipelines")}catch(r){Z(r)}}const M=s=>{if(n.length<=1)return o.error("You must have at least one stage.");d(n.filter((a,r)=>r!==s))};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(B,{title:t?"Edit Pipeline":"Add Pipeline",description:"Manage your pipelines"}),e.jsx(c,{onClick:()=>m("/crm/lead/pipelines"),size:"sm",children:"Pipeline List"})]}),e.jsx(G,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(k),className:"space-y-3",children:[e.jsx(g,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(y,{control:l.control,name:"name",render:({field:s})=>e.jsxs(N,{children:[e.jsx(f,{children:"Pipeline Name"}),e.jsx(v,{children:e.jsx(x,{placeholder:"Enter Pipeline Name",...s})}),e.jsx(S,{})]})}),e.jsx(y,{control:l.control,name:"status",render:({field:s})=>e.jsxs(N,{children:[e.jsx(f,{children:"Status"}),e.jsxs(Q,{onValueChange:a=>s.onChange(Number(a)),value:String(s.value),children:[e.jsx(v,{children:e.jsx(R,{children:e.jsx(Y,{placeholder:"Select Status"})})}),e.jsxs(J,{children:[e.jsx(P,{value:"1",children:"Active"}),e.jsx(P,{value:"0",children:"Inactive"})]})]}),e.jsx(S,{})]})})]})}),e.jsxs(g,{className:"p-4",children:[e.jsx("div",{className:"mb-4 font-medium",children:"Pipeline Stages"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-4 py-2 border",children:"Name"}),e.jsx("th",{className:"px-4 py-2 border",children:"Probability (%)"}),e.jsx("th",{className:"px-4 py-2 border"})]})}),e.jsx("tbody",{children:n.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:e.jsx(x,{name:"name",value:s.name,onChange:r=>j(a,r)})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx(x,{type:"number",name:"probability",value:s.probability,onChange:r=>j(a,r),min:"1",step:"1"})}),e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>M(a),children:e.jsx(K,{className:"h-4 w-4 text-red-500"})})})]},a))})]})}),e.jsxs(c,{type:"button",onClick:A,className:"mt-2",children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," Add Stage"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{type:"button",onClick:()=>m("/crm/lead/pipelines"),className:"mr-2",variant:"ghost",children:"Cancel"}),e.jsx(c,{disabled:!l.formState.isValid||F||E||n.length===0,type:"submit",children:t?"Update":"Add"})]})]})})]})}export{ee as default};
