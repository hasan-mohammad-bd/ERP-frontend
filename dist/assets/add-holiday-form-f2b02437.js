import{r as N,z,D as A,c8 as I,a as e,av as O,aK as R,W as c,X as F,H as J,J as d,K as m,N as u,Q as x,I as f,V as h,aa as C,ab as $,ac as j,aX as b,ad as P,ae as _,aF as K,aL as X,E as B,aw as S}from"./index-49b05597.js";import{c as Q}from"./index-fe283c40.js";import{s as W}from"./holidays-7325dd2f.js";function Y(){const[y,H]=N.useState({fromDate:[!1],toDate:[!1]}),[k,p]=N.useState([]),[T,{isLoading:v}]=Q(),D=z(),o=A({resolver:B(W),defaultValues:{holidays:[{name:"",start_date:null,end_date:null,duration:"",note:""}]}}),{fields:V,append:E,remove:M}=I({control:o.control,name:"holidays"}),g=(r,a)=>{if(r&&a){const s=a.getTime()-r.getTime(),t=Math.ceil(s/(1e3*60*60*24));return`${t+1} day${t===0?"":"s"}`}return""},L=async r=>{const a={...r,holidays:r.holidays.map(s=>({...s,start_date:s.start_date?j(new Date(s.start_date),"yyyy-MM-dd"):null,end_date:s.end_date?j(new Date(s.end_date),"yyyy-MM-dd"):null}))};try{await T(a),S.success("Holidays Created Successfully!"),D("/hrm/holidays")}catch{S.error("Failed to create holidays!")}},w=(r,a)=>{H(s=>{const t={...s};return a==="fromDate"?(t.fromDate[r]=!t.fromDate[r],t.toDate[r]=!1):(o.getValues(`holidays.${r}.start_date`)?(t.toDate[r]=!t.toDate[r],p(n=>{const i=[...n];return i[r]=!1,i})):p(n=>{const i=[...n];return i[r]=!0,i}),t.fromDate[r]=!1),t})};return e.jsx(e.Fragment,{children:v?e.jsx("div",{className:"h-56",children:e.jsx(O,{})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(R,{title:"Add Holiday",description:""}),e.jsx(c,{size:"sm",onClick:()=>D("/hrm/holidays"),children:"Holiday List"})]}),e.jsx(F,{className:"p-3",children:e.jsx(J,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(L),className:"space-y-3 mb-auto px-2 overflow-y-scroll no-scrollbar",children:[V.map((r,a)=>e.jsx(F,{className:"p-3",children:e.jsxs("div",{className:"flex w-full gap-x-3",children:[e.jsx("div",{className:"w-[215px]",children:e.jsx(d,{control:o.control,name:`holidays.${a}.name`,render:({field:s})=>e.jsxs(m,{children:[e.jsx(u,{children:a===0&&"Holiday Name"}),e.jsx(x,{children:e.jsx(f,{type:"text",placeholder:"Enter holiday name",...s})}),e.jsx(h,{})]})})}),e.jsx("div",{className:"w-[250px]",children:e.jsx(d,{control:o.control,name:`holidays.${a}.start_date`,render:({field:s})=>e.jsxs(m,{children:[e.jsx(u,{children:a===0&&"From Date"}),e.jsxs(C,{open:y.fromDate[a],onOpenChange:()=>w(a,"fromDate"),children:[e.jsx($,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.value&&"text-muted-foreground"}`,children:[s.value?j(new Date(s.value),"PP"):"Pick a date",e.jsx(b,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(P,{className:"w-auto p-0",align:"start",children:e.jsx(_,{mode:"single",selected:s.value??void 0,onSelect:t=>{s.onChange(t);const l=o.getValues(`holidays.${a}.end_date`);if(t&&l){const n=g(t,l);o.setValue(`holidays.${a}.duration`,n)}},initialFocus:!0})})]}),e.jsx(h,{})]})})}),e.jsx("div",{className:"w-[250px]",children:e.jsx(d,{control:o.control,name:`holidays.${a}.end_date`,render:({field:s})=>e.jsxs(m,{children:[e.jsx(u,{children:a===0&&"To Date"}),e.jsxs(C,{open:y.toDate[a],onOpenChange:()=>w(a,"toDate"),children:[e.jsx($,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.value&&"text-muted-foreground"}`,children:[s.value?j(new Date(s.value),"PP"):"Pick a date",e.jsx(b,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(P,{className:"w-auto p-0",align:"start",children:e.jsx(_,{mode:"single",selected:s.value??void 0,disabled:t=>{const l=o.getValues(`holidays.${a}.start_date`);return!!(l&&t<l)},onSelect:t=>{s.onChange(t);const l=o.getValues(`holidays.${a}.start_date`);if(l&&t){const n=g(l,t);o.setValue(`holidays.${a}.duration`,n)}},initialFocus:!0})})]}),k[a]&&e.jsx(h,{children:"Please select a From Date first."})]})})}),e.jsx("div",{className:"w-[150px]",children:e.jsx(d,{control:o.control,name:`holidays.${a}.duration`,render:({field:s})=>e.jsxs(m,{children:[e.jsx(u,{children:a===0&&"Duration"}),e.jsx(x,{children:e.jsx(f,{type:"text",disabled:!0,...s})}),e.jsx(h,{})]})})}),e.jsx("div",{className:"w-[300px]",children:e.jsx(d,{control:o.control,name:`holidays.${a}.note`,render:({field:s})=>e.jsxs(m,{children:[e.jsx(u,{children:a===0&&"Note"}),e.jsx(x,{children:e.jsx(f,{type:"text",placeholder:"Enter note",...s})}),e.jsx(h,{})]})})}),e.jsx("div",{children:e.jsxs(c,{type:"button",variant:"destructive",className:"mt-6",onClick:()=>M(a),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Remove"]})})]})},r.id)),e.jsxs("div",{className:"flex justify-end items-center space-x-3",children:[e.jsxs(c,{type:"button",variant:"secondary",size:"sm",onClick:()=>E({name:"",start_date:null,end_date:null,duration:"",note:""}),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Add Row"]}),e.jsx(c,{type:"submit",size:"sm",disabled:v,children:"Save"})]})]})})})]})})}export{Y as default};
