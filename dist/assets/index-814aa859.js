import{dr as G,r as h,a as e,az as H,aA as K,aB as V,V as N,aE as B,aD as Q,aF as q,av as L,aH as D,dl as J,dN as W,dM as Y,dT as X,I as R,bb as Z,bc as ee,bd as A,be as ae,bf as se,bg as y,B as te,D as ne,dU as re,du as le,au as $,G as ce,W as oe,H as E,J as O,K as I,a9 as de,aa as ie,ab as z,aV as ue,ac as he,ad as me,Q as U,aU as pe,N as xe,ca as ge,cb as fe,aw as je,aJ as ye,aK as be,aL as Se,aM as ve,aG as Ne}from"./index-66d9c5b6.js";const Ce=G.injectEndpoints({endpoints:s=>({getPurchaseRefunds:s.query({query:t=>`purchase-refunds?${t}`,providesTags:["purchase-refunds"]}),createPurchaseRefund:s.mutation({query:t=>({url:"purchase-refunds",method:"POST",body:t}),invalidatesTags:["purchase-refunds","purchaseReturn","suppliers"]}),removePurchaseRefund:s.mutation({query:t=>({url:`purchase-refunds/${t}`,method:"DELETE"}),invalidatesTags:["purchase-refunds","purchaseReturn","suppliers"]})}),overrideExisting:!1}),{useGetPurchaseRefundsQuery:Pe,useCreatePurchaseRefundMutation:Re,useRemovePurchaseRefundMutation:Te}=Ce;function Fe({rowData:s}){const[t,d]=h.useState(!1),[g,{isLoading:c}]=Te(),i=async f=>{try{await g(f),L.success("Purchase Refund deleted successfully"),d(!1)}catch(u){console.log(u)}};return e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(V,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>{d(!0)},children:e.jsx(B,{className:"h-4 w-4 text-foreground"})})}),e.jsx(Q,{children:e.jsx("p",{children:"Delete Purchase Refund"})})]})}),e.jsx(q,{title:"Are you sure?",description:"This action cannot be undone.",name:s.invoice_number,isOpen:t,onClose:()=>d(!1),onConfirm:()=>i(s.id),loading:c})]})}const we=[{id:"select",header:({table:s})=>e.jsx(D,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:t=>s.toggleAllPageRowsSelected(!!t),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:s})=>e.jsx(D,{checked:s.getIsSelected(),onCheckedChange:t=>s.toggleSelected(!!t),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"invoice_number",header:"Invoice No"},{accessorKey:"date",header:"Date"},{accessorKey:"contact",header:"Supplier Name",cell:({row:s})=>s.original.contact.name},{accessorKey:"amount",header:"Amount",cell:({row:s})=>e.jsx(J,{amount:parseFloat(String(s.original.amount))})},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),enableSorting:!1,cell:({row:s})=>e.jsx(Fe,{rowData:s.original})}];function ke({selectedProducts:s,setSelectedProducts:t,setContactId:d,receivedAmount:g,setReceivedAmount:c}){const[i,f]=h.useState(""),[u,T]=h.useState(null),[F,C]=h.useState(!1),{data:p,isLoading:b}=W("only_due=1&per_page=1000&page=1",{skip:!i}),{data:S}=Y(`only_due=-1&contact_id=${u}&per_page=1000&page=1`,{skip:!u}),P=((p==null?void 0:p.data)||[]).filter(a=>{var l;return(l=a.name)==null?void 0:l.toLowerCase().includes(i.toLowerCase())}),v=(S==null?void 0:S.data.map(a=>({...a,total_due:Math.abs(a.total_due),amount:Math.abs(a.total_due)})))||[],w=(a,l)=>{T(a),f(l),C(!1)},k=a=>{if(s.find(n=>n.id===a.id)){const n=s.filter(m=>m.id!==a.id);t(n),c(n.reduce((m,o)=>m+(o.amount||0),0))}else{const n=[...s,a];t(n),c(n.reduce((m,o)=>m+(o.amount||0),0))}},r=a=>{let l=a;const n=[];for(const m of v){if(l<=0)break;const o=Math.min(m.total_due,l);n.push({...m,amount:o}),l-=o}c(a),t(n)},x=a=>{const l=a.target.value,n=parseFloat(l);(l===""||!isNaN(n))&&(c(n||0),r(n||0))},j=(a,l)=>{const n=s.map(o=>o.id===a?{...o,amount:Math.min(l,o.total_due)}:o);t(n);const m=n.reduce((o,_)=>o+(_.amount||0),0);if(c(m),l===0){const o=n.filter(_=>_.amount!==0);t(o)}};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 relative z-30",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"h-4 px-4 py-[18px] border border-gray-300 flex justify-center items-center rounded-md",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(R,{type:"text",placeholder:"Enter Supplier Name",value:i,onChange:a=>{f(a.target.value),C(!0)},className:"flex-grow"})]}),i&&F&&!b&&P.length>0&&e.jsx("div",{className:"absolute ml-14 bg-gray-50 dark:bg-gray-900",children:e.jsx("ul",{className:"border rounded-lg p-2",children:P.map(a=>e.jsx("li",{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 p-2 text-sm w-full",onClick:()=>{w(a.id,a.name),d(a.id)},children:a.name},a.id))})})]}),e.jsxs(Z,{children:[e.jsx(ee,{className:"border rounded",children:e.jsx(A,{children:["Select","Date","Invoice No","Due Amount","Amount"].map(a=>e.jsx(ae,{children:a},a))})}),e.jsx(se,{children:v.length===0?e.jsx(A,{children:e.jsx(y,{colSpan:5,className:"text-center py-5",children:"No Items Selected Yet"})}):e.jsx(e.Fragment,{children:v.map(a=>{var l;return e.jsxs(A,{children:[e.jsx(y,{children:e.jsx("input",{type:"checkbox",checked:s.some(n=>n.id===a.id),onChange:()=>k(a)})}),e.jsx(y,{children:a.date}),e.jsx(y,{children:a.invoice_number}),e.jsx(y,{children:a.total_due}),e.jsx(y,{children:e.jsx(R,{type:"number",value:((l=s.find(n=>n.id===a.id))==null?void 0:l.amount)||a.total_due,onChange:n=>j(a.id,parseFloat(n.target.value)||0)})})]},a.id)})})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Received Amount*"}),e.jsx(R,{type:"number",value:g===0?"":g,onChange:x})]})]})}function _e({modalClose:s}){const[t,d]=h.useState([]),[g,c]=h.useState(null),[i,f]=h.useState(0),[u,T]=h.useState([]),[F,{isLoading:C}]=Re(),p=te({resolver:ne(re),defaultValues:{}}),{data:b,isLoading:S}=le("page=1&per_page=1000"),M=(b==null?void 0:b.data)||[],[P,v]=h.useState({date:!1,due_date:!1}),w=r=>{v(x=>({...x,[r]:!x[r]}))};async function k(r){if(t.length===0)return L.error("Please select at least one supplier");const x=fe.serialize({...r,contact_id:g,amount:Number(i),details:t.map(j=>({amount:j.amount,purchase_id:j.id})),files:u,_method:"POST"},{indices:!0});try{await F(x).unwrap(),L.success("Purchase Refund created successfully"),s()}catch(j){console.log(j),je(j)}}return e.jsx(e.Fragment,{children:C?e.jsx("div",{children:e.jsx($,{})}):e.jsx(ce,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(k),className:"space-y-3",children:[e.jsx(oe,{className:"mb-4",children:e.jsx(ke,{setSelectedProducts:d,selectedProducts:t,previousData:!1,setContactId:c,receivedAmount:i,setReceivedAmount:f})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 ",children:[e.jsx(E,{control:p.control,name:"date",render:({field:r})=>e.jsxs(O,{children:[e.jsx(I,{children:"Date"}),e.jsxs(de,{open:P.date,onOpenChange:()=>w("date"),children:[e.jsx(ie,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:`w-full justify-start text-left font-normal ${!r.value&&"text-muted-foreground"}`,children:[r.value?z(r.value,"PP"):"Pick a date",e.jsx(ue,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(he,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(me,{mode:"single",selected:r.value?new Date(r.value):void 0,onSelect:x=>{r.onChange(x?z(x,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(U,{})]})}),e.jsx(pe,{loading:S,data:M.filter(r=>r.nature==="Cash"||r.nature==="Bank Accounts"),displayField:"name",valueField:"id",form:p,name:"ledger_account_id",placeholder:"Select Ledger Account",title:"Ledger Account",className:"w-full"}),e.jsx(E,{control:p.control,name:"note",render:({field:r})=>e.jsxs(O,{children:[e.jsx(I,{children:"Note"}),e.jsx(xe,{children:e.jsx(R,{placeholder:"Type Subject.",...r})}),e.jsx(U,{})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Upload Files"}),e.jsx(ge,{setFilesToUpload:T,filesToUpload:u})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(N,{type:"button",onClick:()=>s(),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(N,{variant:"default",type:"submit",className:"w-fit mt-4",children:"Add"})]})]})})})}const Ie=()=>{const[s,t]=h.useState(!1),[d,g]=h.useState({pageIndex:0,pageSize:10}),{data:c,isLoading:i}=Pe(`per_page=${d.pageSize}&page=${d.pageIndex+1}`),f=(c==null?void 0:c.data)||[],u=c==null?void 0:c.meta;return i?e.jsx($,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ye,{title:"Purchase Refunds",description:"Manage your sub accounts for you business"}),e.jsxs(N,{onClick:()=>t(!0),size:"sm",children:[e.jsx(be,{className:"mr-2 h-4 w-4"})," Add Purchase Refund"]})]}),e.jsx(Se,{}),c&&e.jsx("div",{children:e.jsx(ve,{columns:we,data:f,paginationInfo:u,pagination:u&&d,setPagination:u&&g})})]})}),s&&e.jsx(Ne,{title:"Add Purchase Refund",isOpen:s,toggleModal:()=>t(!1),className:"max-w-4xl w-full",children:e.jsx(_e,{modalClose:()=>t(!1)})})]})};export{Ie as default};
