import{cf as T,bp as G,r as o,bY as q,E as V,a as e,aw as P,J as B,K as b,N,Q as L,V as A,bb as R,W as F,ck as H,bx as J,X as C,ax as k,ay as W,b$ as Y,c2 as U,c3 as X,c1 as Z,Y as ee,bm as ae,bV as v,c4 as te,ad as se,aL as ne,aM as ce,aN as re,aO as le,aI as ie,al as oe,am as de,an as _,ao as K,ap as O,aq as M,ar as E}from"./index-fe9eec72.js";const he=[{accessorKey:"employee.name",header:"Employee Name"},{accessorKey:"employee.location.name",header:"Location"},{accessorKey:"employee.department.name",header:"Department"},{accessorKey:"employee.section.name",header:"Section"},{accessorKey:"employee.designation.name",header:"Designation"},{accessorKey:"check_in",header:"Check In",cell:({row:a})=>{var t;return a.original.check_in&&T((t=a.original)==null?void 0:t.check_in)}},{accessorKey:"check_out",header:"Check out",cell:({row:a})=>{var t;return a.original.check_out&&T((t=a.original)==null?void 0:t.check_out)}},{accessorKey:"note",header:"Note"}],ue=G.injectEndpoints({endpoints:a=>({getAttendanceList:a.query({query:t=>`attendances?${t}`,providesTags:["attendance-list"]}),createAttendanceCheckIn:a.mutation({query:t=>({url:"attendance-check-in",method:"POST",body:t}),invalidatesTags:["attendance-list"]}),createAttendanceCheckOut:a.mutation({query:t=>({url:"attendance-check-out",method:"POST",body:t}),invalidatesTags:["attendance-list"]})}),overrideExisting:!1}),{useGetAttendanceListQuery:me,useCreateAttendanceCheckInMutation:pe,useCreateAttendanceCheckOutMutation:xe}=ue;function $({tab:a,modalClose:t}){const[u,m]=o.useState([]),[d]=q(),[j,{isLoading:h}]=pe(),[S,{isLoading:n}]=xe(),r=V({defaultValues:{date_time:new Date}}),x=async s=>{const c=s.trim()||"";try{const{data:i}=await d(`per_page=15&page=1&text=${c}`).unwrap();return(i==null?void 0:i.map(p=>({value:String(p.id),label:`${p.first_name} ${p.last_name} (${p.id})`})))||[]}catch(i){return console.error("Error fetching employees:",i),[]}},y=async s=>{try{a==="check-in"?(await j(s).unwrap(),k.success("CheckIn created successfully!")):(await S(s).unwrap(),k.success("CheckOut created successfully!")),t()}catch(c){console.error("Error recording attendance:",c),W(c)}};return e.jsx(e.Fragment,{children:h||n?e.jsx("div",{className:"h-56",children:e.jsx(P,{})}):e.jsx(B,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(y),className:"w-full space-y-3",children:[e.jsx(b,{control:r.control,name:"employee_ids",render:({field:s})=>e.jsxs(N,{children:[e.jsx(L,{children:"Employee Name"}),e.jsx(A,{children:e.jsx(R,{...s,value:u,onSearch:c=>x(c||""),onChange:c=>{m(c),s.onChange(c.map(i=>parseInt(i.value)))},triggerSearchOnFocus:!0,hidePlaceholderWhenSelected:!0,placeholder:"Search and select options",loadingIndicator:e.jsx("p",{className:"py-2 text-center leading-10 text-muted-foreground",children:"loading..."}),emptyIndicator:e.jsx("p",{className:"w-full text-center leading-10 text-muted-foreground",children:"no results found."})})}),e.jsx(F,{})]})}),e.jsx(b,{control:r.control,name:"date_time",render:({field:s})=>e.jsxs(N,{children:[e.jsx(L,{children:"Punch Time"}),e.jsx(A,{className:"",children:e.jsx(H,{...s,displayFormat:{hour12:"yyyy/MM/dd h:mm a"},value:s.value,onChange:s.onChange,granularity:"minute",hourCycle:12})}),e.jsx(F,{})]})}),e.jsx(b,{control:r.control,name:"note",render:()=>e.jsxs(N,{children:[e.jsx(L,{children:"Note"}),e.jsx(A,{children:e.jsx(J,{...r.register("note")})}),e.jsx(F,{})]})}),e.jsx("div",{children:e.jsx(C,{variant:a==="check-in"?"default":"destructive",type:"submit",className:"w-full mt-4",disabled:h||n,children:h||n?"Submitting...":a==="check-in"?"Check In":"Check Out"})})]})})})}function ye({setFilterParams:a}){const[t,{data:u}]=Y(),[m,{data:d}]=U(),[j,{data:h}]=X(),[S,{data:n}]=Z(),[r,x]=o.useState(void 0),[y,s]=o.useState(void 0),[c,i]=o.useState(void 0),[p,w]=o.useState(void 0),[f,I]=o.useState(void 0),z=()=>{const l=f?se(f,"yyyy-MM-dd"):"",g=new URLSearchParams;r&&g.append("department_id",r.id.toString()),y&&g.append("location_id",y.id.toString()),c&&g.append("schedule_id",c.id.toString()),p&&g.append("section_id",p.id.toString()),f&&g.append("date",l.toString());const Q=g.toString();a(Q),k.success("Filters applied successfully")},D=()=>{x(void 0),s(void 0),i(void 0),w(void 0),I(void 0),a(""),k.success("Filters reset successfully")};return e.jsx(ee,{className:"w-full p-5",children:e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"space-y-2 flex flex-col py-0",children:e.jsx(ae,{selected:f,onChange:l=>{I(l??void 0)},dateFormat:"dd/MM/yyyy",placeholderText:"Select date",className:"border rounded p-[6px] w-full bg-none bg_remove"})}),e.jsx(v,{items:(u==null?void 0:u.data)||[],labelKey:"name",valueKey:"id",value:r,placeholder:"Select Department",onSelect:x,onChangeSearch:l=>t(`text=${l}`)}),e.jsx(v,{items:(d==null?void 0:d.data)||[],labelKey:"name",valueKey:"id",value:y,placeholder:"Select Location",onSelect:s,onChangeSearch:l=>m(`text=${l}`)}),e.jsx(v,{items:(h==null?void 0:h.data)||[],labelKey:"name",valueKey:"id",value:c,placeholder:"Select Shift",onSelect:i,onChangeSearch:l=>j(`text=${l}`)}),e.jsx(v,{items:(n==null?void 0:n.data)||[],labelKey:"name",valueKey:"id",value:p,placeholder:"Select Section",onSelect:w,onChangeSearch:l=>S(`text=${l}`)}),e.jsx(C,{variant:"outline",size:"sm",onClick:D,children:"Reset Filters"}),e.jsxs(C,{variant:"default",size:"sm",onClick:z,children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Apply Filters"]})]})})}const je=()=>{const[a,t]=o.useState("check-in"),[u,m]=o.useState(!1),[d,j]=o.useState({pageIndex:0,pageSize:10}),[h,S]=o.useState(""),{data:n,isLoading:r}=me(`per_page=${d.pageSize}&page=${d.pageIndex+1}&${h}`),x=(n==null?void 0:n.data)||[],y=n==null?void 0:n.meta;return r?e.jsx(P,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ne,{title:"Attendance List",description:"Manage job apply for your business"}),e.jsxs(C,{onClick:()=>m(!0),size:"sm",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," Add Attendance"]})]}),e.jsx(ye,{setFilterParams:S}),e.jsx(re,{}),x.length>0?e.jsx(le,{columns:he,data:x,paginationInfo:y,pagination:d,setPagination:j,className:"py-2 px-4"}):e.jsx("div",{className:"grid place-items-center min-h-[60vh]",children:e.jsx("p",{className:"text-xl",children:"No attendance records found for the selected date or department."})})]})}),u&&e.jsx(ie,{title:"Add Attendance List",isOpen:u,toggleModal:()=>m(!1),className:"w-fit",children:e.jsxs(oe,{defaultValue:a,onValueChange:s=>t(s),className:"w-[400px] mx-auto",children:[e.jsxs(de,{className:"grid w-full grid-cols-2 my-2",children:[e.jsx(_,{value:"check-in",children:"Check In"}),e.jsx(_,{value:"check-out",children:"Check Out"})]}),e.jsxs(K,{value:"check-in",children:[e.jsx(O,{children:e.jsx(M,{children:"Check In"})}),e.jsx(E,{className:"space-y-2",children:e.jsx("div",{className:"space-y-1",children:e.jsx($,{modalClose:()=>m(!1),tab:a})})})]}),e.jsxs(K,{value:"check-out",children:[e.jsx(O,{children:e.jsx(M,{children:"Check Out"})}),e.jsx(E,{className:"space-y-2",children:e.jsx("div",{className:"space-y-1",children:e.jsx($,{modalClose:()=>m(!1),tab:a})})})]})]})})]})};export{je as default};
