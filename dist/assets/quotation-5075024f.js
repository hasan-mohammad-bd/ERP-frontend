import{r as S,dF as F,a as e,dG as k,I as b,bb as M,bc as V,bd as _,be as B,bf as z,bg as h,b1 as E,b2 as I,b3 as H,b4 as Q,b6 as $,V as f,dH as A,aK as D,aE as G,dI as q,X as a}from"./index-8f74661a.js";function K({selectedProducts:x,setSelectedProducts:t,previousData:p}){const[l,o]=S.useState(""),{data:d,isLoading:v,isError:y}=F(`text=${l}&type=molestiae`,{skip:!l}),m=(d==null?void 0:d.data)||[],g=i=>{if(!x.find(r=>r.id===i.id)){const r=i.primary_unit,n=1,c=r.selling_price*n,u=c*(1-r.discount/100),T=u;t(C=>[...C,{...i,unit:r,quantity:n,subTotal:c,total:u,finalPrice:T}])}o("")},j=(i,s)=>{t(r=>r.map(n=>n.id===i?{...n,quantity:s?n.quantity+1:Math.max(1,n.quantity-1),subTotal:n.unit.selling_price*(s?n.quantity+1:Math.max(1,n.quantity-1)),total:n.unit.selling_price*(s?n.quantity+1:Math.max(1,n.quantity-1))*(1-n.unit.discount/100)}:n))},N=(i,s)=>{t(r=>r.map(n=>n.id===i?{...n,unit:s,subTotal:s.selling_price*n.quantity,total:s.selling_price*n.quantity*(1-s.discount/100)}:n))},w=i=>{t(s=>s.filter(r=>r.id!==i))};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 relative z-30",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"h-4 px-4 py-[18px] border border-gray-300 flex justify-center items-center rounded-md",children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx(b,{type:"text",placeholder:"Enter Product Name/Sku/scan barcode",value:l,onChange:i=>o(i.target.value),className:"flex-grow"})]}),l&&!v&&!y&&(m==null?void 0:m.length)>0&&e.jsx("div",{className:"mb-4 absolute ml-14 bg-gray-50 dark:bg-gray-900",children:e.jsx("ul",{className:"border rounded-lg p-2",children:m.map(i=>e.jsxs("li",{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 p-2 text-sm",onClick:()=>g({...i,quantity:1,subTotal:i.primary_unit.selling_price,total:i.primary_unit.selling_price,finalPrice:i.primary_unit.selling_price,unit:i.primary_unit,note:""}),children:[i.name," (Barcode: ",i.barcode,")"]},i.id))})})]}),e.jsxs(M,{children:[e.jsx(V,{className:"border rounded",children:e.jsx(_,{children:["Product Name","Unit","Price","P.O. Quantity","Discount","Total","Note","Action"].map(i=>e.jsx(B,{children:i},i))})}),e.jsx(z,{children:(x==null?void 0:x.length)===0?e.jsx(_,{children:e.jsx(h,{colSpan:11,className:"text-center py-5",children:"No products selected yet."})}):e.jsx(e.Fragment,{children:x.map(i=>e.jsxs(_,{children:[e.jsxs(h,{children:[`${i.name} (${i.barcode_attribute})`,e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Barcode: ",i.barcode]})]}),e.jsx(h,{children:p?i.unit.name:e.jsx("div",{className:"w-64",children:e.jsxs(E,{onValueChange:s=>N(i.id,i.primary_unit.id===Number(s)?i.primary_unit:i.secondary_unit),defaultValue:i.unit.id.toString(),children:[e.jsx(I,{children:e.jsx(H,{placeholder:"Select Unit"})}),e.jsx(Q,{children:[i.primary_unit,i.secondary_unit].map(s=>e.jsx($,{value:String(s.id),children:s.name},s.id))})]})})}),e.jsx(h,{children:e.jsx("div",{className:"w-48",children:e.jsx(b,{id:"price",type:"number",className:"w-full",value:i.unit.selling_price||"",onChange:s=>{const r=s.target.value===""?"":parseFloat(s.target.value);t(n=>n.map(c=>c.id===i.id?{...c,unit:{...c.unit,selling_price:r||0},subTotal:(r||0)*c.quantity,total:(r||0)*c.quantity*(1-(c.unit.discount||0)/100)}:c))}})})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{type:"button",size:"icon",variant:"outline",onClick:()=>j(i.id,!1),children:e.jsx(A,{className:"h-4 w-4"})}),e.jsx("span",{children:i.quantity}),e.jsx(f,{type:"button",size:"icon",variant:"outline",onClick:()=>j(i.id,!0),children:e.jsx(D,{className:"h-4 w-4"})})]})}),e.jsx(h,{children:e.jsx("div",{className:"w-32",children:e.jsx(b,{id:"discount",type:"number",value:i.unit.discount||"",onChange:s=>{const r=s.target.value,n=r===""?0:Math.min(parseFloat(r),100);t(c=>c.map(u=>u.id===i.id?{...u,unit:{...u.unit,discount:n},total:(u.unit.selling_price||0)*u.quantity*(1-n/100)}:u))}})})}),e.jsx(h,{children:i.total.toFixed(2)}),e.jsx(h,{children:e.jsx("div",{className:"w-64",children:e.jsx(b,{id:"note",type:"text",value:i.note||"",onChange:s=>{t(r=>r.map(n=>n.id===i.id?{...n,note:s.target.value}:n))}})})}),e.jsx(h,{children:e.jsx(f,{size:"icon",variant:"destructive",onClick:()=>w(i.id),children:e.jsx(G,{className:"h-4 w-4"})})})]},i.id))})})]})]})}function O({form:x,subTotal:t}){const{watch:p,setValue:l}=x,o=p("discount"),d=p("shipping_charges"),v=t*(o??0)/100,y=t-v+(d??0);return l("total",y),e.jsx("div",{className:"w-full max-w-lg p-6 border rounded-lg shadow",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Sub Total"}),e.jsx("span",{children:t==null?void 0:t.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(q,{htmlFor:"discount",className:"font-medium",children:"Discount"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{id:"discount",type:"number",className:"w-20 mr-2",disabled:!t,value:o??"",onChange:m=>{const g=m.target.value;if(g===""){l("discount",void 0);return}const j=Math.max(0,Math.min(100,parseFloat(g)||0));l("discount",j)},onBlur:()=>{o||l("discount",0)}}),e.jsx("span",{children:"%"})]}),e.jsx("span",{children:o?(t*(o??0)/100).toFixed(2):0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(q,{htmlFor:"shipping_charges",className:"font-medium",children:"Shipping Charges"}),e.jsx("div",{className:"flex items-center",children:e.jsx(b,{id:"shipping_charges",type:"number",className:"w-32 mr-2",disabled:!t,value:d??"",onChange:m=>{const g=m.target.value;if(g===""){l("shipping_charges",void 0);return}const j=Math.max(0,parseFloat(g)||0);l("shipping_charges",j)},onBlur:()=>{d||l("shipping_charges",0)}})}),e.jsx("span",{children:d?d.toFixed(2):"0.00"})]}),e.jsxs("div",{className:"flex justify-between items-center font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:y?y.toFixed(2):0})]})]})})}const L=a.object({contact_id:a.string({required_error:"The contact id field is required."}),reference:a.string({required_error:"The reference field is required."}),date:a.string({required_error:"The date field is required."}),estimated_delivery:a.string({required_error:"The estimated delivery field is required."}),expire_date:a.string().optional(),project_id:a.string({required_error:"The project id field is required."}),sales_person_id:a.string().optional(),subject:a.string().optional(),note:a.string().optional(),terms_conditions:a.string().optional(),discount:a.number().nonnegative().optional(),shipping_charges:a.number().nonnegative().optional(),total:a.number({message:"The total field is required."}).nonnegative()});L.extend({details:a.array(a.object({item_id:a.number({required_error:"The item id is required."}),item_barcode_id:a.number({required_error:"The barcode id is required."}),unit_id:a.number({required_error:"The unit id is required."}),price:a.number({required_error:"The price is required."}).nonnegative(),qty:a.number({required_error:"The quantity is required."}).nonnegative(),discount:a.number().nonnegative().optional(),after_discount:a.number().nonnegative(),total:a.number({required_error:"The total is required."}).nonnegative(),note:a.string().optional()}))});export{O as C,K as S,L as q};
