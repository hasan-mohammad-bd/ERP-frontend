import{r as m,a as e,aA as G,aB as B,aC as H,aD as K,X as N,aG as Q,aF as V,aH as q,ax as L,aJ as E,dk as Y,dB as J,dY as W,dS as X,I as R,bd as Z,be as ee,bf as A,bg as ae,bh as se,bi as v,dt as ne,E as te,G as oe,dU as le,ad as _,dx as re,aw as $,J as ce,Y as ie,K as O,N as z,Q as M,ab as de,ac as ue,aY as me,ae as he,af as xe,W as U,aX as pe,V as ge,ce as fe,cf as je,ay as ve,aL as ye,aM as be,aN as Se,aO as Ne,aI as Ce}from"./index-95d528fa.js";import{u as Ie}from"./index-c5e7cb27.js";function Re({rowData:s}){const[n,i]=m.useState(!1),[g,{isLoading:r}]=Ie(),d=async f=>{try{await g(f),L.success("Purchase Refund deleted successfully"),i(!1)}catch(u){console.log(u)}};return e.jsxs("div",{className:"flex justify-center space-x-2 min-h-10",children:[e.jsx(G,{roles:["invoice-refunds.delete"],children:e.jsx(B,{children:e.jsxs(H,{children:[e.jsx(K,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>{i(!0)},children:e.jsx(Q,{className:"h-4 w-4 text-foreground"})})}),e.jsx(V,{children:e.jsx("p",{children:"Delete Invoice Refund"})})]})})}),e.jsx(q,{title:"Are you sure?",description:"This action cannot be undone.",name:s.invoice_number,isOpen:n,onClose:()=>i(!1),onConfirm:()=>d(s.id),loading:r})]})}const Te=[{id:"select",header:({table:s})=>e.jsx(E,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:n=>s.toggleAllPageRowsSelected(!!n),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:s})=>e.jsx(E,{checked:s.getIsSelected(),onCheckedChange:n=>s.toggleSelected(!!n),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"invoice_number",header:"Invoice No"},{accessorKey:"date",header:"Date"},{accessorKey:"contact",header:"Supplier Name",cell:({row:s})=>s.original.contact.name},{accessorKey:"amount",header:"Amount",cell:({row:s})=>e.jsx(Y,{amount:parseFloat(String(s.original.amount))})},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),enableSorting:!1,cell:({row:s})=>e.jsx(Re,{rowData:s.original})}];function Fe({selectedProducts:s,setSelectedProducts:n,setContactId:i,receivedAmount:g,setReceivedAmount:r}){const[d,f]=m.useState(""),[u,T]=m.useState(null),[F,C]=m.useState(!1),{data:x,isLoading:y}=J("only_due=-1&per_page=1000&page=1",{skip:!d}),{data:b}=W(`only_due=-1&contact_id=${u}&per_page=1000&page=1`,{skip:!u}),I=((x==null?void 0:x.data)||[]).filter(a=>{var l;return(l=a.name)==null?void 0:l.toLowerCase().includes(d.toLowerCase())}),S=(b==null?void 0:b.data.map(a=>({...a,total_due:Math.abs(a.total_due),amount:Math.abs(a.total_due)})))||[],P=(a,l)=>{T(a),f(l),C(!1)},w=a=>{if(s.find(t=>t.id===a.id)){const t=s.filter(h=>h.id!==a.id);n(t),r(t.reduce((h,c)=>h+(c.amount||0),0))}else{const t=[...s,a];n(t),r(t.reduce((h,c)=>h+(c.amount||0),0))}},o=a=>{let l=a;const t=[];for(const h of S){if(l<=0)break;const c=Math.min(h.total_due,l);t.push({...h,amount:c}),l-=c}r(a),n(t)},p=a=>{const l=a.target.value,t=parseFloat(l);(l===""||!isNaN(t))&&(r(t||0),o(t||0))},j=(a,l)=>{const t=s.map(c=>c.id===a?{...c,amount:Math.min(l,c.total_due)}:c);n(t);const h=t.reduce((c,k)=>c+(k.amount||0),0);if(r(h),l===0){const c=t.filter(k=>k.amount!==0);n(c)}};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 relative z-30",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"h-4 px-4 py-[18px] border border-gray-300 flex justify-center items-center rounded-md",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(R,{type:"text",placeholder:"Enter Customer Name",value:d,onChange:a=>{f(a.target.value),C(!0)},className:"flex-grow"})]}),d&&F&&!y&&I.length>0&&e.jsx("div",{className:"absolute ml-14 bg-gray-50 dark:bg-gray-900",children:e.jsx("ul",{className:"border rounded-lg p-2",children:I.map(a=>e.jsx("li",{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 p-2 text-sm w-full",onClick:()=>{P(a.id,a.name),i(a.id)},children:a.name},a.id))})})]}),e.jsxs(Z,{children:[e.jsx(ee,{className:"border rounded",children:e.jsx(A,{children:["Select","Date","Invoice No","Due Amount","Amount"].map(a=>e.jsx(ae,{children:a},a))})}),e.jsx(se,{children:S.length===0?e.jsx(A,{children:e.jsx(v,{colSpan:5,className:"text-center py-5",children:"No Items Selected Yet"})}):e.jsx(e.Fragment,{children:S.map(a=>{var l;return e.jsxs(A,{children:[e.jsx(v,{children:e.jsx("input",{type:"checkbox",checked:s.some(t=>t.id===a.id),onChange:()=>w(a)})}),e.jsx(v,{children:a.date}),e.jsx(v,{children:a.invoice_number}),e.jsx(v,{children:a.total_due}),e.jsx(v,{children:e.jsx(R,{type:"number",value:((l=s.find(t=>t.id===a.id))==null?void 0:l.amount)||a.total_due,onChange:t=>j(a.id,parseFloat(t.target.value)||0)})})]},a.id)})})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Received Amount*"}),e.jsx(R,{type:"number",value:g===0?"":g,onChange:p})]})]})}const Pe=ne.injectEndpoints({endpoints:s=>({getInvoiceRefunds:s.query({query:n=>`invoice-refunds?${n}`,providesTags:["invoice-refunds"]}),createInvoiceRefund:s.mutation({query:n=>({url:"invoice-refunds",method:"POST",body:n}),invalidatesTags:["invoice-refunds","invoiceReturn","customers","invoices"]}),removeInvoiceRefund:s.mutation({query:n=>({url:`invoice-refunds/${n}`,method:"DELETE"}),invalidatesTags:["invoice-refunds","invoiceReturn","customers"]})}),overrideExisting:!1}),{useGetInvoiceRefundsQuery:we,useCreateInvoiceRefundMutation:ke,useRemoveInvoiceRefundMutation:Le}=Pe;function Ae({modalClose:s}){const[n,i]=m.useState([]),[g,r]=m.useState(null),[d,f]=m.useState(0),[u,T]=m.useState([]),[F,{isLoading:C}]=ke(),x=te({resolver:oe(le),defaultValues:{date:_(new Date,"yyyy-MM-dd")}}),{data:y,isLoading:b}=re("page=1&per_page=1000"),D=(y==null?void 0:y.data)||[],[I,S]=m.useState({date:!1,due_date:!1}),P=o=>{S(p=>({...p,[o]:!p[o]}))};async function w(o){if(n.length===0)return L.error("Please select at least one customer");const p=je.serialize({...o,contact_id:g,amount:Number(d),details:n.map(j=>({amount:j.amount,invoice_id:j.id})),files:u,_method:"POST"},{indices:!0});try{await F(p).unwrap(),L.success("Invoice Refund created successfully"),s()}catch(j){console.log(j),ve(j)}}return e.jsx(e.Fragment,{children:C?e.jsx("div",{children:e.jsx($,{})}):e.jsx(ce,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(w),className:"space-y-3",children:[e.jsx(ie,{className:"mb-4",children:e.jsx(Fe,{setSelectedProducts:i,selectedProducts:n,previousData:!1,setContactId:r,receivedAmount:d,setReceivedAmount:f})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 ",children:[e.jsx(O,{control:x.control,name:"date",render:({field:o})=>e.jsxs(z,{children:[e.jsx(M,{children:"Date"}),e.jsxs(de,{open:I.date,onOpenChange:()=>P("date"),children:[e.jsx(ue,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:`w-full justify-start text-left font-normal ${!o.value&&"text-muted-foreground"}`,children:[o.value?_(o.value,"PP"):"Pick a date",e.jsx(me,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(he,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(xe,{mode:"single",selected:o.value?new Date(o.value):void 0,onSelect:p=>{o.onChange(p?_(p,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(U,{})]})}),e.jsx(pe,{loading:b,data:D.filter(o=>o.nature==="Cash"||o.nature==="Bank Accounts"),displayField:"name",valueField:"id",form:x,name:"ledger_account_id",placeholder:"Select Ledger Account",title:"Ledger Account",className:"w-full"}),e.jsx(O,{control:x.control,name:"note",render:({field:o})=>e.jsxs(z,{children:[e.jsx(M,{children:"Note"}),e.jsx(ge,{children:e.jsx(R,{placeholder:"Type Subject.",...o})}),e.jsx(U,{})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Upload Files"}),e.jsx(fe,{setFilesToUpload:T,filesToUpload:u})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(N,{type:"button",onClick:()=>s(),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(N,{variant:"default",type:"submit",className:"w-fit mt-4",children:"Add"})]})]})})})}const De=()=>{const[s,n]=m.useState(!1),[i,g]=m.useState({pageIndex:0,pageSize:10}),{data:r,isLoading:d}=we(`per_page=${i.pageSize}&page=${i.pageIndex+1}`),f=(r==null?void 0:r.data)||[],u=r==null?void 0:r.meta;return d?e.jsx($,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ye,{title:"Invoice Refunds",description:"Manage your sub accounts for you business"}),e.jsxs(N,{onClick:()=>n(!0),size:"sm",children:[e.jsx(be,{className:"mr-2 h-4 w-4"})," Add Invoice Refund"]})]}),e.jsx(Se,{}),r&&e.jsx("div",{children:e.jsx(Ne,{columns:Te,data:f,paginationInfo:u,pagination:u&&i,setPagination:u&&g})})]})}),s&&e.jsx(Ce,{title:"Add Purchase Refund",isOpen:s,toggleModal:()=>n(!1),className:"max-w-4xl w-full",children:e.jsx(Ae,{modalClose:()=>n(!1)})})]})};export{De as default};
