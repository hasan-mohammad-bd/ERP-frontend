import{y as J,r as w,dy as K,dz as U,dA as V,dv as W,dx as X,dK as Y,B as Z,a as e,aG as ee,Q as o,G as ae,U as L,aQ as c,H as n,J as l,K as r,M as m,I as f,N as i,a6 as N,a7 as P,a8 as d,aR as S,a9 as b,aa as C,bp as se,D as te,as as T,at as ne}from"./index-6791da41.js";import{S as le,C as re,s as ie}from"./sales-order-87aeb51d.js";function ce(){const x=J(),[u,M]=w.useState([]),[j,O]=w.useState({sales_order_date:!1,delivery_date:!1,due_date:!1}),h=a=>{O(s=>({...s,[a]:!s[a]}))},{data:p,isLoading:Q}=K("page=1&per_page=1000"),{data:g,isLoading:k}=U("per_page=1000&page=1"),{data:y,isLoading:D}=V("per_page=1000&page=1"),{data:v,isLoading:G}=W("per_page=1000&page=1"),{data:_,isLoading:q}=X("per_page=1000&page=1"),z=(_==null?void 0:_.data)||[],A=(p==null?void 0:p.data)||[],$=(g==null?void 0:g.data)||[],E=(y==null?void 0:y.data)||[],I=(v==null?void 0:v.data)||[],[R,{isLoading:B}]=Y(),t=Z({resolver:te(ie),defaultValues:{total:0}});async function H(a){if(u.length===0)return T.error("Please select at least one product");try{await R({...a,discount:a.discount||0,shipping_charges:a.shipping_charges||0,details:u.map(s=>{const F=s.unit.selling_price*(1-s.unit.discount/100);return{unit_id:s.unit.id,item_id:s.id,item_barcode_id:Number(s.id),price:s.unit.selling_price,after_discount:F,total:F*s.quantity,qty:s.quantity,discount:s.unit.discount,note:s.note||""}})}).unwrap(),T.success("Sales order created successfully"),x("/billing/sales-orders")}catch(s){ne(s)}}return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(ee,{title:"Add Sales Order",description:"Manage your sub accounts for you business"}),e.jsx(o,{onClick:()=>x("/billing/sales-orders"),size:"sm",children:"Sales Order List"})]}),e.jsx(ae,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(H),className:"space-y-3 mb-4  overflow-y-scroll no-scrollbar",children:[e.jsx("div",{className:"",children:e.jsx(L,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(c,{loading:Q,data:A,displayField:"name",valueField:"id",form:t,name:"contact_id",placeholder:"Select Customer",title:"Customer Name",className:"w-full"}),e.jsx(n,{control:t.control,name:"reference",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Reference"}),e.jsx(m,{children:e.jsx(f,{placeholder:"Enter reference",...a})}),e.jsx(i,{})]})}),e.jsx(n,{control:t.control,name:"date",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Date"}),e.jsxs(N,{open:j.sales_order_date,onOpenChange:()=>h("sales_order_date"),children:[e.jsx(P,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(S,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(b,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(C,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(i,{})]})}),e.jsx(n,{control:t.control,name:"due_date",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Due Date"}),e.jsxs(N,{open:j.due_date,onOpenChange:()=>h("due_date"),children:[e.jsx(P,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(S,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(b,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(C,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(i,{})]})}),e.jsx(n,{control:t.control,name:"delivery_date",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Delivery Date"}),e.jsxs(N,{open:j.delivery_date,onOpenChange:()=>h("delivery_date"),children:[e.jsx(P,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?d(a.value,"PP"):"Pick a date",e.jsx(S,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(b,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(C,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?d(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(i,{})]})}),e.jsx(c,{loading:D,data:E,displayField:"name",valueField:"id",form:t,name:"sales_person_id",placeholder:"Select Sales person",title:"Sales Person",className:"w-full"}),e.jsx(c,{loading:k,data:$,displayField:"name",valueField:"id",form:t,name:"project_id",placeholder:"Select Project",title:"Project Name",className:"w-full"}),e.jsx(c,{loading:G,data:I,displayField:"name",valueField:"id",form:t,name:"payment_terms",placeholder:"Select Payment Terms",title:"Payment Terms",className:"w-full"}),e.jsx(c,{loading:q,data:z,displayField:"invoice_number",valueField:"id",form:t,name:"quotation_id",placeholder:"Select Quotation",title:"Quotation",className:"w-full"}),e.jsx(n,{control:t.control,name:"subject",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Subject"}),e.jsx(m,{children:e.jsx(f,{placeholder:"Type Subject.",...a})}),e.jsx(i,{})]})}),e.jsx(n,{control:t.control,name:"note",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Note"}),e.jsx(m,{children:e.jsx(f,{placeholder:"Type Note.",...a})}),e.jsx(i,{})]})}),e.jsx(n,{control:t.control,name:"terms_conditions",render:({field:a})=>e.jsxs(l,{children:[e.jsx(r,{children:"Terms and conditions"}),e.jsx(m,{children:e.jsx(se,{placeholder:"Type terms and conditions.",...a})}),e.jsx(i,{})]})})]})})}),e.jsx(L,{className:"mb-4",children:e.jsx(le,{setSelectedProducts:M,selectedProducts:u,previousData:!1})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(re,{form:t,subTotal:Number(u.reduce((a,s)=>a+s.total,0).toFixed(2))})}),e.jsxs("div",{className:"text-right",children:[e.jsx(o,{type:"button",onClick:()=>x("/billing/sales-orders"),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(o,{variant:"default",type:"submit",className:"w-fit mt-4",children:B?"Adding...":"Add"})]})]})})]})})}export{ce as default};
