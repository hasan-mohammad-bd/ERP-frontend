import{D as y,r as j,dz as D,dA as T,G as $,H as z,cl as M,a as e,Z as G,ax as H,K as I,N as c,Q as i,V as r,ac as O,ad as Q,Y as l,ae as h,aZ as V,af as B,ag as Y,X as d,aY as g,W as p,by as Z,I as f,aH as J,aN as K,ay as R,az as W,aM as X,A as q,aO as U}from"./index-5bbba7cd.js";import{e as ee}from"./expenses-201a517b.js";import{b as se}from"./index-f1bb5a24.js";const ae=()=>{const o=y(),[N,v]=j.useState({date:!1}),{data:m,isLoading:b}=D("type=Assets&nature=Cash&page=1&per_page=1000"),{data:x,isLoading:w}=T("page=1&per_page=1000"),[C,{isLoading:F}]=se(),E=(m==null?void 0:m.data)||[],_=(x==null?void 0:x.data)||[],t=$({resolver:z(ee),defaultValues:{total:0,note:"",details:[{note:"",attachment:""}]}}),A=a=>{v(s=>({...s,[a]:!s[a]}))},{fields:P,append:S,remove:k}=M({control:t.control,name:"details"}),u=t.watch("details").reduce((a,s)=>{const n=parseFloat(s.amount||"0");return a+(isNaN(n)?0:n)},0);j.useEffect(()=>{t.setValue("total",u)},[t,u]);async function L(a){try{await C({...a,ledger_account_id:Number(a.ledger_account_id),details:a.details.map(s=>({...s,expense_category_id:Number(s.expense_category_id),amount:Number(s.amount)}))}).unwrap(),R.success("Expense created successfully"),o("/billing/expenses")}catch(s){W(s)}}return e.jsx(G,{children:F?e.jsx(H,{}):e.jsx(I,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(L),className:"px-6 py-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-8 justify-between w-full",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(c,{control:t.control,name:"date",render:({field:a})=>e.jsxs(i,{children:[e.jsx(r,{children:"Date"}),e.jsxs(O,{open:N.date,onOpenChange:()=>A("date"),children:[e.jsx(Q,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:`w-full justify-start text-left font-normal ${!a.value&&"text-muted-foreground"}`,children:[a.value?h(a.value,"PP"):"Pick a date",e.jsx(V,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(B,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(Y,{mode:"single",selected:a.value?new Date(a.value):void 0,onSelect:s=>{a.onChange(s?h(s,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx(d,{})]})}),e.jsx("div",{className:"w-full",children:e.jsx(g,{loading:b,data:E,displayField:"name",valueField:"id",form:t,name:"ledger_account_id",title:"Payform",className:"w-[375px]"})}),e.jsx("div",{className:"grid col-span-2",children:e.jsx(c,{control:t.control,name:"note",render:({field:a})=>e.jsxs(i,{children:[e.jsx(r,{children:"Note"}),e.jsx(p,{children:e.jsx(Z,{placeholder:"Enter your note",...a})}),e.jsx(d,{})]})})})]})}),e.jsxs("div",{className:"mt-10 w-full",children:[P.map((a,s)=>e.jsxs("div",{className:"flex gap-4 items-start w-full my-4",children:[e.jsxs("div",{className:`${s===0?"-translate-y-0":"-translate-y-[8px]"}   w-full`,children:[s===0&&e.jsx(r,{children:"Expenses Category"})," ",e.jsx(g,{loading:w,data:_,displayField:"name",valueField:"id",form:t,name:`details.${s}.expense_category_id`,className:"w-[497px]"})]}),e.jsx(c,{control:t.control,name:`details.${s}.note`,render:({field:n})=>e.jsxs(i,{className:"w-full",children:[s===0&&e.jsx(r,{children:"Note"})," ",e.jsx(p,{children:e.jsx(f,{type:"text",placeholder:"Enter note",...n})}),e.jsx(d,{})]})}),e.jsx(c,{control:t.control,name:`details.${s}.amount`,render:({field:n})=>e.jsxs(i,{className:"w-full",children:[s===0&&e.jsx(r,{children:"Amount"})," ",e.jsx(p,{children:e.jsx(f,{type:"number",min:0,placeholder:"Enter amount",...n})}),e.jsx(d,{})]})}),s!==0&&e.jsx("div",{className:`flex items-center ${s===0?"mt-8":"mt-0"}`,children:e.jsx(l,{variant:"outline",className:"text-red-600",type:"button",onClick:()=>k(s),children:e.jsx(J,{size:16})})})]},a.id)),e.jsx("div",{className:"w-full",children:e.jsxs(l,{variant:"outline",className:"border border-dashed border-gray-700 w-full",type:"button",onClick:()=>S({expense_category_id:"",note:"",amount:"",attachment:""}),children:[e.jsx(K,{size:16})," ",e.jsx("span",{className:"ml-2",children:"Add Expense"})]})}),e.jsx("div",{className:"flex flex-row-reverse my-5",children:e.jsxs("p",{className:"text-[14px] font-semibold",children:["Total: ",u]})})]}),e.jsxs("div",{className:"flex flex-row-reverse items-center !mb-2 mt-8",children:[e.jsx(l,{variant:"default",type:"submit",className:"w-fit ml-2",children:"Save"}),e.jsx(l,{type:"button",variant:"primary",className:"w-fit",onClick:()=>o("/billing/expenses"),children:"Cancel"})]})]})})})},ce=()=>{const o=y();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{title:"Add Expense",description:"Manage job apply for you business"}),e.jsxs(l,{onClick:()=>o("/billing/expenses"),size:"sm",children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," Back To All Expenses"]})]}),e.jsx(U,{})]})}),e.jsx(ae,{})]})};export{ce as default};
