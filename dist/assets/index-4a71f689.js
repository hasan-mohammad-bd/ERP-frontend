import{bb as T,Q as o,cy as B,r as A,z as M,B as q,a as e,am as H,aB as P,aO as K,N as L,F as O,M as v,b0 as Q,b1 as z,b2 as F,b3 as G,b4 as J,b5 as l,E as i,G as u,J as j,I as p,K as x,a8 as R,aS as U,an as V,ao as W}from"./index-8b8c1713.js";import{S as X}from"./save-8dbfc6db.js";const Y=T.injectEndpoints({endpoints:d=>({getSalaries:d.query({query:m=>`salaries?${m}`,providesTags:["salaries"]})}),overrideExisting:!1}),{useGetSalariesQuery:Z}=Y,ee=T.injectEndpoints({endpoints:d=>({createSalaryAdjustment:d.mutation({query:m=>({url:"salary-adjustment",method:"POST",body:m}),invalidatesTags:["salaries"]})}),overrideExisting:!1}),{useCreateSalaryAdjustmentMutation:se}=ee,ae=o.object({adjustments:o.array(o.object({employee_id:o.number().optional(),allowance_adjustment:o.number().optional(),allowance_adjustment_note:o.string().optional(),deduction_adjustment:o.number().optional(),deduction_adjustment_note:o.string().optional()}))}),oe=()=>{const[d]=B(),m=d.get("employee_ids"),y=d.get("salary_month"),_=m?m.split(",").map(s=>Number(s)):[],[g,C]=A.useState("");A.useEffect(()=>{if(_.length>0){const s=_.map(t=>`employee_ids[]=${t}&salary_month=${y}`).join("&");C(`${s}`)}},[]);const[E,{isLoading:$}]=se(),{data:h,isLoading:k}=Z(g,{skip:g.length===0}),b=(h==null?void 0:h.data)||[],N=M({resolver:q(ae),defaultValues:{adjustments:b.map(s=>({employee_id:s==null?void 0:s.employee.id,allowance_adjustment:0,allowance_adjustment_note:"",deduction_adjustment:0,deduction_adjustment_note:""}))}}),{control:c,handleSubmit:I}=N,D=async s=>{const t={salary_month:y?R(U(y),"yyyy-MM"):null,adjustments:b.map((a,n)=>{var r,S,w,f;return{employee_id:a.employee.id,allowance_adjustment:Number((r=s.adjustments[n])==null?void 0:r.allowance_adjustment)||0,allowance_adjustment_note:((S=s.adjustments[n])==null?void 0:S.allowance_adjustment_note)||"",deduction_adjustment:Number((w=s.adjustments[n])==null?void 0:w.deduction_adjustment)||0,deduction_adjustment_note:((f=s.adjustments[n])==null?void 0:f.deduction_adjustment_note)||""}})};try{await E(t).unwrap(),V.success("Salary Adjustment Updated successfully")}catch(a){W(a),console.log(a)}};return k?e.jsx(H,{}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(P,{title:"Salary Adjustment",description:""})}),e.jsx(K,{}),e.jsx(L,{className:"px-4 py-6",children:e.jsx(O,{...N,children:e.jsxs("form",{onSubmit:I(D),children:[e.jsxs("div",{className:"flex justify-end mb-4 gap-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>window.history.back(),children:"Back"}),e.jsxs(v,{type:"submit",className:"bg-sky-500 hover:bg-sky-600",children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," ",$?"Saving...":"Save All"]})]}),e.jsxs(Q,{className:"border",children:[e.jsx(z,{className:"border",children:e.jsx(F,{className:"border h-0",children:te.map((s,t)=>e.jsx(G,{className:"border py-2 h-0 text-center text-black bg-gray-100 dark:bg-gray-900 dark:text-white",children:s},t))})}),e.jsx(J,{className:"border",children:b.map((s,t)=>e.jsxs(F,{className:"border",children:[e.jsx(l,{className:"border py-[5px]",children:`${s.employee.first_name} ${s.employee.last_name}`}),e.jsxs(l,{className:"border py-[5px]",children:["TK. ",Number(s.allowance_total).toFixed(2)]}),e.jsxs(l,{className:"border py-[5px]",children:["TK. ",Number(s.deduction_total).toFixed(2)]}),e.jsx(l,{className:"border py-[5px]",children:e.jsx(i,{control:c,name:`adjustments.${t}.allowance_adjustment`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(p,{type:"number",...a,className:"text-right",onChange:n=>{const r=n.target.value;a.onChange(r?Number(r):0)}})}),e.jsx(x,{})]})})}),e.jsx(l,{className:"border py-[5px]",children:e.jsx(i,{control:c,name:`adjustments.${t}.allowance_adjustment_note`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(p,{type:"text",...a,className:"text-right"})}),e.jsx(x,{})]})})}),e.jsx(l,{className:"border py-[5px]",children:e.jsx(i,{control:c,name:`adjustments.${t}.deduction_adjustment`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(p,{type:"number",...a,className:"text-right",onChange:n=>{const r=n.target.value;a.onChange(r?Number(r):0)}})}),e.jsx(x,{})]})})}),e.jsx(l,{className:"border py-[5px]",children:e.jsx(i,{control:c,name:`adjustments.${t}.deduction_adjustment_note`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(p,{type:"text",...a,className:"text-right"})}),e.jsx(x,{})]})})})]},t))})]})]})})})]})},te=["Employee Name","Allowance","Deduction","Allowance Adjust","Allowance Adjust Note","Deduction Adjust","Deduction Adjust Note"];export{oe as default};
