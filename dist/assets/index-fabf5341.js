import{r as m,B as H,dP as K,a as e,aB as z,aC as R,aD as U,X as S,aV as J,aF as B,aG as Y,aH as W,ax as D,aJ as G,dk as X,dJ as Z,dI as q,dQ as ee,I as k,bd as ae,be as se,bf as A,bg as te,bh as ne,bi as f,dR as le,E as re,G as oe,dS as ie,ad as L,dv as ce,aw as E,J as de,Y as ue,K as Q,N as V,Q as M,ab as me,ac as pe,aY as he,ae as xe,af as ge,W as $,aX as je,V as ye,ce as fe,cf as Se,ay as be,dT as Ne,aL as ve,aM as Ce,aN as Pe,aO as Fe,aI as ke}from"./index-850a3415.js";function we({rowData:s}){const[n,c]=m.useState(!1),g=H(),[o,{isLoading:d}]=K(),j=async u=>{try{await o(u),D.success("Supplier Payment deleted successfully"),c(!1)}catch(b){console.log(b)}};return e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(z,{children:e.jsxs(R,{children:[e.jsx(U,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>g(`/billing/supplier-payments/details/${s.id}`),children:e.jsx(J,{className:"h-4 w-4 text-foreground"})})}),e.jsx(B,{children:e.jsx("p",{children:"Update Opening Balance"})})]})}),e.jsx(z,{children:e.jsxs(R,{children:[e.jsx(U,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"icon",className:"hover:bg-secondary",onClick:()=>{c(!0)},children:e.jsx(Y,{className:"h-4 w-4 text-foreground"})})}),e.jsx(B,{children:e.jsx("p",{children:"Delete Supplier Payment"})})]})}),e.jsx(W,{title:"Are you sure?",description:"This action cannot be undone.",name:s.invoice_number,isOpen:n,onClose:()=>c(!1),onConfirm:()=>j(s.id),loading:d})]})}const Ie=[{id:"select",header:({table:s})=>e.jsx(G,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:n=>s.toggleAllPageRowsSelected(!!n),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:s})=>e.jsx(G,{checked:s.getIsSelected(),onCheckedChange:n=>s.toggleSelected(!!n),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"invoice_number",header:"Invoice No"},{accessorKey:"date",header:"Date"},{accessorKey:"contact",header:"Supplier Name",cell:({row:s})=>s.original.contact.name},{accessorKey:"amount",header:"Amount",cell:({row:s})=>e.jsx(X,{amount:parseFloat(String(s.original.amount))})},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),enableSorting:!1,cell:({row:s})=>e.jsx(we,{rowData:s.original})}];function Te({selectedProducts:s,setSelectedProducts:n,setContactId:c,receivedAmount:g,setReceivedAmount:o}){const[d,j]=m.useState(""),[u,b]=m.useState(null),[w,P]=m.useState(!1),{data:h,isLoading:N}=Z("only_due=1&per_page=1000&page=1",{skip:!d}),{data:v}=q(`only_due=1&contact_id=${u}&per_page=1000&page=1`,{skip:!u}),F=((h==null?void 0:h.data)||[]).filter(a=>{var r;return(r=a.name)==null?void 0:r.toLowerCase().includes(d.toLowerCase())}),C=(v==null?void 0:v.data.map(a=>({...a,amount:a.total_due})))||[],I=(a,r)=>{b(a),j(r),P(!1)},T=a=>{if(s.find(t=>t.id===a.id)){const t=s.filter(p=>p.id!==a.id);n(t),o(t.reduce((p,i)=>p+(i.amount||0),0))}else{const t=[...s,a];n(t),o(t.reduce((p,i)=>p+(i.amount||0),0))}},l=a=>{let r=a;const t=[];for(const p of C){if(r<=0)break;const i=Math.min(p.total_due,r);t.push({...p,amount:i}),r-=i}o(a),n(t)},x=a=>{const r=a.target.value,t=parseFloat(r);(r===""||!isNaN(t))&&(o(t||0),l(t||0))},y=(a,r)=>{const t=s.map(i=>i.id===a?{...i,amount:Math.min(r,i.total_due)}:i);n(t);const p=t.reduce((i,_)=>i+(_.amount||0),0);if(o(p),r===0){const i=t.filter(_=>_.amount!==0);n(i)}};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 relative z-30",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"h-4 px-4 py-[18px] border border-gray-300 flex justify-center items-center rounded-md",children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(k,{type:"text",placeholder:"Enter Customer Name",value:d,onChange:a=>{j(a.target.value),P(!0)},className:"flex-grow"})]}),d&&w&&!N&&F.length>0&&e.jsx("div",{className:"absolute ml-14 bg-gray-50 dark:bg-gray-900",children:e.jsx("ul",{className:"border rounded-lg p-2",children:F.map(a=>e.jsx("li",{className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 p-2 text-sm w-full",onClick:()=>{I(a.id,a.name),c(a.id)},children:a.name},a.id))})})]}),e.jsxs(ae,{children:[e.jsx(se,{className:"border rounded",children:e.jsx(A,{children:["Select","Date","Invoice No","Due Amount","Amount"].map(a=>e.jsx(te,{children:a},a))})}),e.jsx(ne,{children:C.length===0?e.jsx(A,{children:e.jsx(f,{colSpan:5,className:"text-center py-5",children:"No Items Selected Yet"})}):e.jsx(e.Fragment,{children:C.map(a=>{var r;return e.jsxs(A,{children:[e.jsx(f,{children:e.jsx("input",{type:"checkbox",checked:s.some(t=>t.id===a.id),onChange:()=>T(a)})}),e.jsx(f,{children:a.date}),e.jsx(f,{children:a.invoice_number}),e.jsx(f,{children:a.total_due}),e.jsx(f,{children:e.jsx(k,{type:"number",value:((r=s.find(t=>t.id===a.id))==null?void 0:r.amount)||a.total_due,onChange:t=>y(a.id,parseFloat(t.target.value)||0)})})]},a.id)})})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Received Amount*"}),e.jsx(k,{type:"number",value:g===0?"":g,onChange:x})]})]})}function _e({modalClose:s}){const[n,c]=m.useState([]),[g,o]=m.useState(null),[d,j]=m.useState(0),[u,b]=m.useState([]),[w,{isLoading:P}]=le(),h=re({resolver:oe(ie),defaultValues:{date:L(new Date,"yyyy-MM-dd")}}),{data:N,isLoading:v}=ce("page=1&per_page=1000"),O=(N==null?void 0:N.data)||[],[F,C]=m.useState({date:!1,due_date:!1}),I=l=>{C(x=>({...x,[l]:!x[l]}))};async function T(l){if(n.length===0)return D.error("Please select at least one customer");const x=Se.serialize({...l,contact_id:g,amount:Number(d),details:n.map(y=>({amount:y.amount,purchase_id:y.id})),files:u,_method:"POST"},{indices:!0});try{await w(x).unwrap(),D.success("Supplier Payment created successfully"),s()}catch(y){console.log(y),be(y)}}return e.jsx(e.Fragment,{children:P?e.jsx("div",{children:e.jsx(E,{})}):e.jsx(de,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(T),className:"space-y-3",children:[e.jsx(ue,{className:"mb-4",children:e.jsx(Te,{setSelectedProducts:c,selectedProducts:n,previousData:!1,setContactId:o,receivedAmount:d,setReceivedAmount:j})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 ",children:[e.jsx(Q,{control:h.control,name:"date",render:({field:l})=>e.jsxs(V,{children:[e.jsx(M,{children:"Date"}),e.jsxs(me,{open:F.date,onOpenChange:()=>I("date"),children:[e.jsx(pe,{asChild:!0,children:e.jsxs(S,{variant:"outline",className:`w-full justify-start text-left font-normal ${!l.value&&"text-muted-foreground"}`,children:[l.value?L(l.value,"PP"):"Pick a date",e.jsx(he,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(xe,{className:"w-auto p-0 z-[200]",align:"start",children:e.jsx(ge,{mode:"single",selected:l.value?new Date(l.value):void 0,onSelect:x=>{l.onChange(x?L(x,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),e.jsx($,{})]})}),e.jsx(je,{loading:v,data:O.filter(l=>l.nature==="Cash"||l.nature==="Bank Accounts"),displayField:"name",valueField:"id",form:h,name:"ledger_account_id",placeholder:"Select Ledger Account",title:"Ledger Account",className:"w-full"}),e.jsx(Q,{control:h.control,name:"note",render:({field:l})=>e.jsxs(V,{children:[e.jsx(M,{children:"Note"}),e.jsx(ye,{children:e.jsx(k,{placeholder:"Type Subject.",...l})}),e.jsx($,{})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Upload Files"}),e.jsx(fe,{setFilesToUpload:b,filesToUpload:u})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(S,{type:"button",onClick:()=>s(),className:"mr-2",variant:"primary",children:"Cancel"}),e.jsx(S,{variant:"default",type:"submit",className:"w-fit mt-4",children:"Add"})]})]})})})}const Le=()=>{const[s,n]=m.useState(!1),[c,g]=m.useState({pageIndex:0,pageSize:10}),{data:o,isLoading:d}=Ne(`per_page=${c.pageSize}&page=${c.pageIndex+1}`),j=(o==null?void 0:o.data)||[],u=o==null?void 0:o.meta;return d?e.jsx(E,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ve,{title:"Supplier Payments",description:"Manage your sub accounts for you business"}),e.jsxs(S,{onClick:()=>n(!0),size:"sm",children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"})," Add Supplier Payment"]})]}),e.jsx(Pe,{}),o&&e.jsx("div",{children:e.jsx(Fe,{columns:Ie,data:j,paginationInfo:u,pagination:u&&c,setPagination:u&&g})})]})}),s&&e.jsx(ke,{title:"Add Supplier Payment",isOpen:s,toggleModal:()=>n(!1),className:"max-w-4xl w-full",children:e.jsx(_e,{modalClose:()=>n(!1)})})]})};export{Le as default};
